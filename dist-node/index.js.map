{"version":3,"file":"index.js","sources":["../dist-src/commands/paint.js","../dist-src/commands/src-file-extension-mapping.js","../dist-src/rewrite-imports.js","../dist-src/commands/build.js","../dist-src/commands/dev.js","../dist-src/config.js","../dist-src/util.js","../dist-src/resolve-remote.js","../dist-src/rollup-plugin-entrypoint-alias.js","../dist-src/rollup-plugin-remote-cdn.js","../dist-src/rollup-plugin-stats.js","../dist-src/scan-imports.js","../dist-src/stats-formatter.js","../dist-src/index.js"],"sourcesContent":["import ansiEscapes from 'ansi-escapes';\nimport chalk from 'chalk';\nimport util from 'util';\nfunction getStateString(workerState, isWatch) {\n    if (workerState.state) {\n        if (Array.isArray(workerState.state)) {\n            return chalk[workerState.state[1]](workerState.state[0]);\n        }\n        return chalk.dim(workerState.state);\n    }\n    if (workerState.done) {\n        return workerState.error ? chalk.red('FAILED') : chalk.green('DONE');\n    }\n    if (isWatch) {\n        if (workerState.config.watch) {\n            return chalk.dim('WATCHING');\n        }\n    }\n    return chalk.dim('READY');\n}\nconst WORKER_BASE_STATE = { done: false, error: null, output: '' };\nexport function paint(bus, registeredWorkers, buildMode, devMode) {\n    let consoleOutput = '';\n    let hasBeenCleared = false;\n    let missingWebModule = null;\n    const allWorkerStates = {};\n    for (const [workerId, config] of registeredWorkers) {\n        allWorkerStates[workerId] = { ...WORKER_BASE_STATE, config };\n    }\n    function repaint() {\n        process.stdout.write(ansiEscapes.clearTerminal);\n        process.stdout.write(`${chalk.bold('Snowpack')}\\n\\n`);\n        // Dashboard\n        if (devMode) {\n            process.stdout.write(`  ${chalk.bold.cyan(`http://localhost:${devMode.port}`)}`);\n            for (const ip of devMode.ips) {\n                process.stdout.write(`${chalk.cyan(` > `)}${chalk.bold.cyan(`http://${ip}:${devMode.port}`)}`);\n            }\n            process.stdout.write('\\n' + chalk.dim(`  Server started in ${devMode.startTimeMs}ms.\\n\\n`));\n        }\n        if (buildMode) {\n            process.stdout.write('  ' + chalk.bold.cyan(buildMode.dest));\n            process.stdout.write(chalk.dim(` Building your application...\\n\\n`));\n        }\n        for (const [workerId, config] of registeredWorkers) {\n            const workerState = allWorkerStates[workerId];\n            const dotLength = 24 - workerId.length;\n            const dots = ''.padEnd(dotLength, '.');\n            const stateStr = getStateString(workerState, !!devMode);\n            process.stdout.write(`  ${workerId}${chalk.dim(dots)}[${stateStr}]\\n`);\n        }\n        process.stdout.write('\\n');\n        if (missingWebModule) {\n            let [missingPackageName, ...deepPackagePathParts] = missingWebModule.split('/');\n            if (missingPackageName.startsWith('@')) {\n                missingPackageName += '/' + deepPackagePathParts.shift();\n            }\n            process.stdout.write(`${chalk.red.underline.bold('▼ Snowpack')}\\n\\n`);\n            process.stdout.write(`  Package ${chalk.bold(missingWebModule)} could not be found!\\n`);\n            process.stdout.write(`    1. Make sure that your ${chalk.bold('web_modules/')} directory is mounted correctly.\\n`);\n            if (deepPackagePathParts.length > 0) {\n                process.stdout.write(`    2. Add ${chalk.bold(missingPackageName)} to your package.json \"dependencies\".\\n`);\n                process.stdout.write(`    3. Add ${chalk.bold('\"' + missingWebModule + '\"')} to your Snowpack \"entrypoints\".\\n`);\n            }\n            else {\n                process.stdout.write(`    2. Add ${chalk.bold(missingPackageName)} to your Snowpack \"webDependencies\".\\n`);\n            }\n            process.stdout.write('\\n');\n        }\n        for (const [workerId, config] of registeredWorkers) {\n            const workerState = allWorkerStates[workerId];\n            if (workerState && workerState.output) {\n                const chalkFn = Array.isArray(workerState.error) ? chalk.red : chalk;\n                process.stdout.write(`${chalkFn.underline.bold('▼ ' + workerId)}\\n\\n`);\n                process.stdout.write(workerState.output\n                    ? '  ' + workerState.output.trim().replace(/\\n/gm, '\\n  ')\n                    : hasBeenCleared\n                        ? chalk.dim('  Output cleared.')\n                        : chalk.dim('  No output, yet.'));\n                process.stdout.write('\\n\\n');\n            }\n        }\n        if (consoleOutput) {\n            process.stdout.write(`${chalk.underline.bold('▼ Console')}\\n\\n`);\n            process.stdout.write(consoleOutput\n                ? '  ' + consoleOutput.trim().replace(/\\n/gm, '\\n  ')\n                : hasBeenCleared\n                    ? chalk.dim('  Output cleared.')\n                    : chalk.dim('  No output, yet.'));\n            process.stdout.write('\\n\\n');\n        }\n        const overallStatus = Object.values(allWorkerStates).reduce((result, { done, error }) => {\n            return {\n                done: result.done && done,\n                error: result.error || error,\n            };\n        });\n        if (overallStatus.error) {\n            process.stdout.write(`${chalk.underline.red.bold('▼ Result')}\\n\\n`);\n            process.stdout.write('  ⚠️  Finished, with errors.');\n            process.stdout.write('\\n\\n');\n            process.exit(1);\n        }\n        else if (overallStatus.done) {\n            process.stdout.write(`${chalk.underline.green.bold('▶ Build Complete!')}\\n\\n`);\n        }\n    }\n    bus.on('WORKER_MSG', ({ id, msg }) => {\n        allWorkerStates[id].output += msg;\n        repaint();\n    });\n    bus.on('WORKER_UPDATE', ({ id, state }) => {\n        if (typeof state !== undefined) {\n            allWorkerStates[id].state = state;\n        }\n        repaint();\n    });\n    bus.on('WORKER_COMPLETE', ({ id, error }) => {\n        allWorkerStates[id].state = null;\n        allWorkerStates[id].done = true;\n        allWorkerStates[id].error = allWorkerStates[id].error || error;\n        repaint();\n    });\n    bus.on('WORKER_RESET', ({ id }) => {\n        allWorkerStates[id] = { ...WORKER_BASE_STATE, config: allWorkerStates[id].config };\n        repaint();\n    });\n    bus.on('CONSOLE', ({ level, args }) => {\n        consoleOutput += `[${level}] ${util.format.apply(util, args)}\\n`;\n        repaint();\n    });\n    bus.on('NEW_SESSION', () => {\n        missingWebModule = null;\n        if (consoleOutput) {\n            consoleOutput = ``;\n            hasBeenCleared = true;\n            repaint();\n        }\n    });\n    bus.on('MISSING_WEB_MODULE', ({ specifier }) => {\n        missingWebModule = specifier;\n        repaint();\n    });\n    // const rl = readline.createInterface({\n    //   input: process.stdin,\n    //   output: process.stdout,\n    // });\n    // rl.on('line', (input) => {\n    //   for (const [workerId, config] of registeredWorkers) {\n    //     if (!allWorkerStates[workerId].done && !allWorkerStates[workerId].state) {\n    //       allWorkerStates[workerId].output = '';\n    //     }\n    //   }\n    //   hasBeenCleared = true;\n    //   repaint();\n    // });\n    // unmountDashboard = render(<App bus={bus} registeredWorkers={registeredWorkers} />).unmount;\n    repaint();\n}\n","export default {\n    js: 'js',\n    jsx: 'js',\n    ts: 'js',\n    tsx: 'js',\n    vue: 'js',\n    svelte: 'js',\n};\n","const { parse } = require('es-module-lexer');\nfunction spliceString(source, withSlice, start, end) {\n    return source.slice(0, start) + (withSlice || '') + source.slice(end);\n}\nexport async function scanCodeImportsExports(code) {\n    const [imports] = await parse(code);\n    return imports.filter((imp) => {\n        //imp.d = -2 = import.meta.url = we can skip this for now\n        if (imp.d === -2) {\n            return false;\n        }\n        return true;\n    });\n}\nexport async function transformEsmImports(_code, replaceImport) {\n    const imports = await scanCodeImportsExports(_code);\n    let rewrittenCode = _code;\n    for (const imp of imports.reverse()) {\n        const spec = rewrittenCode.substring(imp.s, imp.e);\n        const rewrittenImport = replaceImport(spec);\n        rewrittenCode = spliceString(rewrittenCode, rewrittenImport, imp.s, imp.e);\n    }\n    return rewrittenCode;\n}\n","import chalk from 'chalk';\nimport { EventEmitter } from 'events';\nimport execa from 'execa';\nimport npmRunPath from 'npm-run-path';\nimport path from 'path';\nimport { promises as fs, createReadStream } from 'fs';\nimport glob from 'glob';\nimport { paint } from './paint';\nimport rimraf from 'rimraf';\nimport yargs from 'yargs-parser';\nimport srcFileExtensionMapping from './src-file-extension-mapping';\nimport { transformEsmImports } from '../rewrite-imports';\nimport mkdirp from 'mkdirp';\nconst { copy } = require('fs-extra');\nexport async function command({ cwd, config }) {\n    process.env.NODE_ENV = 'production';\n    const messageBus = new EventEmitter();\n    const allRegisteredWorkers = Object.entries(config.scripts);\n    const relevantWorkers = [];\n    const allWorkerPromises = [];\n    const isBundled = config.devOptions.bundle;\n    const finalDirectoryLoc = config.devOptions.out;\n    const buildDirectoryLoc = isBundled ? path.join(cwd, `.build`) : config.devOptions.out;\n    const distDirectoryLoc = path.join(buildDirectoryLoc, config.devOptions.dist);\n    const dependencyImportMapLoc = path.join(config.installOptions.dest, 'import-map.json');\n    const dependencyImportMap = require(dependencyImportMapLoc);\n    if (allRegisteredWorkers.filter(([id]) => id.startsWith('build')).length === 0) {\n        console.error(chalk.red(`No build scripts found, so nothing to build.`));\n        console.error(`See https://www.snowpack.dev/#build-scripts for help configuring your build.`);\n        return;\n    }\n    rimraf.sync(finalDirectoryLoc);\n    mkdirp.sync(finalDirectoryLoc);\n    if (finalDirectoryLoc !== buildDirectoryLoc) {\n        rimraf.sync(buildDirectoryLoc);\n        mkdirp.sync(buildDirectoryLoc);\n    }\n    const extToWorkerMap = {};\n    for (const [id, workerConfig] of allRegisteredWorkers) {\n        if (id.startsWith('build:') ||\n            id.startsWith('plugin:') ||\n            id.startsWith('lintall:') ||\n            id.startsWith('mount:')) {\n            relevantWorkers.push([id, workerConfig]);\n        }\n        if (id.startsWith('build:') || id.startsWith('plugin:')) {\n            const exts = id.split(':')[1].split(',');\n            for (const ext of exts) {\n                extToWorkerMap[ext] = extToWorkerMap[ext] || [];\n                extToWorkerMap[ext].push([id, workerConfig]);\n            }\n        }\n    }\n    if (isBundled) {\n        relevantWorkers.push(['bundle:*', { cmd: 'NA', watch: undefined }]);\n    }\n    console.log = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'log', args });\n    };\n    console.warn = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'warn', args });\n    };\n    console.error = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'error', args });\n    };\n    let relDest = path.relative(cwd, config.devOptions.out);\n    if (!relDest.startsWith(`..${path.sep}`)) {\n        relDest = `.${path.sep}` + relDest;\n    }\n    paint(messageBus, relevantWorkers, { dest: relDest }, undefined);\n    for (const [id, workerConfig] of relevantWorkers) {\n        if (!id.startsWith('lintall:')) {\n            continue;\n        }\n        messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n        const workerPromise = execa.command(workerConfig.cmd, {\n            env: npmRunPath.env(),\n            extendEnv: true,\n            shell: true,\n        });\n        allWorkerPromises.push(workerPromise);\n        workerPromise.catch((err) => {\n            messageBus.emit('WORKER_MSG', { id, level: 'error', msg: err.toString() });\n            messageBus.emit('WORKER_COMPLETE', { id, error: err });\n        });\n        workerPromise.then(() => {\n            messageBus.emit('WORKER_COMPLETE', { id, error: null });\n        });\n        const { stdout, stderr } = workerPromise;\n        stdout?.on('data', (b) => {\n            let stdOutput = b.toString();\n            if (stdOutput.includes('\\u001bc') || stdOutput.includes('\\x1Bc')) {\n                messageBus.emit('WORKER_RESET', { id });\n                stdOutput = stdOutput.replace(/\\x1Bc/, '').replace(/\\u001bc/, '');\n            }\n            if (id.endsWith(':tsc')) {\n                if (stdOutput.includes('\\u001bc') || stdOutput.includes('\\x1Bc')) {\n                    messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n                }\n                if (/Watching for file changes./gm.test(stdOutput)) {\n                    messageBus.emit('WORKER_UPDATE', { id, state: 'WATCHING' });\n                }\n                const errorMatch = stdOutput.match(/Found (\\d+) error/);\n                if (errorMatch && errorMatch[1] !== '0') {\n                    messageBus.emit('WORKER_UPDATE', { id, state: ['ERROR', 'red'] });\n                }\n            }\n            messageBus.emit('WORKER_MSG', { id, level: 'log', msg: stdOutput });\n        });\n        stderr?.on('data', (b) => {\n            messageBus.emit('WORKER_MSG', { id, level: 'error', msg: b.toString() });\n        });\n    }\n    for (const [id, workerConfig] of relevantWorkers) {\n        if (!id.startsWith('mount:')) {\n            continue;\n        }\n        const cmdArr = workerConfig.cmd.split(/\\s+/);\n        if (cmdArr[0] !== 'mount') {\n            throw new Error(`script[${id}] must use the mount command`);\n        }\n        cmdArr.shift();\n        let dirUrl, dirDisk;\n        if (cmdArr.length === 1) {\n            dirDisk = path.resolve(cwd, cmdArr[0]);\n            dirUrl = '/' + cmdArr[0];\n        }\n        else {\n            const { to } = yargs(cmdArr);\n            dirDisk = path.resolve(cwd, cmdArr[0]);\n            dirUrl = to;\n        }\n        const destinationFile = dirUrl === '/' ? buildDirectoryLoc : path.join(buildDirectoryLoc, dirUrl);\n        await copy(dirDisk, destinationFile).catch((err) => {\n            messageBus.emit('WORKER_MSG', { id, level: 'error', msg: err.toString() });\n            messageBus.emit('WORKER_COMPLETE', { id, error: err });\n            throw err;\n        });\n        messageBus.emit('WORKER_COMPLETE', { id, error: null });\n    }\n    if (config.include) {\n        const allFiles = glob.sync(`${config.include}/**/*`, {\n            nodir: true,\n            ignore: [`${config.include}/**/__tests__`, `${config.include}/**/*.{spec,test}.*`],\n        });\n        for (const [id, workerConfig] of relevantWorkers) {\n            if (!id.startsWith('build:') && !id.startsWith('plugin:')) {\n                continue;\n            }\n            messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n            for (const f of allFiles) {\n                const fileExtension = path.extname(f).substr(1);\n                if (!id.includes(`:${fileExtension}`) && !id.includes(`,${fileExtension}`)) {\n                    continue;\n                }\n                let { cmd } = workerConfig;\n                if (id.startsWith('build:')) {\n                    const { stdout, stderr } = await execa.command(cmd, {\n                        env: npmRunPath.env(),\n                        extendEnv: true,\n                        shell: true,\n                        input: createReadStream(f),\n                    });\n                    if (stderr) {\n                        console.error(stderr);\n                    }\n                    if (!stdout) {\n                        continue;\n                    }\n                    let outPath = f.replace(config.include, distDirectoryLoc);\n                    const extToFind = path.extname(f).substr(1);\n                    const extToReplace = srcFileExtensionMapping[extToFind];\n                    if (extToReplace) {\n                        outPath = outPath.replace(new RegExp(`${extToFind}$`), extToReplace);\n                    }\n                    let code = stdout;\n                    if (path.extname(outPath) === '.js') {\n                        code = await transformEsmImports(code, (spec) => {\n                            if (spec.startsWith('http') || spec.startsWith('/')) {\n                                return spec;\n                            }\n                            if (spec.startsWith('./') || spec.startsWith('../')) {\n                                const ext = path.extname(spec).substr(1);\n                                if (!ext) {\n                                    return spec + '.js';\n                                }\n                                const extToReplace = srcFileExtensionMapping[ext];\n                                if (extToReplace) {\n                                    return spec.replace(new RegExp(`${ext}$`), extToReplace);\n                                }\n                                return spec;\n                            }\n                            if (dependencyImportMap.imports[spec]) {\n                                return `/web_modules/${dependencyImportMap.imports[spec]}`;\n                            }\n                            messageBus.emit('MISSING_WEB_MODULE', { specifier: spec });\n                            return `/web_modules/${spec}.js`;\n                        });\n                    }\n                    await fs.mkdir(path.dirname(outPath), { recursive: true });\n                    await fs.writeFile(outPath, code);\n                }\n                if (id.startsWith('plugin:')) {\n                    const modulePath = require.resolve(cmd, { paths: [cwd] });\n                    const { build } = require(modulePath);\n                    try {\n                        var { result } = await build(f);\n                    }\n                    catch (err) {\n                        err.message = `[${id}] ${err.message}`;\n                        console.error(err);\n                        messageBus.emit('WORKER_COMPLETE', { id, error: err });\n                        continue;\n                    }\n                    let outPath = f.replace(config.include, distDirectoryLoc);\n                    const extToFind = path.extname(f).substr(1);\n                    const extToReplace = srcFileExtensionMapping[extToFind];\n                    if (extToReplace) {\n                        outPath = outPath.replace(new RegExp(`${extToFind}$`), extToReplace);\n                    }\n                    let code = result;\n                    if (path.extname(outPath) === '.js') {\n                        code = await transformEsmImports(code, (spec) => {\n                            if (spec.startsWith('http') || spec.startsWith('/')) {\n                                return spec;\n                            }\n                            if (spec.startsWith('./') || spec.startsWith('../')) {\n                                const ext = path.extname(spec).substr(1);\n                                if (!ext) {\n                                    console.error(`${f}: Import ${spec} is missing a required file extension.`);\n                                    return spec;\n                                }\n                                const extToReplace = srcFileExtensionMapping[ext];\n                                if (extToReplace) {\n                                    return spec.replace(new RegExp(`${ext}$`), extToReplace);\n                                }\n                                return spec;\n                            }\n                            return `/web_modules/${spec}.js`;\n                        });\n                    }\n                    await fs.mkdir(path.dirname(outPath), { recursive: true });\n                    await fs.writeFile(outPath, code);\n                }\n            }\n            messageBus.emit('WORKER_COMPLETE', { id, error: null });\n        }\n    }\n    await Promise.all(allWorkerPromises);\n    if (isBundled) {\n        messageBus.emit('WORKER_UPDATE', { id: 'bundle:*', state: ['RUNNING', 'yellow'] });\n        async function prepareBuildDirectoryForParcel() {\n            // Prepare the new build directory by copying over all static assets\n            // This is important since sometimes Parcel doesn't pick these up.\n            await copy(buildDirectoryLoc, finalDirectoryLoc, {\n                filter: (srcLoc) => {\n                    return (!srcLoc.startsWith(buildDirectoryLoc + path.sep + 'web_modules') &&\n                        !srcLoc.startsWith(buildDirectoryLoc + path.sep + config.devOptions.dist.substr(1)));\n                },\n            }).catch((err) => {\n                messageBus.emit('WORKER_MSG', { id: 'bundle:*', level: 'error', msg: err.toString() });\n                messageBus.emit('WORKER_COMPLETE', { id: 'bundle:*', error: err });\n                throw err;\n            });\n            const tempBuildManifest = JSON.parse(await fs.readFile(path.join(cwd, 'package.json'), { encoding: 'utf-8' }));\n            delete tempBuildManifest.name;\n            tempBuildManifest.devDependencies = tempBuildManifest.devDependencies || {};\n            tempBuildManifest.devDependencies['@babel/core'] =\n                tempBuildManifest.devDependencies['@babel/core'] || '^7.9.0';\n            await fs.writeFile(path.join(buildDirectoryLoc, 'package.json'), JSON.stringify(tempBuildManifest, null, 2));\n            await fs.writeFile(path.join(buildDirectoryLoc, '.babelrc'), `{\"plugins\": [[\"${require.resolve('@babel/plugin-syntax-import-meta')}\"]]}`);\n        }\n        await prepareBuildDirectoryForParcel();\n        const bundleAppPromise = execa('parcel', ['build', config.devOptions.fallback, '--out-dir', finalDirectoryLoc], {\n            cwd: buildDirectoryLoc,\n            env: npmRunPath.env(),\n            extendEnv: true,\n        });\n        bundleAppPromise.stdout?.on('data', (b) => {\n            messageBus.emit('WORKER_MSG', { id: 'bundle:*', level: 'log', msg: b.toString() });\n        });\n        bundleAppPromise.stderr?.on('data', (b) => {\n            messageBus.emit('WORKER_MSG', { id: 'bundle:*', level: 'log', msg: b.toString() });\n        });\n        bundleAppPromise.catch((err) => {\n            messageBus.emit('WORKER_MSG', { id: 'bundle:*', level: 'error', msg: err.toString() });\n            messageBus.emit('WORKER_COMPLETE', { id: 'bundle:*', error: err });\n        });\n        bundleAppPromise.then(() => {\n            messageBus.emit('WORKER_COMPLETE', { id: 'bundle:*', error: null });\n        });\n        await bundleAppPromise;\n        if (finalDirectoryLoc !== buildDirectoryLoc) {\n            rimraf.sync(buildDirectoryLoc);\n        }\n    }\n}\n","/**\n * This license applies to parts of this file originating from the\n * https://github.com/lukejacksonn/servor repository:\n *\n * MIT License\n * Copyright (c) 2019 Luke Jackson\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\nimport chalk from 'chalk';\nimport { EventEmitter } from 'events';\nimport execa from 'execa';\nimport { promises as fs } from 'fs';\nimport http from 'http';\nimport mime from 'mime-types';\nimport npmRunPath from 'npm-run-path';\nimport path from 'path';\nimport url from 'url';\nimport os from 'os';\nimport { paint } from './paint';\nimport yargs from 'yargs-parser';\nimport _srcFileExtensionMapping from './src-file-extension-mapping';\nimport { transformEsmImports } from '../rewrite-imports';\nimport CheapWatch from 'cheap-watch';\n// const FILE_CACHE = new Map<string, string>();\nconst LIVE_RELOAD_SNIPPET = `\n  <script>\n    const source = new EventSource('/livereload');\n    const reload = () => location.reload(true);\n    source.onmessage = reload;\n    source.onerror = () => (source.onopen = reload);\n    console.log('[snowpack] listening for file changes');\n  </script>\n`;\nconst gid = '__ROLLUP_PLUGIN_HOT_RUNTIME';\nconst host = 'localhost';\nconst port = '3000';\nconst ws = false;\nconst HOT_RELOAD_SNIPPET = `\n  <script>\n    window['${gid}'] = {\n      host: ${JSON.stringify(host)},\n      port: ${JSON.stringify(port)},\n      ws: ${JSON.stringify(ws)},\n      then: function(cb) {\n        if (loaded) {\n          setTimeout(cb, 0);\n        } else {\n          callbacks.push(cb);\n        }\n      }\n    };\n  </script>\n  <script src=\"/hmr/hmr-runtime.js\"></script>\n`;\nfunction getEncodingType(ext) {\n    if (ext === '.js' || ext === '.css' || ext === '.html') {\n        return 'utf8';\n    }\n    else {\n        return 'binary';\n    }\n}\nfunction watch(fileLoc, notify) {\n    // NOTE recursive watch doesn't work for me with fs watch (plus, I get duplicated\n    // events, which doesn't help with HMR)\n    const watch = new CheapWatch({ dir: fileLoc });\n    watch.on('+', ({ path, isNew }) => notify(isNew ? 'rename' : 'change', path));\n    watch.on('-', ({ path }) => notify('rename', path));\n    watch.init().catch((err) => {\n        console.error(err);\n        process.exit();\n    });\n    // if (process.platform !== 'linux') {\n    //   fsWatch(fileLoc, {recursive: true}, notify);\n    //   return;\n    // }\n    // // For performance: don't step into node_modules directories\n    // if (fileLoc.endsWith('node_modules')) {\n    //   return;\n    // }\n    // if (statSync(fileLoc).isDirectory()) {\n    //   fsWatch(fileLoc, notify);\n    // } else {\n    //   readdirSync(fileLoc).forEach((entry) => watch(path.join(fileLoc, entry), notify));\n    // }\n}\nconst sendFile = (res, file, ext = '.html') => {\n    res.writeHead(200, {\n        'Content-Type': mime.contentType(ext) || 'application/octet-stream',\n        'Access-Control-Allow-Origin': '*',\n    });\n    res.write(file, getEncodingType(ext));\n    res.end();\n};\nconst sendError = (res, status) => {\n    res.writeHead(status);\n    res.end();\n};\nconst sendMessage = (res, channel, data) => {\n    const msg = (channel ? `event: ${channel}\\n` : '') + `id: 0\\ndata: ${data}\\n`;\n    res.write(msg);\n    res.write('\\n\\n');\n};\nexport async function command({ cwd, port, config, hot }) {\n    console.log(chalk.bold('Snowpack Dev Server (Beta)'));\n    console.log('NOTE: Still experimental, default behavior may change.');\n    console.log('Starting up...');\n    console.log(hot);\n    const fileBuildCache = new Map();\n    const liveReloadClients = [];\n    const hmrClients = [];\n    const messageBus = new EventEmitter();\n    const serverStart = Date.now();\n    const dependencyImportMapLoc = path.join(config.installOptions.dest, 'import-map.json');\n    const dependencyImportMap = require(dependencyImportMapLoc);\n    const registeredWorkers = Object.entries(config.scripts);\n    const workerDirectories = [];\n    const mountedDirectories = [];\n    // NOTE rewritting extensions doesn't play well with HMR / SystemJS\n    const srcFileExtensionMapping = hot ? {} : _srcFileExtensionMapping;\n    const RELOAD_SNIPPET = hot ? HOT_RELOAD_SNIPPET : LIVE_RELOAD_SNIPPET;\n    for (const [id, workerConfig] of registeredWorkers) {\n        if (!id.startsWith('mount:')) {\n            continue;\n        }\n        const cmdArr = workerConfig.cmd.split(/\\s+/);\n        if (cmdArr[0] !== 'mount') {\n            throw new Error(`script[${id}] must use the mount command`);\n        }\n        cmdArr.shift();\n        let dirUrl, dirDisk;\n        if (cmdArr.length === 1) {\n            dirDisk = path.resolve(cwd, cmdArr[0]);\n            dirUrl = '/' + cmdArr[0];\n        }\n        else {\n            const { to } = yargs(cmdArr);\n            dirDisk = path.resolve(cwd, cmdArr[0]);\n            dirUrl = to;\n        }\n        mountedDirectories.push([dirDisk, dirUrl]);\n        setTimeout(() => messageBus.emit('WORKER_UPDATE', { id, state: ['DONE', 'green'] }), 400);\n    }\n    for (const [id, workerConfig] of registeredWorkers) {\n        let { cmd } = workerConfig;\n        if (!id.startsWith('lintall:')) {\n            continue;\n        }\n        if (workerConfig.watch) {\n            cmd += workerConfig.watch.replace('$1', '');\n        }\n        const tempBuildDir = await fs.mkdtemp(path.join(os.tmpdir(), `snowpack-${id}`));\n        workerDirectories.unshift(tempBuildDir);\n        cmd = cmd.replace(/\\$DIST/g, tempBuildDir);\n        const workerPromise = execa.command(cmd, { env: npmRunPath.env(), extendEnv: true, shell: true });\n        const { stdout, stderr } = workerPromise;\n        stdout?.on('data', (b) => {\n            let stdOutput = b.toString();\n            if (stdOutput.includes('\\u001bc') || stdOutput.includes('\\x1Bc')) {\n                messageBus.emit('WORKER_RESET', { id });\n                stdOutput = stdOutput.replace(/\\x1Bc/, '').replace(/\\u001bc/, '');\n            }\n            if (id.endsWith(':tsc')) {\n                if (stdOutput.includes('\\u001bc') || stdOutput.includes('\\x1Bc')) {\n                    messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n                }\n                if (/Watching for file changes./gm.test(stdOutput)) {\n                    messageBus.emit('WORKER_UPDATE', { id, state: 'WATCHING' });\n                }\n                const errorMatch = stdOutput.match(/Found (\\d+) error/);\n                if (errorMatch && errorMatch[1] !== '0') {\n                    messageBus.emit('WORKER_UPDATE', { id, state: ['ERROR', 'red'] });\n                }\n            }\n            messageBus.emit('WORKER_MSG', { id, level: 'log', msg: stdOutput });\n        });\n        stderr?.on('data', (b) => {\n            messageBus.emit('WORKER_MSG', { id, level: 'error', msg: b.toString() });\n        });\n        stderr?.on('data', (b) => { });\n        workerPromise.catch((err) => {\n            messageBus.emit('WORKER_COMPLETE', { id, error: err });\n        });\n        workerPromise.then(() => {\n            messageBus.emit('WORKER_COMPLETE', { id, error: null });\n        });\n    }\n    http\n        .createServer(async (req, res) => {\n        const reqUrl = req.url;\n        let reqPath = url.parse(reqUrl).pathname;\n        // const requestStart = Date.now();\n        res.on('finish', () => {\n            const { method, url } = req;\n            const { statusCode } = res;\n            if (statusCode !== 200) {\n                messageBus.emit('SERVER_RESPONSE', {\n                    method,\n                    url,\n                    statusCode,\n                });\n            }\n        });\n        if (reqPath === '/livereload') {\n            res.writeHead(200, {\n                Connection: 'keep-alive',\n                'Content-Type': 'text/event-stream',\n                'Cache-Control': 'no-cache',\n                'Access-Control-Allow-Origin': '*',\n            });\n            sendMessage(res, 'connected', 'ready');\n            setInterval(sendMessage, 60000, res, 'ping', 'waiting');\n            liveReloadClients.push(res);\n            return;\n        }\n        if (reqPath === '/~hot') {\n            req.socket.setTimeout(0);\n            res.writeHead(200, {\n                Connection: 'keep-alive',\n                'Content-Type': 'text/event-stream',\n                'Cache-Control': 'no-cache',\n                'Access-Control-Allow-Origin': '*',\n            });\n            sendMessage(res, null, JSON.stringify({\n                greeting: {\n                    clearConsole: false,\n                    inMemory: false,\n                    reload: true,\n                    autoAccept: false,\n                },\n            }));\n            // setInterval(sendMessage, 60000, res, 'ping', 'waiting');\n            hmrClients.push(res);\n            return;\n        }\n        const attemptedFileLoads = [];\n        function attemptLoadFile(requestedFile) {\n            attemptedFileLoads.push(requestedFile);\n            return fs\n                .stat(requestedFile)\n                .then((stat) => (stat.isFile() ? requestedFile : null))\n                .catch(() => null /* ignore */);\n        }\n        const resource = decodeURI(reqPath);\n        let requestedFileExt = path.parse(resource).ext.toLowerCase();\n        let isRoute = false;\n        let fileLoc = null;\n        let fileContents = null;\n        let fileBuilder;\n        for (const [id, workerConfig] of registeredWorkers) {\n            if (fileLoc ||\n                !resource.startsWith(config.devOptions.dist) ||\n                !requestedFileExt ||\n                !config.include ||\n                (!id.startsWith('build:') && !id.startsWith('plugin:'))) {\n                continue;\n            }\n            if (!config.include) {\n                console.error('\"include\" directory required to build');\n                return;\n            }\n            const srcExtMatchers = id.split(':')[1].split(',');\n            const { cmd } = workerConfig;\n            let requestedFile = path.join(config.include, resource.replace(`${config.devOptions.dist}`, ''));\n            for (const ext of srcExtMatchers) {\n                if (!srcFileExtensionMapping[ext] ||\n                    srcFileExtensionMapping[ext] === requestedFileExt.substr(1)) {\n                    const srcFile = requestedFile.replace(requestedFileExt, `.${ext}`);\n                    fileLoc = fileLoc || (await attemptLoadFile(srcFile));\n                }\n            }\n            if (!fileLoc) {\n                continue;\n            }\n            if (id.startsWith('plugin:')) {\n                const modulePath = require.resolve(cmd, { paths: [cwd] });\n                const { build } = require(modulePath);\n                fileBuilder = async (code) => {\n                    messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n                    try {\n                        let { result } = await build(fileLoc);\n                        return result;\n                    }\n                    catch (err) {\n                        err.message = `[${id}] ${err.message}`;\n                        console.error(err);\n                        return '';\n                    }\n                    finally {\n                        messageBus.emit('WORKER_UPDATE', { id, state: null });\n                    }\n                };\n                continue;\n            }\n            if (id.startsWith('build:')) {\n                fileBuilder = async (code) => {\n                    messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n                    const { stdout, stderr } = await execa.command(cmd, {\n                        env: npmRunPath.env(),\n                        extendEnv: true,\n                        shell: true,\n                        input: code,\n                    });\n                    if (stderr) {\n                        console.error(stderr);\n                    }\n                    messageBus.emit('WORKER_UPDATE', { id, state: null });\n                    return stdout;\n                };\n            }\n        }\n        for (const dirDisk of workerDirectories) {\n            if (fileLoc || !requestedFileExt || !resource.startsWith(config.devOptions.dist)) {\n                continue;\n            }\n            let requestedFile = path.join(dirDisk, resource.replace(`${config.devOptions.dist}`, ''));\n            fileLoc = await attemptLoadFile(requestedFile);\n        }\n        for (const [dirDisk, dirUrl] of mountedDirectories) {\n            if (fileLoc) {\n                continue;\n            }\n            if (resource.startsWith(config.devOptions.dist)) {\n                continue;\n            }\n            let requestedFile;\n            if (dirUrl === '/') {\n                requestedFile = path.join(dirDisk, resource);\n            }\n            else if (resource.startsWith(dirUrl)) {\n                requestedFile = path.join(dirDisk, resource.replace(dirUrl, '/'));\n            }\n            else {\n                continue;\n            }\n            fileLoc = fileLoc || (await attemptLoadFile(requestedFile));\n            if (requestedFileExt) {\n                continue;\n            }\n            fileLoc =\n                fileLoc ||\n                    (await attemptLoadFile(requestedFile + '.html')) ||\n                    (await attemptLoadFile(requestedFile + '/index.html')) ||\n                    (await attemptLoadFile(requestedFile + 'index.html'));\n            if (!fileLoc && dirUrl === '/' && config.devOptions.fallback) {\n                const fallbackFile = dirUrl === '/'\n                    ? path.join(dirDisk, config.devOptions.fallback)\n                    : path.join(cwd, config.devOptions.fallback);\n                fileLoc = await attemptLoadFile(fallbackFile);\n            }\n            if (fileLoc) {\n                requestedFileExt = '.html';\n                isRoute = true;\n            }\n        }\n        if (isRoute) {\n            messageBus.emit('NEW_SESSION');\n        }\n        if (!fileLoc) {\n            const prefix = chalk.red('  ✘ ');\n            console.error(`[404] ${reqUrl}\\n${attemptedFileLoads.map((loc) => prefix + loc).join('\\n')}`);\n            return sendError(res, 404);\n        }\n        fileContents = fileBuildCache.get(fileLoc) || null;\n        if (!fileContents) {\n            try {\n                fileContents = await fs.readFile(fileLoc, getEncodingType(requestedFileExt));\n                if (fileBuilder) {\n                    fileContents = await fileBuilder(fileContents);\n                }\n                if (isRoute) {\n                    fileContents += RELOAD_SNIPPET;\n                }\n                if (requestedFileExt === '.js') {\n                    fileContents = await transformEsmImports(fileContents, (spec) => {\n                        if (spec.startsWith('http') || spec.startsWith('/')) {\n                            return spec;\n                        }\n                        if (spec.startsWith('./') || spec.startsWith('../')) {\n                            const ext = path.extname(spec).substr(1);\n                            if (!ext) {\n                                return spec + '.js';\n                            }\n                            const extToReplace = srcFileExtensionMapping[ext];\n                            if (extToReplace) {\n                                return spec.replace(new RegExp(`${ext}$`), extToReplace);\n                            }\n                            return spec;\n                        }\n                        if (dependencyImportMap.imports[spec]) {\n                            return `/web_modules/${dependencyImportMap.imports[spec]}`;\n                        }\n                        messageBus.emit('MISSING_WEB_MODULE', { specifier: spec });\n                        return `/web_modules/${spec}.js`;\n                    });\n                }\n            }\n            catch (err) {\n                console.error(fileLoc, err);\n                return sendError(res, 500);\n            }\n        }\n        fileBuildCache.set(fileLoc, fileContents);\n        sendFile(res, fileContents, requestedFileExt);\n    })\n        .listen(port);\n    const hotDebounce = 50;\n    let hotChanges = [];\n    let hotTimeout;\n    const flushHotChanges = () => {\n        const changes = [...new Set(hotChanges)];\n        hotChanges = [];\n        for (const client of hmrClients) {\n            sendMessage(client, null, JSON.stringify({\n                changes,\n            }));\n        }\n    };\n    const notifyHotChange = (url) => {\n        hotChanges.push(url);\n        clearTimeout(hotTimeout);\n        hotTimeout = setTimeout(flushHotChanges, hotDebounce);\n    };\n    async function onWatchEvent(event, _fileLoc) {\n        const fileLoc = path.resolve(config.include, _fileLoc);\n        fileBuildCache.delete(fileLoc);\n        while (liveReloadClients.length > 0) {\n            sendMessage(liveReloadClients.pop(), 'message', 'reload');\n        }\n        notifyHotChange('/_dist_/' + _fileLoc);\n        // let requestId = fileLoc;\n        // if (requestId.startsWith(cwd)) {\n        //   requestId = requestId.replace(/\\.(js|ts|jsx|tsx)$/, '.js');\n        // }\n        // FILE_CACHE.delete(requestId);\n        // if (babelFileErrors.has(fileLoc)) {\n        //   const fileContents = await fs.readFile(fileLoc, 'utf-8').catch((err) => null /* ignore */);\n        //   if (!fileContents) {\n        //     babelFileErrors.delete(fileLoc);\n        //   } else {\n        //     buildBabelFile(fileLoc, fileContents);\n        //   }\n        // }\n    }\n    if (config.include) {\n        watch(config.include, onWatchEvent);\n    }\n    process.on('SIGINT', () => {\n        for (const client of liveReloadClients) {\n            client.end();\n        }\n        process.exit(0);\n    });\n    console.log = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'log', args });\n    };\n    console.warn = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'warn', args });\n    };\n    console.error = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'error', args });\n    };\n    const ips = Object.values(os.networkInterfaces())\n        .reduce((every, i) => [...every, ...(i || [])], [])\n        .filter((i) => i.family === 'IPv4' && i.internal === false)\n        .map((i) => i.address);\n    paint(messageBus, registeredWorkers, undefined, {\n        port,\n        ips,\n        startTimeMs: Date.now() - serverStart,\n    });\n    // sorry... can't stand this\n    // openInBrowser(port);\n    return new Promise(() => { });\n}\nfunction openInBrowser(port) {\n    const url = `http://localhost:${port}`;\n    let openCmd = 'xdg-open';\n    if (process.platform === 'darwin')\n        openCmd = 'open';\n    if (process.platform === 'win32')\n        openCmd = 'start';\n    execa(openCmd, [url]).catch(() => {\n        // couldn't open automatically, safe to ignore\n    });\n}\n","import path from 'path';\nimport fs from 'fs';\nimport { cosmiconfigSync } from 'cosmiconfig';\nimport { validate } from 'jsonschema';\nimport { all as merge } from 'deepmerge';\nimport chalk from 'chalk';\nconst CONFIG_NAME = 'snowpack';\n// default settings\nconst DEFAULT_CONFIG = {\n    exclude: ['__tests__/*', '**/*.@(spec|test).*'],\n    knownEntrypoints: [],\n    installOptions: {\n        clean: false,\n        dest: 'web_modules',\n        externalPackage: [],\n        installTypes: false,\n        env: {},\n        alias: {},\n    },\n    devOptions: {\n        port: 8080,\n        out: 'build',\n        dist: '/_dist_',\n        fallback: 'index.html',\n        bundle: false,\n        hot: false,\n    },\n    rollup: {\n        plugins: [],\n        dedupe: [],\n    },\n};\nconst configSchema = {\n    type: 'object',\n    properties: {\n        extends: { type: 'string' },\n        knownEntrypoints: { type: 'array', items: { type: 'string' } },\n        include: { type: 'string' },\n        exclude: { type: 'array', items: { type: 'string' } },\n        webDependencies: {\n            type: ['object'],\n            additionalProperties: { type: 'string' },\n        },\n        installOptions: {\n            type: 'object',\n            properties: {\n                clean: { type: 'boolean' },\n                dest: { type: 'string' },\n                externalPackage: { type: 'array', items: { type: 'string' } },\n                installTypes: { type: 'boolean' },\n                sourceMap: { oneOf: [{ type: 'boolean' }, { type: 'string' }] },\n                alias: {\n                    type: 'object',\n                    additionalProperties: { type: 'string' },\n                },\n                env: {\n                    type: 'object',\n                    additionalProperties: {\n                        oneOf: [\n                            { id: 'EnvVarString', type: 'string' },\n                            { id: 'EnvVarNumber', type: 'number' },\n                            { id: 'EnvVarTrue', type: 'boolean', enum: [true] },\n                        ],\n                    },\n                },\n            },\n        },\n        devOptions: {\n            type: 'object',\n            properties: {\n                port: { type: 'number' },\n                out: { type: 'string' },\n                dist: { type: 'string' },\n                fallback: { type: 'string' },\n                bundle: { type: 'boolean' },\n                hot: { type: 'boolean' },\n            },\n        },\n        scripts: {\n            type: 'object',\n            additionalProperties: { type: ['string'] },\n        },\n        rollup: {\n            type: 'object',\n            properties: {\n                plugins: { type: 'array', items: { type: 'object' } },\n                dedupe: {\n                    type: 'array',\n                    items: { type: 'string' },\n                },\n                namedExports: {\n                    type: 'object',\n                    additionalProperties: { type: 'array', items: { type: 'string' } },\n                },\n            },\n        },\n    },\n};\n/**\n * Convert CLI flags to an incomplete Snowpack config representation.\n * We need to be careful about setting properties here if the flag value\n * is undefined, since the deep merge strategy would then overwrite good\n * defaults with 'undefined'.\n */\nfunction expandCliFlags(flags) {\n    const result = {\n        installOptions: {},\n        devOptions: {},\n    };\n    const { help, version, config, ...relevantFlags } = flags;\n    for (const [flag, val] of Object.entries(relevantFlags)) {\n        if (flag === '_' || flag.includes('-')) {\n            continue;\n        }\n        if (configSchema.properties[flag]) {\n            result[flag] = val;\n            continue;\n        }\n        if (configSchema.properties.installOptions.properties[flag]) {\n            result.installOptions[flag] = val;\n            continue;\n        }\n        if (configSchema.properties.devOptions.properties[flag]) {\n            result.devOptions[flag] = val;\n            continue;\n        }\n        console.error(`Unknown CLI flag: \"${flag}\"`);\n        process.exit(1);\n    }\n    if (result.installOptions.env) {\n        result.installOptions.env = result.installOptions.env.reduce((acc, id) => {\n            const index = id.indexOf('=');\n            const [key, val] = index > 0 ? [id.substr(0, index), id.substr(index + 1)] : [id, true];\n            acc[key] = val;\n            return acc;\n        }, {});\n    }\n    return result;\n}\n/** resolve --dest relative to cwd, etc. */\nfunction normalizeConfig(config) {\n    const cwd = process.cwd();\n    if (config.include) {\n        config.include = path.resolve(cwd, config.include);\n    }\n    else {\n        const potentialIncludeDir = path.resolve(cwd, 'src');\n        if (fs.existsSync(potentialIncludeDir)) {\n            config.include = potentialIncludeDir;\n        }\n    }\n    config.installOptions.dest = path.resolve(cwd, config.installOptions.dest);\n    config.devOptions.out = path.resolve(cwd, config.devOptions.out);\n    const scriptsBase = {\n        'mount:web_modules': 'mount web_modules',\n    };\n    if (!config.scripts) {\n        scriptsBase['mount:/'] = 'mount . --to /';\n    }\n    else if (fs.existsSync(path.resolve(cwd, 'public'))) {\n        scriptsBase['mount:public'] = scriptsBase['mount:public'] || 'mount public --to /';\n    }\n    // @ts-ignore\n    config.scripts = {\n        ...scriptsBase,\n        ...config.scripts,\n    };\n    for (const scriptId of Object.keys(config.scripts)) {\n        if (scriptId.includes('::watch')) {\n            continue;\n        }\n        config.scripts[scriptId] = {\n            cmd: config.scripts[scriptId],\n            watch: config.scripts[`${scriptId}::watch`],\n        };\n    }\n    for (const scriptId of Object.keys(config.scripts)) {\n        if (scriptId.includes('::watch')) {\n            delete config.scripts[scriptId];\n        }\n    }\n    return config;\n}\nfunction handleConfigError(msg) {\n    console.error(`[error]: ${msg}`);\n    process.exit(1);\n}\nfunction handleValidationErrors(filepath, errors) {\n    console.error(chalk.red(`! ${filepath || 'Configuration error'}`));\n    console.error(errors.map((err) => `    - ${err.toString()}`).join('\\n'));\n    console.error(`    See https://www.snowpack.dev/#configuration for more info.`);\n    process.exit(1);\n}\nfunction handleDeprecatedConfigError(msg) {\n    console.error(chalk.red(msg));\n    console.error(`See https://www.snowpack.dev/#configuration for more info.`);\n    process.exit(1);\n}\nfunction validateConfigAgainstV1(rawConfig, cliFlags) {\n    // Moved!\n    if (rawConfig.dedupe || cliFlags.dedupe) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `dedupe` is now `rollup.dedupe`.');\n    }\n    if (rawConfig.namedExports || cliFlags.namedExports) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `namedExports` is now `rollup.namedExports`.');\n    }\n    if (rawConfig.installOptions?.include) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.include` is now `include` but its syntax has also changed!');\n    }\n    if (rawConfig.installOptions?.exclude) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.exclude` is now `exclude`.');\n    }\n    if (Array.isArray(rawConfig.webDependencies)) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] The `webDependencies` array is now `knownEntrypoints`.');\n    }\n    if (rawConfig.entrypoints) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `entrypoints` is now `knownEntrypoints`.');\n    }\n    // Replaced!\n    if (rawConfig.source || cliFlags.source) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `source` is now detected automatically, this config is safe to remove.');\n    }\n    if (rawConfig.stat || cliFlags.stat) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `stat` is now the default output, this config is safe to remove.');\n    }\n    // Removed!\n    if (rawConfig.hash || cliFlags.hash) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.hash` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.nomodule || cliFlags.nomodule) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.nomodule` has been replaced by `snowpack build --bundle`.');\n    }\n    if (rawConfig.installOptions?.nomoduleOutput || cliFlags.nomoduleOutput) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.nomoduleOutput` has been replaced by `snowpack build --bundle`.');\n    }\n    if (rawConfig.installOptions?.babel || cliFlags.babel) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.babel` has been replaced by `snowpack build --bundle`.');\n    }\n    if (rawConfig.installOptions?.optimize || cliFlags.optimize) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.optimize` has been replaced by `snowpack build --bundle`.');\n    }\n    if (rawConfig.installOptions?.strict || cliFlags.strict) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.strict` is no longer supported.');\n    }\n}\nexport function loadAndValidateConfig(flags, pkgManifest) {\n    const explorerSync = cosmiconfigSync(CONFIG_NAME, {\n        // only support these 3 types of config for now\n        searchPlaces: ['package.json', 'snowpack.config.js', 'snowpack.config.json'],\n        // don't support crawling up the folder tree:\n        stopDir: path.dirname(process.cwd()),\n    });\n    let result;\n    // if user specified --config path, load that\n    if (flags.config) {\n        result = explorerSync.load(path.resolve(process.cwd(), flags.config));\n        if (!result) {\n            handleConfigError(`Could not locate Snowpack config at ${flags.config}`);\n        }\n    }\n    // If no config was found above, search for one.\n    result = result || explorerSync.search();\n    // If still no config found, assume none exists and use the default config.\n    if (!result || !result.config || result.isEmpty) {\n        result = { config: { ...DEFAULT_CONFIG } };\n    }\n    // validate against schema; throw helpful user if invalid\n    const config = result.config;\n    const cliConfig = expandCliFlags(flags);\n    validateConfigAgainstV1(result.config, flags);\n    const validation = validate(config, configSchema, {\n        allowUnknownAttributes: false,\n        propertyName: CONFIG_NAME,\n    });\n    if (validation.errors && validation.errors.length > 0) {\n        handleValidationErrors(result.filepath, validation.errors);\n        process.exit(1);\n    }\n    let extendConfig = {};\n    if (config.extends) {\n        const extendConfigLoc = config.extends.startsWith('.')\n            ? path.resolve(path.dirname(result.filepath), config.extends)\n            : require.resolve(config.extends, { paths: [process.cwd()] });\n        const extendResult = explorerSync.load(extendConfigLoc);\n        if (!extendResult) {\n            handleConfigError(`Could not locate Snowpack config at ${flags.config}`);\n            process.exit(1);\n        }\n        extendConfig = extendResult.config;\n        const extendValidation = validate(extendConfig, configSchema, {\n            allowUnknownAttributes: false,\n            propertyName: CONFIG_NAME,\n        });\n        if (extendValidation.errors && extendValidation.errors.length > 0) {\n            handleValidationErrors(result.filepath, extendValidation.errors);\n            process.exit(1);\n        }\n    }\n    // if valid, apply config over defaults\n    const overwriteMerge = (destinationArray, sourceArray, options) => sourceArray;\n    const mergedConfig = merge([\n        DEFAULT_CONFIG,\n        extendConfig,\n        { webDependencies: pkgManifest.webDependencies },\n        config,\n        cliConfig,\n    ], { arrayMerge: overwriteMerge });\n    // if CLI flags present, apply those as overrides\n    return normalizeConfig(mergedConfig);\n}\n","import fs from 'fs';\nimport path from 'path';\nimport got from 'got';\nimport cachedir from 'cachedir';\nexport const PIKA_CDN = `https://cdn.pika.dev`;\nexport const CACHE_DIR = cachedir('snowpack');\nexport const RESOURCE_CACHE = path.join(CACHE_DIR, 'pkg-cache-1.4');\nexport const HAS_CDN_HASH_REGEX = /\\-[a-zA-Z0-9]{16,}/;\nexport async function readLockfile(cwd) {\n    try {\n        var lockfileContents = fs.readFileSync(path.join(cwd, 'snowpack.lock.json'), {\n            encoding: 'utf8',\n        });\n    }\n    catch (err) {\n        // no lockfile found, ignore and continue\n        return null;\n    }\n    // If this fails, we actually do want to alert the user by throwing\n    return JSON.parse(lockfileContents);\n}\nexport async function writeLockfile(loc, importMap) {\n    const sortedImportMap = { imports: {} };\n    for (const key of Object.keys(importMap.imports).sort()) {\n        sortedImportMap.imports[key] = importMap.imports[key];\n    }\n    fs.writeFileSync(loc, JSON.stringify(sortedImportMap, undefined, 2), { encoding: 'utf8' });\n}\nexport function fetchCDNResource(resourceUrl, responseType) {\n    if (!resourceUrl.startsWith(PIKA_CDN)) {\n        resourceUrl = PIKA_CDN + resourceUrl;\n    }\n    // @ts-ignore - TS doesn't like responseType being unknown amount three options\n    return got(resourceUrl, {\n        responseType: responseType,\n        headers: { 'user-agent': `snowpack/v1.4 (https://snowpack.dev)` },\n        throwHttpErrors: false,\n    });\n}\nexport function isTruthy(item) {\n    return Boolean(item);\n}\n/**\n * Given a package name, look for that package's package.json manifest.\n * Return both the manifest location (if believed to exist) and the\n * manifest itself (if found).\n *\n * NOTE: You used to be able to require() a package.json file directly,\n * but now with export map support in Node v13 that's no longer possible.\n */\nexport function resolveDependencyManifest(dep, cwd) {\n    // Attempt #1: Resolve the dependency manifest normally. This works for most\n    // packages, but fails when the package defines an export map that doesn't\n    // include a package.json. If we detect that to be the reason for failure,\n    // move on to our custom implementation.\n    try {\n        const depManifest = require.resolve(`${dep}/package.json`, { paths: [cwd] });\n        return [depManifest, require(depManifest)];\n    }\n    catch (err) {\n        // if its an export map issue, move on to our manual resolver.\n        if (err.code !== 'ERR_PACKAGE_PATH_NOT_EXPORTED') {\n            throw new Error(`Cannot resolve \"${dep}/package.json\" via \"${cwd}\".`);\n        }\n    }\n    // Attempt #2: Resolve the dependency manifest manually. This involves resolving\n    // the dep itself to find the entrypoint file, and then haphazardly replacing the\n    // file path within the package with a \"./package.json\" instead. It's not as\n    // thorough as Attempt #1, but it should work well until export maps become more\n    // established & move out of experimental mode.\n    let result = [null, null];\n    try {\n        const fullPath = require.resolve(dep, { paths: [cwd] });\n        // Strip everything after the package name to get the package root path\n        // NOTE: This find-replace is very gross, replace with something like upath.\n        const searchPath = `${path.sep}node_modules${path.sep}${dep.replace('/', path.sep)}`;\n        const indexOfSearch = fullPath.lastIndexOf(searchPath);\n        if (indexOfSearch >= 0) {\n            const manifestPath = fullPath.substring(0, indexOfSearch + searchPath.length + 1) + 'package.json';\n            result[0] = manifestPath;\n            const manifestStr = fs.readFileSync(manifestPath, { encoding: 'utf8' });\n            result[1] = JSON.parse(manifestStr);\n        }\n    }\n    catch (err) {\n        // ignore\n    }\n    finally {\n        return result;\n    }\n}\n/**\n * If Rollup erred parsing a particular file, show suggestions based on its\n * file extension (note: lowercase is fine).\n */\nexport const MISSING_PLUGIN_SUGGESTIONS = {\n    '.css': 'Try installing rollup-plugin-postcss and adding it to Snowpack (https://www.snowpack.dev/#custom-rollup-plugins)',\n    '.svelte': 'Try installing rollup-plugin-svelte and adding it to Snowpack (https://www.snowpack.dev/#custom-rollup-plugins)',\n    '.vue': 'Try installing rollup-plugin-vue and adding it to Snowpack (https://www.snowpack.dev/#custom-rollup-plugins)',\n};\n","import cacache from 'cacache';\nimport PQueue from 'p-queue';\nimport chalk from 'chalk';\nimport validatePackageName from 'validate-npm-package-name';\nimport { fetchCDNResource, PIKA_CDN, RESOURCE_CACHE } from './util.js';\n/**\n * Given an install specifier, attempt to resolve it from the CDN.\n * If no lockfile exists or if the entry is not found in the lockfile, attempt to resolve\n * it from the CDN directly. Otherwise, use the URL found in the lockfile and attempt to\n * check the local cache first.\n *\n * All resolved URLs are populated into the local cache, where our internal Rollup engine\n * will load them from when it installs your dependencies to disk.\n */\nasync function resolveDependency(installSpecifier, packageSemver, lockfile, canRetry = true) {\n    // Right now, the CDN is only for top-level JS packages. The CDN doesn't support CSS,\n    // non-JS assets, and has limited support for deep package imports. Snowpack\n    // will automatically fall-back any failed/not-found assets from local\n    // node_modules/ instead.\n    if (!validatePackageName(installSpecifier).validForNewPackages) {\n        return null;\n    }\n    // Grab the installUrl from our lockfile if it exists, otherwise resolve it yourself.\n    let installUrl;\n    let installUrlType;\n    if (lockfile && lockfile.imports[installSpecifier]) {\n        installUrl = lockfile.imports[installSpecifier];\n        installUrlType = 'pin';\n    }\n    else {\n        if (packageSemver === 'latest') {\n            console.warn(`warn(${installSpecifier}): Not found in \"dependencies\". Using latest package version...`);\n        }\n        if (packageSemver.startsWith('npm:@reactesm') || packageSemver.startsWith('npm:@pika/react')) {\n            throw new Error(`React workaround packages no longer needed! Revert to the official React & React-DOM packages.`);\n        }\n        if (packageSemver.includes(' ') || packageSemver.includes(':')) {\n            console.warn(`warn(${installSpecifier}): Can't fetch complex semver \"${packageSemver}\" from remote CDN.`);\n            return null;\n        }\n        installUrlType = 'lookup';\n        installUrl = `${PIKA_CDN}/${installSpecifier}@${packageSemver}`;\n    }\n    // Hashed CDN urls never change, so its safe to grab them directly from the local cache\n    // without a network request.\n    if (installUrlType === 'pin') {\n        const cachedResult = await cacache.get.info(RESOURCE_CACHE, installUrl).catch(() => null);\n        if (cachedResult) {\n            if (cachedResult.metadata) {\n                const { pinnedUrl } = cachedResult.metadata;\n                return pinnedUrl;\n            }\n        }\n    }\n    // Otherwise, resolve from the CDN remotely.\n    const { statusCode, headers, body } = await fetchCDNResource(installUrl);\n    if (statusCode !== 200) {\n        console.warn(`Failed to resolve [${statusCode}]: ${installUrl} (${body})`);\n        console.warn(`Falling back to local copy...`);\n        return null;\n    }\n    let importUrlPath = headers['x-import-url'];\n    let pinnedUrlPath = headers['x-pinned-url'];\n    const buildStatus = headers['x-import-status'];\n    const typesUrlPath = headers['x-typescript-types'];\n    const typesUrl = typesUrlPath && `${PIKA_CDN}${typesUrlPath}`;\n    if (installUrlType === 'pin') {\n        const pinnedUrl = installUrl;\n        await cacache.put(RESOURCE_CACHE, pinnedUrl, body, {\n            metadata: { pinnedUrl, typesUrl },\n        });\n        return pinnedUrl;\n    }\n    if (pinnedUrlPath) {\n        const pinnedUrl = `${PIKA_CDN}${pinnedUrlPath}`;\n        await cacache.put(RESOURCE_CACHE, pinnedUrl, body, {\n            metadata: { pinnedUrl, typesUrl },\n        });\n        return pinnedUrl;\n    }\n    if (buildStatus === 'SUCCESS') {\n        console.warn(`Failed to lookup [${statusCode}]: ${installUrl}`);\n        console.warn(`Falling back to local copy...`);\n        return null;\n    }\n    if (!canRetry || buildStatus === 'FAIL') {\n        console.warn(`Failed to build: ${installSpecifier}@${packageSemver}`);\n        console.warn(`Falling back to local copy...`);\n        return null;\n    }\n    console.log(chalk.cyan(`Building ${installSpecifier}@${packageSemver}... (This takes a moment, but will be cached for future use)`));\n    if (!importUrlPath) {\n        throw new Error('X-Import-URL header expected, but none received.');\n    }\n    const { statusCode: lookupStatusCode } = await fetchCDNResource(importUrlPath);\n    if (lookupStatusCode !== 200) {\n        throw new Error(`Unexpected response [${lookupStatusCode}]: ${PIKA_CDN}${importUrlPath}`);\n    }\n    return resolveDependency(installSpecifier, packageSemver, lockfile, false);\n}\nexport async function resolveTargetsFromRemoteCDN(lockfile, pkgManifest, config) {\n    const downloadQueue = new PQueue({ concurrency: 16 });\n    const newLockfile = { imports: {} };\n    let resolutionError;\n    for (const [installSpecifier, installSemver] of Object.entries(config.webDependencies)) {\n        downloadQueue.add(async () => {\n            try {\n                const resolvedUrl = await resolveDependency(installSpecifier, installSemver, lockfile);\n                if (resolvedUrl) {\n                    newLockfile.imports[installSpecifier] = resolvedUrl;\n                }\n            }\n            catch (err) {\n                resolutionError = resolutionError || err;\n            }\n        });\n    }\n    await downloadQueue.onIdle();\n    if (resolutionError) {\n        throw resolutionError;\n    }\n    return newLockfile;\n}\nexport function clearCache() {\n    return cacache.rm.all(RESOURCE_CACHE);\n}\n","import path from 'path';\nimport { resolveDependencyManifest } from './util';\nconst IS_DEEP_PACKAGE_IMPORT = /^(@[\\w-]+\\/)?([\\w-]+)\\/(.*)/;\n/**\n * rollup-plugin-entrypoint-alias\n *\n * Aliases any deep imports from a package to the package name, so that\n * chunking can happen more accurately.\n *\n * Example: lit-element imports from both 'lit-html' & 'lit-html/lit-html.js'.\n * Even though both eventually resolve to the same place, without this plugin\n * we lose the ability to mark \"lit-html\" as an external package.\n */\nexport function rollupPluginEntrypointAlias({ cwd }) {\n    return {\n        name: 'snowpack:rollup-plugin-entrypoint-alias',\n        resolveId(source, importer) {\n            if (!IS_DEEP_PACKAGE_IMPORT.test(source)) {\n                return null;\n            }\n            const [, packageScope, packageName] = source.match(IS_DEEP_PACKAGE_IMPORT);\n            const packageFullName = packageScope ? `${packageScope}${packageName}` : packageName;\n            const [, manifest] = resolveDependencyManifest(packageFullName, cwd);\n            if (!manifest) {\n                return null;\n            }\n            let needsAlias = (typeof manifest.module === 'string' &&\n                source === path.posix.join(packageFullName, manifest.module)) ||\n                (typeof manifest.browser === 'string' &&\n                    source === path.posix.join(packageFullName, manifest.browser)) ||\n                (typeof manifest.main === 'string' &&\n                    source === path.posix.join(packageFullName, manifest.main));\n            if (!needsAlias) {\n                return null;\n            }\n            return this.resolve(packageFullName, importer, { skipSelf: true }).then((resolved) => {\n                return resolved || null;\n            });\n        },\n    };\n}\n","import mkdirp from 'mkdirp';\nimport cacache from 'cacache';\nimport url from 'url';\nimport fs from 'fs';\nimport path from 'path';\nimport tar from 'tar';\nimport { fetchCDNResource, HAS_CDN_HASH_REGEX, PIKA_CDN, RESOURCE_CACHE } from './util';\nconst CACHED_FILE_ID_PREFIX = 'snowpack-pkg-cache:';\nconst PIKA_CDN_TRIM_LENGTH = PIKA_CDN.length;\n/**\n * rollup-plugin-remote-cdn\n *\n * Load import URLs from a remote CDN, sitting behind a local cache. The local\n * cache acts as a go-between for the resolve & load step: when we get back a\n * successful CDN resolution, we save the file to the local cache and then tell\n * rollup that it's safe to load from the cache in the `load()` hook.\n */\nexport function rollupPluginDependencyCache({ installTypes, log, }) {\n    const allTypesToInstall = new Set();\n    return {\n        name: 'snowpack:rollup-plugin-remote-cdn',\n        async resolveId(source, importer) {\n            let cacheKey;\n            if (source.startsWith(PIKA_CDN)) {\n                cacheKey = source;\n            }\n            else if (source.startsWith('/-/')) {\n                cacheKey = PIKA_CDN + source;\n            }\n            else if (source.startsWith('/pin/')) {\n                cacheKey = PIKA_CDN + source;\n            }\n            else {\n                return null;\n            }\n            // If the source path is a CDN path including a hash, it's assumed the\n            // file will never change and it is safe to pull from our local cache\n            // without a network request.\n            log(cacheKey);\n            if (HAS_CDN_HASH_REGEX.test(cacheKey)) {\n                const cachedResult = await cacache.get\n                    .info(RESOURCE_CACHE, cacheKey)\n                    .catch(( /* ignore */) => null);\n                if (cachedResult) {\n                    return CACHED_FILE_ID_PREFIX + cacheKey;\n                }\n            }\n            // Otherwise, make the remote request and cache the file on success.\n            const response = await fetchCDNResource(cacheKey);\n            if (response.statusCode === 200) {\n                const typesUrlPath = response.headers['x-typescript-types'];\n                const pinnedUrlPath = response.headers['x-pinned-url'];\n                const typesUrl = typesUrlPath && `${PIKA_CDN}${typesUrlPath}`;\n                const pinnedUrl = pinnedUrlPath && `${PIKA_CDN}${pinnedUrlPath}`;\n                await cacache.put(RESOURCE_CACHE, cacheKey, response.body, {\n                    metadata: { pinnedUrl, typesUrl },\n                });\n                return CACHED_FILE_ID_PREFIX + cacheKey;\n            }\n            // If lookup failed, skip this plugin and resolve the import locally instead.\n            // TODO: Log that this has happened (if some sort of verbose mode is enabled).\n            const packageName = cacheKey\n                .substring(PIKA_CDN_TRIM_LENGTH)\n                .replace('/-/', '')\n                .replace('/pin/', '')\n                .split('@')[0];\n            return this.resolve(packageName, importer, { skipSelf: true }).then((resolved) => {\n                let finalResult = resolved;\n                if (!finalResult) {\n                    finalResult = { id: packageName };\n                }\n                return finalResult;\n            });\n        },\n        async load(id) {\n            if (!id.startsWith(CACHED_FILE_ID_PREFIX)) {\n                return null;\n            }\n            const cacheKey = id.substring(CACHED_FILE_ID_PREFIX.length);\n            log(cacheKey);\n            const cachedResult = await cacache.get(RESOURCE_CACHE, cacheKey);\n            const typesUrl = cachedResult.metadata?.typesUrl;\n            if (typesUrl && installTypes) {\n                const typesTarballUrl = typesUrl.replace(/(mode=types.*?)\\/.*/, '$1/all.tgz');\n                allTypesToInstall.add(typesTarballUrl);\n            }\n            return cachedResult.data.toString('utf8');\n        },\n        async writeBundle(options) {\n            if (!installTypes) {\n                return;\n            }\n            await mkdirp(path.join(options.dir, '.types'));\n            const tempDir = await cacache.tmp.mkdir(RESOURCE_CACHE);\n            for (const typesTarballUrl of allTypesToInstall) {\n                let tarballContents;\n                const cachedTarball = await cacache\n                    .get(RESOURCE_CACHE, typesTarballUrl)\n                    .catch(( /* ignore */) => null);\n                if (cachedTarball) {\n                    tarballContents = cachedTarball.data;\n                }\n                else {\n                    const tarballResponse = await fetchCDNResource(typesTarballUrl, 'buffer');\n                    if (tarballResponse.statusCode !== 200) {\n                        continue;\n                    }\n                    tarballContents = tarballResponse.body;\n                    await cacache.put(RESOURCE_CACHE, typesTarballUrl, tarballContents);\n                }\n                const typesUrlParts = url.parse(typesTarballUrl).pathname.split('/');\n                const typesPackageName = url.parse(typesTarballUrl).pathname.startsWith('/-/@')\n                    ? typesUrlParts[2] + '/' + typesUrlParts[3].split('@')[0]\n                    : typesUrlParts[2].split('@')[0];\n                fs.writeFileSync(path.join(tempDir, `${typesPackageName}.tgz`), tarballContents);\n                const typesPackageLoc = path.join(options.dir, `.types/${typesPackageName}`);\n                await mkdirp(typesPackageLoc);\n                await tar.x({\n                    file: path.join(tempDir, `${typesPackageName}.tgz`),\n                    cwd: typesPackageLoc,\n                });\n            }\n        },\n    };\n}\n","import fs from 'fs';\nimport path from 'path';\nimport zlib from 'zlib';\nexport function rollupPluginDependencyStats(cb) {\n    let outputDir;\n    let existingFileCache = {};\n    let statsSummary = {\n        direct: {},\n        common: {},\n    };\n    function buildExistingFileCache(bundle) {\n        for (let fileName of Object.keys(bundle)) {\n            const filePath = path.join(outputDir, fileName);\n            if (fs.existsSync(filePath)) {\n                const { size } = fs.statSync(filePath);\n                existingFileCache[fileName] = size;\n            }\n        }\n    }\n    function compareDependencies(files, type) {\n        for (let { fileName, contents } of files) {\n            const size = contents.byteLength;\n            statsSummary[type][fileName] = {\n                size: size,\n                gzip: zlib.gzipSync(contents).byteLength,\n                brotli: zlib.brotliCompressSync(contents).byteLength,\n            };\n            if (existingFileCache[fileName]) {\n                const delta = (size - existingFileCache[fileName]) / 1000;\n                statsSummary[type][fileName].delta = delta;\n            }\n        }\n    }\n    return {\n        name: 'snowpack:rollup-plugin-stats',\n        generateBundle(options, bundle) {\n            outputDir = options.dir;\n            buildExistingFileCache(bundle);\n        },\n        writeBundle(options, bundle) {\n            const directDependencies = [];\n            const commonDependencies = [];\n            for (const [fileName, assetOrChunk] of Object.entries(bundle)) {\n                const raw = assetOrChunk.type === 'asset' ? assetOrChunk.source : assetOrChunk.code;\n                const contents = Buffer.isBuffer(raw)\n                    ? raw\n                    : typeof raw === 'string'\n                        ? Buffer.from(raw, 'utf8')\n                        : Buffer.from(raw);\n                if (fileName.startsWith('common')) {\n                    commonDependencies.push({ fileName, contents });\n                }\n                else {\n                    directDependencies.push({ fileName, contents });\n                }\n            }\n            compareDependencies(directDependencies, 'direct');\n            compareDependencies(commonDependencies, 'common');\n            cb(statsSummary);\n        },\n    };\n}\n","import babel from '@babel/core';\nimport chalk from 'chalk';\nimport nodePath from 'path';\nimport fs from 'fs';\nimport glob from 'glob';\nimport mime from 'mime-types';\nimport validatePackageName from 'validate-npm-package-name';\nimport { init as initESModuleLexer, parse } from 'es-module-lexer';\nimport { isTruthy } from './util';\nconst WEB_MODULES_TOKEN = 'web_modules/';\nconst WEB_MODULES_TOKEN_LENGTH = WEB_MODULES_TOKEN.length;\n// [@\\w] - Match a word-character or @ (valid package name)\n// (?!.*(:\\/\\/)) - Ignore if previous match was a protocol (ex: http://)\nconst BARE_SPECIFIER_REGEX = /^[@\\w](?!.*(:\\/\\/))/;\nconst HAS_NAMED_IMPORTS_REGEX = /^[\\w\\s\\,]*\\{(.*)\\}/s;\nconst SPLIT_NAMED_IMPORTS_REGEX = /\\bas\\s+\\w+|,/s;\nconst DEFAULT_IMPORT_REGEX = /import\\s+(\\w)+(,\\s\\{[\\w\\s]*\\})?\\s+from/s;\nconst HTML_JS_REGEX = /<script.*?>(.*)<\\/script>/gm;\nfunction stripJsExtension(dep) {\n    return dep.replace(/\\.m?js$/i, '');\n}\nfunction createInstallTarget(specifier, all = true) {\n    return {\n        specifier,\n        all,\n        default: false,\n        namespace: false,\n        named: [],\n    };\n}\nfunction removeSpecifierQueryString(specifier) {\n    const queryStringIndex = specifier.indexOf('?');\n    if (queryStringIndex >= 0) {\n        specifier = specifier.substring(0, queryStringIndex);\n    }\n    return specifier;\n}\nfunction getWebModuleSpecifierFromCode(code, imp) {\n    // import.meta: we can ignore\n    if (imp.d === -2) {\n        return null;\n    }\n    // Static imports: easy to parse\n    if (imp.d === -1) {\n        return code.substring(imp.s, imp.e);\n    }\n    // Dynamic imports: a bit trickier to parse. Today, we only support string literals.\n    const importStatement = code.substring(imp.s, imp.e);\n    const importSpecifierMatch = importStatement.match(/^\\s*['\"](.*)['\"]\\s*$/m);\n    return importSpecifierMatch ? importSpecifierMatch[1] : null;\n}\n/**\n * parses an import specifier, looking for a web modules to install. If a web module is not detected,\n * null is returned.\n */\nfunction parseWebModuleSpecifier(specifier) {\n    if (!specifier) {\n        return null;\n    }\n    // If specifier is a \"bare module specifier\" (ie: package name) just return it directly\n    if (BARE_SPECIFIER_REGEX.test(specifier)) {\n        return specifier;\n    }\n    // Clean the specifier, remove any query params that may mess with matching\n    const cleanedSpecifier = removeSpecifierQueryString(specifier);\n    // Otherwise, check that it includes the \"web_modules/\" directory\n    const webModulesIndex = cleanedSpecifier.indexOf(WEB_MODULES_TOKEN);\n    if (webModulesIndex === -1) {\n        return null;\n    }\n    // Check if this matches `@scope/package.js` or `package.js` format.\n    // If it is, assume that this is a top-level pcakage that should be installed without the “.js”\n    const resolvedSpecifier = cleanedSpecifier.substring(webModulesIndex + WEB_MODULES_TOKEN_LENGTH);\n    const resolvedSpecifierWithoutExtension = stripJsExtension(resolvedSpecifier);\n    if (validatePackageName(resolvedSpecifierWithoutExtension).validForNewPackages) {\n        return resolvedSpecifierWithoutExtension;\n    }\n    // Otherwise, this is an explicit import to a file within a package.\n    return resolvedSpecifier;\n}\nfunction parseImportStatement(code, imp) {\n    const webModuleSpecifier = parseWebModuleSpecifier(getWebModuleSpecifierFromCode(code, imp));\n    if (!webModuleSpecifier) {\n        return null;\n    }\n    const importStatement = code.substring(imp.ss, imp.se);\n    if (/^import\\s+type/.test(importStatement)) {\n        return null;\n    }\n    const dynamicImport = imp.d > -1;\n    const defaultImport = !dynamicImport && DEFAULT_IMPORT_REGEX.test(importStatement);\n    const namespaceImport = !dynamicImport && importStatement.includes('*');\n    const namedImports = (importStatement.match(HAS_NAMED_IMPORTS_REGEX) || [, ''])[1]\n        .split(SPLIT_NAMED_IMPORTS_REGEX)\n        .map((name) => name.trim())\n        .filter(isTruthy);\n    return {\n        specifier: webModuleSpecifier,\n        all: dynamicImport,\n        default: defaultImport,\n        namespace: namespaceImport,\n        named: namedImports,\n    };\n}\nfunction getInstallTargetsForFile(code) {\n    const [imports] = parse(code) || [];\n    const allImports = imports\n        .map((imp) => parseImportStatement(code, imp))\n        .filter(isTruthy);\n    return allImports;\n}\nexport function scanDepList(depList, cwd) {\n    return depList\n        .map((whitelistItem) => {\n        if (!glob.hasMagic(whitelistItem)) {\n            return [createInstallTarget(whitelistItem, true)];\n        }\n        else {\n            const nodeModulesLoc = nodePath.join(cwd, 'node_modules');\n            return scanDepList(glob.sync(whitelistItem, { cwd: nodeModulesLoc, nodir: true }), cwd);\n        }\n    })\n        .reduce((flat, item) => flat.concat(item), []);\n}\nexport async function scanImports({ include, exclude }) {\n    await initESModuleLexer;\n    const includeFiles = glob.sync(`**/*`, {\n        ignore: exclude,\n        cwd: include,\n        absolute: true,\n        nodir: true,\n    });\n    if (!includeFiles.length) {\n        console.warn(`[SCAN ERROR]: No files matching \"${include}\"`);\n        return [];\n    }\n    // Scan every matched JS file for web dependency imports\n    const loadedFiles = await Promise.all(includeFiles.map(async (filePath) => {\n        // Our import scanner can handle normal JS & even TypeScript without a problem.\n        if (filePath.endsWith('.js') || filePath.endsWith('.mjs') || filePath.endsWith('.ts')) {\n            return fs.promises.readFile(filePath, 'utf-8');\n        }\n        // JSX breaks our import scanner, so we need to transform it before sending it to our scanner.\n        if (filePath.endsWith('.jsx') || filePath.endsWith('.tsx')) {\n            const result = await babel.transformFileAsync(filePath, {\n                plugins: [\n                    [require('@babel/plugin-transform-react-jsx'), { runtime: 'classic' }],\n                    [require('@babel/plugin-syntax-typescript'), { isTSX: true }],\n                ],\n                babelrc: false,\n                configFile: false,\n            });\n            return result && result.code;\n        }\n        if (filePath.endsWith('.vue') || filePath.endsWith('.svelte')) {\n            const result = await fs.promises.readFile(filePath, 'utf-8');\n            // TODO: Replace with matchAll once Node v10 is out of TLS.\n            // const allMatches = [...result.matchAll(HTML_JS_REGEX)];\n            const allMatches = [];\n            let match;\n            while ((match = HTML_JS_REGEX.exec(result))) {\n                allMatches.push(match);\n            }\n            return allMatches.map((full, code) => code).join('\\n');\n        }\n        // If we don't recognize the file type, it could be source. Warn just in case.\n        if (!mime.lookup(nodePath.extname(filePath))) {\n            console.warn(chalk.dim(`ignoring unsupported file \"${nodePath.relative(process.cwd(), filePath)}\"`));\n        }\n        return null;\n    }));\n    return loadedFiles\n        .filter((code) => !!code)\n        .map((code) => getInstallTargetsForFile(code))\n        .reduce((flat, item) => flat.concat(item), [])\n        .sort((impA, impB) => impA.specifier.localeCompare(impB.specifier));\n}\n","import chalk from 'chalk';\n/** The minimum width, in characters, of each size column */\nconst SIZE_COLUMN_WIDTH = 11;\n/** Generic Object.entries() alphabetical sort by keys. */\nfunction entriesSort([filenameA], [filenameB]) {\n    return filenameA.localeCompare(filenameB);\n}\n/** Pretty-prints number of bytes as \"XXX KB\" */\nfunction formatSize(size) {\n    let kb = Math.round((size / 1000) * 100) / 100;\n    if (kb >= 1000) {\n        kb = Math.floor(kb);\n    }\n    let color;\n    if (kb < 15) {\n        color = 'green';\n    }\n    else if (kb < 30) {\n        color = 'yellow';\n    }\n    else {\n        color = 'red';\n    }\n    return chalk[color](`${kb} KB`.padEnd(SIZE_COLUMN_WIDTH));\n}\nfunction formatDelta(delta) {\n    const kb = Math.round(delta * 100) / 100;\n    const color = delta > 0 ? 'red' : 'green';\n    return chalk[color](`Δ ${delta > 0 ? '+' : ''}${kb} KB`);\n}\nfunction formatFileInfo(filename, stats, padEnd, isLastFile) {\n    const lineGlyph = chalk.dim(isLastFile ? '└─' : '├─');\n    const lineName = filename.padEnd(padEnd);\n    const fileStat = formatSize(stats.size);\n    const gzipStat = formatSize(stats.gzip);\n    const brotliStat = formatSize(stats.brotli);\n    const lineStat = fileStat + gzipStat + brotliStat;\n    let lineDelta = '';\n    if (stats.delta) {\n        lineDelta = chalk.dim('[') + formatDelta(stats.delta) + chalk.dim(']');\n    }\n    // Trim trailing whitespace (can mess with formatting), but keep indentation.\n    return `    ` + `${lineGlyph} ${lineName} ${lineStat} ${lineDelta}`.trim();\n}\nfunction formatFiles(files, padEnd) {\n    const strippedFiles = files.map(([filename, stats]) => [\n        filename.replace(/^common\\//, ''),\n        stats,\n    ]);\n    return strippedFiles\n        .map(([filename, stats], index) => formatFileInfo(filename, stats, padEnd, index >= files.length - 1))\n        .join('\\n');\n}\nexport function printStats(dependencyStats) {\n    let output = '';\n    const { direct, common } = dependencyStats;\n    const allDirect = Object.entries(direct).sort(entriesSort);\n    const allCommon = Object.entries(common).sort(entriesSort);\n    const maxFileNameLength = [...allCommon, ...allDirect].reduce((max, [filename]) => Math.max(filename.length, max), 'web_modules/'.length) + 1;\n    output +=\n        `  ⦿ ${chalk.bold('web_modules/'.padEnd(maxFileNameLength + 4))}` +\n            chalk.bold.underline('size'.padEnd(SIZE_COLUMN_WIDTH - 2)) +\n            '  ' +\n            chalk.bold.underline('gzip'.padEnd(SIZE_COLUMN_WIDTH - 2)) +\n            '  ' +\n            chalk.bold.underline('brotli'.padEnd(SIZE_COLUMN_WIDTH - 2)) +\n            `\\n`;\n    output += `${formatFiles(allDirect, maxFileNameLength)}\\n`;\n    if (Object.values(common).length > 0) {\n        output += `  ⦿ ${chalk.bold('web_modules/common/ (Shared)')}\\n`;\n        output += `${formatFiles(allCommon, maxFileNameLength)}\\n`;\n    }\n    return `\\n${output}\\n`;\n}\n","import rollupPluginAlias from '@rollup/plugin-alias';\nimport rollupPluginCommonjs from '@rollup/plugin-commonjs';\nimport rollupPluginJson from '@rollup/plugin-json';\nimport rollupPluginNodeResolve from '@rollup/plugin-node-resolve';\nimport rollupPluginReplace from '@rollup/plugin-replace';\nimport chalk from 'chalk';\nimport fs from 'fs';\nimport isNodeBuiltin from 'is-builtin-module';\nimport mkdirp from 'mkdirp';\nimport ora from 'ora';\nimport path from 'path';\nimport rimraf from 'rimraf';\nimport { rollup } from 'rollup';\nimport validatePackageName from 'validate-npm-package-name';\nimport yargs from 'yargs-parser';\nimport { command as buildCommand } from './commands/build';\nimport { command as devCommand } from './commands/dev';\nimport { loadAndValidateConfig } from './config.js';\nimport { clearCache, resolveTargetsFromRemoteCDN } from './resolve-remote.js';\nimport { rollupPluginEntrypointAlias } from './rollup-plugin-entrypoint-alias.js';\nimport { rollupPluginDependencyCache } from './rollup-plugin-remote-cdn.js';\nimport { rollupPluginDependencyStats } from './rollup-plugin-stats.js';\nimport { scanDepList, scanImports } from './scan-imports.js';\nimport { printStats } from './stats-formatter.js';\nimport { isTruthy, MISSING_PLUGIN_SUGGESTIONS, readLockfile, resolveDependencyManifest, writeLockfile, } from './util.js';\nconst ALWAYS_SHOW_ERRORS = new Set(['react', 'react-dom']);\nconst cwd = process.cwd();\nconst banner = chalk.bold(`snowpack`) + ` installing... `;\nconst installResults = [];\nlet dependencyStats = null;\nlet spinner = ora(banner);\nlet spinnerHasError = false;\nfunction printHelp() {\n    console.log(`\n${chalk.bold(`snowpack`)} - Install npm dependencies to run natively on the web.\n${chalk.bold('Options:')}\n  --dest [path]             Specify destination directory (default: \"web_modules/\").\n  --clean                   Clear out the destination directory before install.\n  --optimize                Transpile, minify, and optimize installed dependencies for production.\n  --env                     Set environment variable(s) inside dependencies:\n                                - if only NAME given, reads value from real env var\n                                - if \\`NAME=value\\`, uses given value\n                                - NODE_ENV defaults to \"production\" with \"--optimize\" (overridable)\n  --babel                   Transpile installed dependencies. Also enabled with \"--optimize\".\n  --include [glob]          Auto-detect imports from file(s). Supports glob.\n  --exclude [glob]          Exclude files from --include. Follows glob’s ignore pattern.\n  --config [path]           Location of Snowpack config file.\n  --strict                  Only install pure ESM dependency trees. Fail if a CJS module is encountered.\n  --no-source-map           Skip emitting source map files (.js.map) into dest\n  --stat                    Logs install statistics after installing, with information on install targets and file sizes. Useful for CI, performance review.\n  --nomodule [path]         Your app’s entry file for generating a <script nomodule> bundle\n  --nomodule-output [path]  Filename for nomodule output (default: \"app.nomodule.js\")\n    ${chalk.bold('Advanced:')}\n  --external-package [val]  Internal use only, may be removed at any time.\n    `.trim());\n}\nfunction formatInstallResults() {\n    return installResults\n        .map(([d, result]) => {\n        if (result === 'SUCCESS') {\n            return chalk.green(d);\n        }\n        if (result === 'ASSET') {\n            return chalk.yellow(d);\n        }\n        if (result === 'FAIL') {\n            return chalk.red(d);\n        }\n        return d;\n    })\n        .join(', ');\n}\nfunction logError(msg) {\n    if (!spinnerHasError) {\n        spinner.stopAndPersist({ symbol: chalk.cyan('⠼') });\n    }\n    spinnerHasError = true;\n    spinner = ora(chalk.red(msg));\n    spinner.fail();\n}\nfunction logUpdate(msg) {\n    spinner.text = banner + msg;\n}\nclass ErrorWithHint extends Error {\n    constructor(message, hint) {\n        super(message);\n        this.hint = hint;\n    }\n}\n// Add common, well-used non-esm packages here so that Rollup doesn't die trying to analyze them.\nconst PACKAGES_TO_AUTO_DETECT_EXPORTS = [\n    path.join('react', 'index.js'),\n    path.join('react-dom', 'index.js'),\n    'react-is',\n    'prop-types',\n    'scheduler',\n    'rxjs',\n    'exenv',\n    'body-scroll-lock',\n];\nfunction detectExports(filePath) {\n    try {\n        const fileLoc = require.resolve(filePath, { paths: [cwd] });\n        if (fs.existsSync(fileLoc)) {\n            return Object.keys(require(fileLoc)).filter((e) => e[0] !== '_');\n        }\n    }\n    catch (err) {\n        // ignore\n    }\n}\n/**\n * Resolve a \"webDependencies\" input value to the correct absolute file location.\n * Supports both npm package names, and file paths relative to the node_modules directory.\n * Follows logic similar to Node's resolution logic, but using a package.json's ESM \"module\"\n * field instead of the CJS \"main\" field.\n */\nfunction resolveWebDependency(dep, isExplicit) {\n    // if dep includes a file extension, check that dep isn't a package before returning\n    if (path.extname(dep) && !validatePackageName(dep).validForNewPackages) {\n        const isJSFile = ['.js', '.mjs', '.cjs'].includes(path.extname(dep));\n        return {\n            type: isJSFile ? 'JS' : 'ASSET',\n            loc: require.resolve(dep, { paths: [cwd] }),\n        };\n    }\n    const [depManifestLoc, depManifest] = resolveDependencyManifest(dep, cwd);\n    if (!depManifest) {\n        throw new ErrorWithHint(`\"${dep}\" not found. Have you installed the package via npm?`, depManifestLoc && chalk.italic(depManifestLoc));\n    }\n    if (depManifest.name &&\n        (depManifest.name.startsWith('@reactesm') || depManifest.name.startsWith('@pika/react'))) {\n        throw new Error(`React workaround packages no longer needed! Revert back to the official React & React-DOM packages.`);\n    }\n    let foundEntrypoint = depManifest['browser:module'] ||\n        depManifest.module ||\n        depManifest['main:esnext'] ||\n        depManifest.browser;\n    // Some packages define \"browser\" as an object. We'll do our best to find the\n    // right entrypoint in an entrypoint object, or fail otherwise.\n    // See: https://github.com/defunctzombie/package-browser-field-spec\n    if (typeof foundEntrypoint === 'object') {\n        foundEntrypoint =\n            foundEntrypoint[dep] ||\n                foundEntrypoint['./index.js'] ||\n                foundEntrypoint['./index'] ||\n                foundEntrypoint['./'] ||\n                foundEntrypoint['.'];\n    }\n    // If the package was a part of the explicit whitelist, fallback to it's main CJS entrypoint.\n    if (!foundEntrypoint && isExplicit) {\n        foundEntrypoint = depManifest.main || 'index.js';\n    }\n    if (dep === 'react' && (!foundEntrypoint || foundEntrypoint === 'index.js')) {\n        foundEntrypoint = 'umd/react.production.min.js';\n    }\n    if (dep === 'react-dom' && (!foundEntrypoint || foundEntrypoint === 'index.js')) {\n        foundEntrypoint = 'umd/react-dom.production.min.js';\n    }\n    if (typeof foundEntrypoint !== 'string') {\n        throw new Error(`\"${dep}\" has unexpected entrypoint: ${JSON.stringify(foundEntrypoint)}.`);\n    }\n    return {\n        type: 'JS',\n        loc: path.join(depManifestLoc, '..', foundEntrypoint),\n    };\n}\n/**\n * Formats the snowpack dependency name from a \"webDependencies\" input value:\n * 2. Remove any \".js\"/\".mjs\" extension (will be added automatically by Rollup)\n */\nfunction getWebDependencyName(dep) {\n    return dep.replace(/\\.m?js$/i, '');\n}\n/**\n * Takes object of env var mappings and converts it to actual\n * replacement specs as expected by @rollup/plugin-replace. The\n * `optimize` arg is used to derive NODE_ENV default.\n *\n * @param env\n * @param optimize\n */\nfunction getRollupReplaceKeys(env) {\n    const result = Object.keys(env).reduce((acc, id) => {\n        const val = env[id];\n        acc[`process.env.${id}`] = `${JSON.stringify(val === true ? process.env[id] : val)}`;\n        return acc;\n    }, {\n        'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV || 'production'),\n        'process.env.': '({}).',\n    });\n    return result;\n}\nexport async function install(installTargets, { hasBrowserlistConfig, lockfile }, config) {\n    const { webDependencies, installOptions: { installTypes, dest: destLoc, externalPackage: externalPackages, alias: installAlias, sourceMap, env, }, rollup: userDefinedRollup, devOptions: { hot }, } = config;\n    const knownNamedExports = { ...userDefinedRollup.namedExports };\n    for (const filePath of PACKAGES_TO_AUTO_DETECT_EXPORTS) {\n        knownNamedExports[filePath] = knownNamedExports[filePath] || detectExports(filePath) || [];\n    }\n    if (!webDependencies && !fs.existsSync(path.join(cwd, 'node_modules'))) {\n        logError('no \"node_modules\" directory exists. Did you run \"npm install\" first?');\n        return;\n    }\n    const allInstallSpecifiers = new Set(installTargets\n        .map((dep) => dep.specifier)\n        .map((specifier) => installAlias[specifier] || specifier)\n        .sort());\n    const installEntrypoints = {};\n    const assetEntrypoints = {};\n    const importMap = { imports: {} };\n    const installTargetsMap = {};\n    const skipFailures = false;\n    for (const installSpecifier of allInstallSpecifiers) {\n        const targetName = getWebDependencyName(installSpecifier);\n        if (lockfile && lockfile.imports[installSpecifier]) {\n            installEntrypoints[targetName] = lockfile.imports[installSpecifier];\n            importMap.imports[installSpecifier] = `./${targetName}.js`;\n            installResults.push([targetName, 'SUCCESS']);\n            logUpdate(formatInstallResults());\n            continue;\n        }\n        try {\n            const { type: targetType, loc: targetLoc } = resolveWebDependency(installSpecifier, true);\n            if (targetType === 'JS') {\n                installEntrypoints[targetName] = targetLoc;\n                importMap.imports[installSpecifier] = `./${targetName}.js`;\n                Object.entries(installAlias)\n                    .filter(([key, value]) => value === installSpecifier)\n                    .forEach(([key, value]) => {\n                    importMap.imports[key] = `./${targetName}.js`;\n                });\n                installTargetsMap[targetLoc] = installTargets.filter((t) => installSpecifier === t.specifier);\n                installResults.push([installSpecifier, 'SUCCESS']);\n            }\n            else if (targetType === 'ASSET') {\n                assetEntrypoints[targetName] = targetLoc;\n                installResults.push([installSpecifier, 'ASSET']);\n            }\n            logUpdate(formatInstallResults());\n        }\n        catch (err) {\n            installResults.push([installSpecifier, 'FAIL']);\n            logUpdate(formatInstallResults());\n            if (skipFailures && !ALWAYS_SHOW_ERRORS.has(installSpecifier)) {\n                continue;\n            }\n            // An error occurred! Log it.\n            logError(err.message || err);\n            if (err.hint) {\n                // Note: Wait 1ms to guarantee a log message after the spinner\n                setTimeout(() => console.log(err.hint), 1);\n            }\n            return false;\n        }\n    }\n    if (Object.keys(installEntrypoints).length === 0 && Object.keys(assetEntrypoints).length === 0) {\n        logError(`No ESM dependencies found!`);\n        console.log(chalk.dim(`  At least one dependency must have an ESM \"module\" entrypoint. You can find modern, web-ready packages at ${chalk.underline('https://www.pika.dev')}`));\n        return false;\n    }\n    const inputOptions = {\n        input: installEntrypoints,\n        external: externalPackages,\n        treeshake: { moduleSideEffects: 'no-external' },\n        plugins: [\n            rollupPluginReplace(getRollupReplaceKeys(env)),\n            rollupPluginEntrypointAlias({ cwd }),\n            !!webDependencies &&\n                rollupPluginDependencyCache({\n                    installTypes,\n                    log: (url) => logUpdate(chalk.dim(url)),\n                }),\n            rollupPluginAlias({\n                entries: Object.entries(installAlias).map(([alias, mod]) => ({\n                    find: alias,\n                    replacement: mod,\n                })),\n            }),\n            rollupPluginNodeResolve({\n                mainFields: ['browser:module', 'module', 'browser', 'main'].filter(isTruthy),\n                extensions: ['.mjs', '.cjs', '.js', '.json'],\n                // whether to prefer built-in modules (e.g. `fs`, `path`) or local ones with the same names\n                preferBuiltins: false,\n                dedupe: userDefinedRollup.dedupe,\n            }),\n            rollupPluginJson({\n                preferConst: true,\n                indent: '  ',\n                compact: false,\n                namedExports: true,\n            }),\n            rollupPluginCommonjs({\n                extensions: ['.js', '.cjs'],\n                namedExports: knownNamedExports,\n            }),\n            rollupPluginDependencyStats((info) => (dependencyStats = info)),\n            ...userDefinedRollup.plugins,\n        ].filter(Boolean),\n        onwarn(warning, warn) {\n            if (warning.code === 'UNRESOLVED_IMPORT') {\n                logError(`'${warning.source}' is imported by '${warning.importer}', but could not be resolved.`);\n                if (isNodeBuiltin(warning.source)) {\n                    console.log(chalk.dim(`  '${warning.source}' is a Node.js builtin module that won't exist in the browser.`));\n                    console.log(chalk.dim(`  Find a more web-friendly alternative, or add the \"rollup-plugin-node-polyfills\" plugin to your Snowpack config file.`));\n                }\n                else {\n                    console.log(chalk.dim(`  Make sure that the package is installed and that the file exists.`));\n                }\n                return;\n            }\n            warn(warning);\n        },\n    };\n    const outputOptions = {\n        dir: destLoc,\n        format: 'system',\n        sourcemap: sourceMap,\n        exports: 'named',\n        chunkFileNames: 'common/[name]-[hash].js',\n    };\n    if (Object.keys(installEntrypoints).length > 0) {\n        try {\n            const packageBundle = await rollup(inputOptions);\n            logUpdate(formatInstallResults());\n            await packageBundle.write(outputOptions);\n        }\n        catch (err) {\n            const { loc } = err;\n            if (!loc || !loc.file) {\n                throw err;\n            }\n            // NOTE: Rollup will fail instantly on error. Because of that, we can\n            // only report one error at a time. `err.watchFiles` also exists, but\n            // for now `err.loc.file` has all the information that we need.\n            const failedExtension = path.extname(loc.file);\n            const suggestion = MISSING_PLUGIN_SUGGESTIONS[failedExtension];\n            if (!suggestion) {\n                throw err;\n            }\n            // Display posix-style on all environments, mainly to help with CI :)\n            const fileName = loc.file.replace(cwd + path.sep, '').replace(/\\\\/g, '/');\n            logError(`${chalk.bold('snowpack')} could not import ${fileName}. ${suggestion}`);\n            return;\n        }\n    }\n    await writeLockfile(path.join(destLoc, 'import-map.json'), importMap);\n    Object.entries(assetEntrypoints).forEach(([assetName, assetLoc]) => {\n        mkdirp.sync(path.dirname(`${destLoc}/${assetName}`));\n        fs.copyFileSync(assetLoc, `${destLoc}/${assetName}`);\n    });\n    return true;\n}\nexport async function cli(args) {\n    // parse CLI flags\n    const cliFlags = yargs(args, { array: ['env', 'exclude', 'externalPackage'] });\n    // if printing help, stop here\n    if (cliFlags.help) {\n        printHelp();\n        process.exit(0);\n    }\n    if (cliFlags.reload) {\n        console.log(`${chalk.yellow('ℹ')} clearing CDN cache...`);\n        await clearCache();\n    }\n    if (cliFlags['_'].length > 3) {\n        console.log(`Unexpected multiple commands`);\n        process.exit(1);\n    }\n    // Load the current package manifest\n    let pkgManifest;\n    try {\n        pkgManifest = require(path.join(cwd, 'package.json'));\n    }\n    catch (err) {\n        console.log(chalk.red('[ERROR] package.json required but no file was found.'));\n        process.exit(1);\n    }\n    // load config\n    const config = loadAndValidateConfig(cliFlags, pkgManifest);\n    // load lockfile\n    let lockfile = await readLockfile(cwd);\n    let newLockfile = null;\n    if (cliFlags['_'][2] === 'build') {\n        await buildCommand({\n            cwd,\n            config,\n        });\n        return;\n    }\n    if (cliFlags['_'][2] === 'dev') {\n        await devCommand({\n            cwd,\n            port: cliFlags.port || 3000,\n            config,\n            hot: cliFlags.hot || config.dev.hot,\n        });\n        return;\n    }\n    const { exclude, include, installOptions: { clean, dest }, knownEntrypoints, webDependencies, } = config;\n    const hasBrowserlistConfig = !!pkgManifest.browserslist ||\n        !!process.env.BROWSERSLIST ||\n        fs.existsSync(path.join(cwd, '.browserslistrc')) ||\n        fs.existsSync(path.join(cwd, 'browserslist'));\n    const installTargets = [];\n    if (knownEntrypoints) {\n        installTargets.push(...scanDepList(knownEntrypoints, cwd));\n    }\n    if (webDependencies) {\n        installTargets.push(...scanDepList(Object.keys(webDependencies), cwd));\n    }\n    if (include) {\n        installTargets.push(...(await scanImports({ include, exclude })));\n    }\n    if (installTargets.length === 0) {\n        logError('Nothing to install.');\n        return;\n    }\n    spinner.start();\n    const startTime = Date.now();\n    if (webDependencies && Object.keys(webDependencies).length > 0) {\n        newLockfile = await resolveTargetsFromRemoteCDN(lockfile, pkgManifest, config).catch((err) => {\n            logError(err.message || err);\n            process.exit(1);\n        });\n    }\n    if (clean) {\n        rimraf.sync(dest);\n    }\n    await mkdirp(dest);\n    const finalResult = await install(installTargets, { hasBrowserlistConfig, lockfile: newLockfile }, config).catch((err) => {\n        if (err.loc) {\n            console.log('\\n' + chalk.red.bold(`✘ ${err.loc.file}`));\n        }\n        if (err.url) {\n            console.log(chalk.dim(`👉 ${err.url}`));\n        }\n        throw err;\n    });\n    if (finalResult) {\n        spinner.succeed(chalk.bold(`snowpack`) +\n            ` install complete.` +\n            chalk.dim(` [${((Date.now() - startTime) / 1000).toFixed(2)}s]`));\n        if (!!dependencyStats) {\n            console.log(printStats(dependencyStats));\n        }\n    }\n    if (newLockfile) {\n        await writeLockfile(path.join(cwd, 'snowpack.lock.json'), newLockfile);\n    }\n    // If an error happened, set the exit code so that programmatic usage of the CLI knows.\n    // We were seeing race conditions here, so add a little buffer.\n    if (spinnerHasError) {\n        setTimeout(() => {\n            spinner.warn(chalk(`Finished with warnings.`));\n            process.exitCode = 1;\n        }, 20);\n    }\n}\n"],"names":["getStateString","workerState","isWatch","state","Array","isArray","chalk","dim","done","error","red","green","config","watch","WORKER_BASE_STATE","output","paint","bus","registeredWorkers","buildMode","devMode","consoleOutput","hasBeenCleared","missingWebModule","allWorkerStates","workerId","repaint","process","stdout","write","ansiEscapes","clearTerminal","bold","cyan","port","ip","ips","startTimeMs","dest","dotLength","length","dots","padEnd","stateStr","missingPackageName","deepPackagePathParts","split","startsWith","shift","underline","chalkFn","trim","replace","overallStatus","Object","values","reduce","result","exit","on","id","msg","undefined","level","args","util","format","apply","specifier","js","jsx","ts","tsx","vue","svelte","parse","require","spliceString","source","withSlice","start","end","slice","scanCodeImportsExports","code","imports","filter","imp","d","transformEsmImports","_code","replaceImport","rewrittenCode","reverse","spec","substring","s","e","rewrittenImport","copy","command","cwd","env","NODE_ENV","messageBus","EventEmitter","allRegisteredWorkers","entries","scripts","relevantWorkers","allWorkerPromises","isBundled","devOptions","bundle","finalDirectoryLoc","out","buildDirectoryLoc","path","join","distDirectoryLoc","dist","dependencyImportMapLoc","installOptions","dependencyImportMap","console","rimraf","sync","mkdirp","extToWorkerMap","workerConfig","push","exts","ext","cmd","log","emit","warn","relDest","relative","sep","workerPromise","execa","npmRunPath","extendEnv","shell","catch","err","toString","then","stderr","b","stdOutput","includes","endsWith","test","errorMatch","match","cmdArr","Error","dirUrl","dirDisk","resolve","to","yargs","destinationFile","include","allFiles","glob","nodir","ignore","f","fileExtension","extname","substr","input","createReadStream","outPath","extToFind","extToReplace","srcFileExtensionMapping","RegExp","fs","mkdir","dirname","recursive","writeFile","modulePath","paths","build","message","Promise","all","prepareBuildDirectoryForParcel","srcLoc","tempBuildManifest","JSON","readFile","encoding","name","devDependencies","stringify","bundleAppPromise","fallback","LIVE_RELOAD_SNIPPET","gid","host","ws","HOT_RELOAD_SNIPPET","getEncodingType","fileLoc","notify","CheapWatch","dir","isNew","init","sendFile","res","file","writeHead","mime","contentType","sendError","status","sendMessage","channel","data","hot","fileBuildCache","Map","liveReloadClients","hmrClients","serverStart","Date","now","workerDirectories","mountedDirectories","_srcFileExtensionMapping","RELOAD_SNIPPET","setTimeout","tempBuildDir","mkdtemp","os","tmpdir","unshift","http","createServer","req","reqUrl","url","reqPath","pathname","method","statusCode","Connection","setInterval","socket","greeting","clearConsole","inMemory","reload","autoAccept","attemptedFileLoads","attemptLoadFile","requestedFile","stat","isFile","resource","decodeURI","requestedFileExt","toLowerCase","isRoute","fileContents","fileBuilder","srcExtMatchers","srcFile","fallbackFile","prefix","map","loc","get","set","listen","hotDebounce","hotChanges","hotTimeout","flushHotChanges","changes","Set","client","notifyHotChange","clearTimeout","onWatchEvent","event","_fileLoc","delete","pop","networkInterfaces","every","i","family","internal","address","CONFIG_NAME","DEFAULT_CONFIG","exclude","knownEntrypoints","clean","externalPackage","installTypes","alias","rollup","plugins","dedupe","configSchema","type","properties","extends","items","webDependencies","additionalProperties","sourceMap","oneOf","enum","namedExports","expandCliFlags","flags","relevantFlags","flag","val","acc","index","indexOf","key","normalizeConfig","potentialIncludeDir","existsSync","scriptsBase","scriptId","keys","handleConfigError","handleValidationErrors","filepath","errors","handleDeprecatedConfigError","validateConfigAgainstV1","rawConfig","cliFlags","entrypoints","hash","nomodule","nomoduleOutput","babel","optimize","strict","loadAndValidateConfig","pkgManifest","explorerSync","cosmiconfigSync","searchPlaces","stopDir","load","search","isEmpty","cliConfig","validation","validate","allowUnknownAttributes","propertyName","extendConfig","extendConfigLoc","extendResult","extendValidation","overwriteMerge","destinationArray","sourceArray","options","mergedConfig","merge","arrayMerge","PIKA_CDN","CACHE_DIR","cachedir","RESOURCE_CACHE","HAS_CDN_HASH_REGEX","readLockfile","lockfileContents","readFileSync","writeLockfile","importMap","sortedImportMap","sort","writeFileSync","fetchCDNResource","resourceUrl","responseType","got","headers","throwHttpErrors","isTruthy","item","Boolean","resolveDependencyManifest","dep","depManifest","fullPath","searchPath","indexOfSearch","lastIndexOf","manifestPath","manifestStr","MISSING_PLUGIN_SUGGESTIONS","resolveDependency","installSpecifier","packageSemver","lockfile","canRetry","validatePackageName","validForNewPackages","installUrl","installUrlType","cachedResult","cacache","info","metadata","pinnedUrl","body","importUrlPath","pinnedUrlPath","buildStatus","typesUrlPath","typesUrl","put","lookupStatusCode","resolveTargetsFromRemoteCDN","downloadQueue","PQueue","concurrency","newLockfile","resolutionError","installSemver","add","resolvedUrl","onIdle","clearCache","rm","IS_DEEP_PACKAGE_IMPORT","rollupPluginEntrypointAlias","resolveId","importer","packageScope","packageName","packageFullName","manifest","needsAlias","module","posix","browser","main","skipSelf","resolved","CACHED_FILE_ID_PREFIX","PIKA_CDN_TRIM_LENGTH","rollupPluginDependencyCache","allTypesToInstall","cacheKey","response","finalResult","typesTarballUrl","writeBundle","tempDir","tmp","tarballContents","cachedTarball","tarballResponse","typesUrlParts","typesPackageName","typesPackageLoc","tar","x","rollupPluginDependencyStats","cb","outputDir","existingFileCache","statsSummary","direct","common","buildExistingFileCache","fileName","filePath","size","statSync","compareDependencies","files","contents","byteLength","gzip","zlib","gzipSync","brotli","brotliCompressSync","delta","generateBundle","directDependencies","commonDependencies","assetOrChunk","raw","Buffer","isBuffer","from","WEB_MODULES_TOKEN","WEB_MODULES_TOKEN_LENGTH","BARE_SPECIFIER_REGEX","HAS_NAMED_IMPORTS_REGEX","SPLIT_NAMED_IMPORTS_REGEX","DEFAULT_IMPORT_REGEX","HTML_JS_REGEX","stripJsExtension","createInstallTarget","default","namespace","named","removeSpecifierQueryString","queryStringIndex","getWebModuleSpecifierFromCode","importStatement","importSpecifierMatch","parseWebModuleSpecifier","cleanedSpecifier","webModulesIndex","resolvedSpecifier","resolvedSpecifierWithoutExtension","parseImportStatement","webModuleSpecifier","ss","se","dynamicImport","defaultImport","namespaceImport","namedImports","getInstallTargetsForFile","allImports","scanDepList","depList","whitelistItem","hasMagic","nodeModulesLoc","nodePath","flat","concat","scanImports","initESModuleLexer","includeFiles","absolute","loadedFiles","promises","transformFileAsync","runtime","isTSX","babelrc","configFile","allMatches","exec","full","lookup","impA","impB","localeCompare","SIZE_COLUMN_WIDTH","entriesSort","filenameA","filenameB","formatSize","kb","Math","round","floor","color","formatDelta","formatFileInfo","filename","stats","isLastFile","lineGlyph","lineName","fileStat","gzipStat","brotliStat","lineStat","lineDelta","formatFiles","strippedFiles","printStats","dependencyStats","allDirect","allCommon","maxFileNameLength","max","banner","installResults","spinner","ora","spinnerHasError","printHelp","formatInstallResults","yellow","logError","stopAndPersist","symbol","fail","logUpdate","text","ErrorWithHint","constructor","hint","PACKAGES_TO_AUTO_DETECT_EXPORTS","detectExports","resolveWebDependency","isExplicit","isJSFile","depManifestLoc","italic","foundEntrypoint","getWebDependencyName","getRollupReplaceKeys","install","installTargets","hasBrowserlistConfig","destLoc","externalPackages","installAlias","userDefinedRollup","knownNamedExports","allInstallSpecifiers","installEntrypoints","assetEntrypoints","installTargetsMap","targetName","targetType","targetLoc","value","forEach","t","inputOptions","external","treeshake","moduleSideEffects","rollupPluginReplace","rollupPluginAlias","mod","find","replacement","rollupPluginNodeResolve","mainFields","extensions","preferBuiltins","rollupPluginJson","preferConst","indent","compact","rollupPluginCommonjs","onwarn","warning","isNodeBuiltin","outputOptions","sourcemap","exports","chunkFileNames","packageBundle","failedExtension","suggestion","assetName","assetLoc","copyFileSync","cli","array","help","buildCommand","devCommand","dev","browserslist","BROWSERSLIST","startTime","succeed","toFixed","exitCode"],"mappings":"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"}