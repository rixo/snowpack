{"version":3,"file":"index.js","sources":["../dist-src/commands/paint.js","../dist-src/commands/src-file-extension-mapping.js","../dist-src/rewrite-imports.js","../dist-src/commands/build-util.js","../dist-src/commands/build.js","../dist-src/util.js","../dist-src/commands/dev.js","../dist-src/config.js","../dist-src/resolve-remote.js","../dist-src/rollup-plugin-entrypoint-alias.js","../dist-src/rollup-plugin-remote-cdn.js","../dist-src/rollup-plugin-stats.js","../dist-src/scan-imports.js","../dist-src/stats-formatter.js","../dist-src/rollup-plugin-react-fix.js","../dist-src/index.js"],"sourcesContent":["import ansiEscapes from 'ansi-escapes';\nimport chalk from 'chalk';\nimport util from 'util';\nfunction getStateString(workerState, isWatch) {\n    if (workerState.state) {\n        if (Array.isArray(workerState.state)) {\n            return chalk[workerState.state[1]](workerState.state[0]);\n        }\n        return chalk.dim(workerState.state);\n    }\n    if (workerState.done) {\n        return workerState.error ? chalk.red('FAILED') : chalk.green('DONE');\n    }\n    if (isWatch) {\n        if (workerState.config.watch) {\n            return chalk.dim('WATCHING');\n        }\n    }\n    return chalk.dim('READY');\n}\nconst WORKER_BASE_STATE = { done: false, error: null, output: '' };\nexport function paint(bus, registeredWorkers, buildMode, devMode) {\n    let consoleOutput = '';\n    let hasBeenCleared = false;\n    let missingWebModule = null;\n    const allWorkerStates = {};\n    for (const [workerId, config] of registeredWorkers) {\n        allWorkerStates[workerId] = { ...WORKER_BASE_STATE, config };\n    }\n    function repaint() {\n        process.stdout.write(ansiEscapes.clearTerminal);\n        process.stdout.write(`${chalk.bold('Snowpack')}\\n\\n`);\n        // Dashboard\n        if (devMode) {\n            process.stdout.write(`  ${chalk.bold.cyan(`http://localhost:${devMode.port}`)}`);\n            for (const ip of devMode.ips) {\n                process.stdout.write(`${chalk.cyan(` > `)}${chalk.bold.cyan(`http://${ip}:${devMode.port}`)}`);\n            }\n            process.stdout.write('\\n' + chalk.dim(`  Server started in ${devMode.startTimeMs}ms.\\n\\n`));\n        }\n        if (buildMode) {\n            process.stdout.write('  ' + chalk.bold.cyan(buildMode.dest));\n            process.stdout.write(chalk.dim(` Building your application...\\n\\n`));\n        }\n        for (const [workerId, config] of registeredWorkers) {\n            const workerState = allWorkerStates[workerId];\n            const dotLength = 24 - workerId.length;\n            const dots = ''.padEnd(dotLength, '.');\n            const stateStr = getStateString(workerState, !!devMode);\n            process.stdout.write(`  ${workerId}${chalk.dim(dots)}[${stateStr}]\\n`);\n        }\n        process.stdout.write('\\n');\n        if (missingWebModule) {\n            let [missingPackageName, ...deepPackagePathParts] = missingWebModule.split('/');\n            if (missingPackageName.startsWith('@')) {\n                missingPackageName += '/' + deepPackagePathParts.shift();\n            }\n            process.stdout.write(`${chalk.red.underline.bold('▼ Snowpack')}\\n\\n`);\n            process.stdout.write(`  Package ${chalk.bold(missingWebModule)} could not be found!\\n`);\n            process.stdout.write(`    1. Make sure that your ${chalk.bold('web_modules/')} directory is mounted correctly.\\n`);\n            process.stdout.write(`    2. Add ${chalk.bold(missingPackageName)} to your package.json \"dependencies\" or \"webDependencies\".\\n`);\n            process.stdout.write(`    3. run ${chalk.bold('snowpack install')} to install your new dependency.\\n`);\n            process.stdout.write('\\n');\n        }\n        for (const [workerId, config] of registeredWorkers) {\n            const workerState = allWorkerStates[workerId];\n            if (workerState && workerState.output) {\n                const chalkFn = Array.isArray(workerState.error) ? chalk.red : chalk;\n                process.stdout.write(`${chalkFn.underline.bold('▼ ' + workerId)}\\n\\n`);\n                process.stdout.write(workerState.output\n                    ? '  ' + workerState.output.trim().replace(/\\n/gm, '\\n  ')\n                    : hasBeenCleared\n                        ? chalk.dim('  Output cleared.')\n                        : chalk.dim('  No output, yet.'));\n                process.stdout.write('\\n\\n');\n            }\n        }\n        if (consoleOutput) {\n            process.stdout.write(`${chalk.underline.bold('▼ Console')}\\n\\n`);\n            process.stdout.write(consoleOutput\n                ? '  ' + consoleOutput.trim().replace(/\\n/gm, '\\n  ')\n                : hasBeenCleared\n                    ? chalk.dim('  Output cleared.')\n                    : chalk.dim('  No output, yet.'));\n            process.stdout.write('\\n\\n');\n        }\n        const overallStatus = Object.values(allWorkerStates).reduce((result, { done, error }) => {\n            return {\n                done: result.done && done,\n                error: result.error || error,\n            };\n        });\n        if (overallStatus.error) {\n            process.stdout.write(`${chalk.underline.red.bold('▼ Result')}\\n\\n`);\n            process.stdout.write('  ⚠️  Finished, with errors.');\n            process.stdout.write('\\n\\n');\n            process.exit(1);\n        }\n        else if (overallStatus.done) {\n            process.stdout.write(`${chalk.underline.green.bold('▶ Build Complete!')}\\n\\n`);\n        }\n    }\n    bus.on('WORKER_MSG', ({ id, msg }) => {\n        allWorkerStates[id].output += msg;\n        repaint();\n    });\n    bus.on('WORKER_UPDATE', ({ id, state }) => {\n        if (typeof state !== undefined) {\n            allWorkerStates[id].state = state;\n        }\n        repaint();\n    });\n    bus.on('WORKER_COMPLETE', ({ id, error }) => {\n        allWorkerStates[id].state = null;\n        allWorkerStates[id].done = true;\n        allWorkerStates[id].error = allWorkerStates[id].error || error;\n        repaint();\n    });\n    bus.on('WORKER_RESET', ({ id }) => {\n        allWorkerStates[id] = { ...WORKER_BASE_STATE, config: allWorkerStates[id].config };\n        repaint();\n    });\n    bus.on('CONSOLE', ({ level, args }) => {\n        consoleOutput += `[${level}] ${util.format.apply(util, args)}\\n`;\n        repaint();\n    });\n    bus.on('NEW_SESSION', () => {\n        missingWebModule = null;\n        if (consoleOutput) {\n            consoleOutput = ``;\n            hasBeenCleared = true;\n            repaint();\n        }\n    });\n    bus.on('MISSING_WEB_MODULE', ({ specifier }) => {\n        missingWebModule = specifier;\n        repaint();\n    });\n    // const rl = readline.createInterface({\n    //   input: process.stdin,\n    //   output: process.stdout,\n    // });\n    // rl.on('line', (input) => {\n    //   for (const [workerId, config] of registeredWorkers) {\n    //     if (!allWorkerStates[workerId].done && !allWorkerStates[workerId].state) {\n    //       allWorkerStates[workerId].output = '';\n    //     }\n    //   }\n    //   hasBeenCleared = true;\n    //   repaint();\n    // });\n    // unmountDashboard = render(<App bus={bus} registeredWorkers={registeredWorkers} />).unmount;\n    repaint();\n}\n","export default {\n    jsx: 'js',\n    ts: 'js',\n    tsx: 'js',\n    vue: 'js',\n    svelte: 'js',\n};\n","const { parse } = require('es-module-lexer');\nfunction spliceString(source, withSlice, start, end) {\n    return source.slice(0, start) + (withSlice || '') + source.slice(end);\n}\nexport async function scanCodeImportsExports(code) {\n    const [imports] = await parse(code);\n    return imports.filter((imp) => {\n        //imp.d = -2 = import.meta.url = we can skip this for now\n        if (imp.d === -2) {\n            return false;\n        }\n        // imp.d > -1 === dynamic import. skip for now\n        // TODO: if the entire value is a string, handle it\n        if (imp.d > -1) {\n            return false;\n        }\n        return true;\n    });\n}\nexport async function transformEsmImports(_code, replaceImport) {\n    const imports = await scanCodeImportsExports(_code);\n    let rewrittenCode = _code;\n    for (const imp of imports.reverse()) {\n        const spec = rewrittenCode.substring(imp.s, imp.e);\n        const rewrittenImport = replaceImport(spec);\n        rewrittenCode = spliceString(rewrittenCode, rewrittenImport, imp.s, imp.e);\n    }\n    return rewrittenCode;\n}\n","export function wrapEsmProxyResponse(url, code, ext, hasHmr = false) {\n    if (ext === '.css') {\n        return `\n    const styleEl = document.createElement(\"style\");\n    styleEl.type = 'text/css';\n    styleEl.appendChild(document.createTextNode(${JSON.stringify(code)}));\n    document.head.appendChild(styleEl);\n    ${hasHmr\n            ? `\n    import {apply} from '/web_modules/@snowpack/hmr.js';\n    apply(window.location.origin + ${JSON.stringify(url)}, ({code}) => {\n      styleEl.innerHtml = '';\n      styleEl.appendChild(document.createTextNode(code));\n    });\n    `\n            : ''}\n  `;\n    }\n    if (!hasHmr)\n        return code;\n    return `\n    import * as __SNOWPACK_HMR_API__ from '/web_modules/@snowpack/hmr.js';\n    import.meta.hot = __SNOWPACK_HMR_API__.createHotContext(window.location.origin + ${JSON.stringify(url)});\n  `.split('\\n').map(x => x.trim()).join(' ') + code;\n    // return `\n    //   export * from ${JSON.stringify(url)};\n    //   export {default} from ${JSON.stringify(url)};\n    // `;\n}\n","import chalk from 'chalk';\nimport { EventEmitter } from 'events';\nimport execa from 'execa';\nimport npmRunPath from 'npm-run-path';\nimport path from 'path';\nimport { promises as fs, createReadStream } from 'fs';\nimport glob from 'glob';\nimport { paint } from './paint';\nimport rimraf from 'rimraf';\nimport yargs from 'yargs-parser';\nimport srcFileExtensionMapping from './src-file-extension-mapping';\nimport { transformEsmImports } from '../rewrite-imports';\nimport mkdirp from 'mkdirp';\nimport { wrapEsmProxyResponse } from './build-util';\nconst { copy } = require('fs-extra');\nexport async function command({ cwd, config }) {\n    process.env.NODE_ENV = 'production';\n    const messageBus = new EventEmitter();\n    const allRegisteredWorkers = Object.entries(config.scripts);\n    const relevantWorkers = [];\n    const allBuildExtensions = [];\n    const allWorkerPromises = [];\n    const dependencyImportMapLoc = path.join(config.installOptions.dest, 'import-map.json');\n    let dependencyImportMap = { imports: {} };\n    try {\n        dependencyImportMap = require(dependencyImportMapLoc);\n    }\n    catch (err) {\n        // no import-map found, safe to ignore\n    }\n    let isBundled = config.devOptions.bundle;\n    const isBundledHardcoded = isBundled !== undefined;\n    if (!isBundledHardcoded) {\n        try {\n            require.resolve('parcel', { paths: [cwd] });\n            isBundled = true;\n        }\n        catch (err) {\n            isBundled = false;\n        }\n    }\n    const buildDirectoryLoc = isBundled ? path.join(cwd, `.build`) : config.devOptions.out;\n    const finalDirectoryLoc = config.devOptions.out;\n    if (allRegisteredWorkers.length === 0) {\n        console.error(chalk.red(`No build scripts found, so nothing to build.`));\n        console.error(`See https://www.snowpack.dev/#build-scripts for help getting started.`);\n        return;\n    }\n    const mountedDirectories = [];\n    for (const [id, workerConfig] of allRegisteredWorkers) {\n        if (!id.startsWith('mount:')) {\n            continue;\n        }\n        const cmdArr = workerConfig.cmd.split(/\\s+/);\n        if (cmdArr[0] !== 'mount') {\n            throw new Error(`script[${id}] must use the mount command`);\n        }\n        cmdArr.shift();\n        let dirUrl, dirDisk;\n        dirDisk = path.resolve(cwd, cmdArr[0]);\n        if (cmdArr.length === 1) {\n            dirUrl = cmdArr[0];\n        }\n        else {\n            const { to } = yargs(cmdArr);\n            dirUrl = to;\n        }\n        mountedDirectories.push([dirDisk, dirUrl]);\n    }\n    rimraf.sync(finalDirectoryLoc);\n    mkdirp.sync(finalDirectoryLoc);\n    if (finalDirectoryLoc !== buildDirectoryLoc) {\n        rimraf.sync(buildDirectoryLoc);\n        mkdirp.sync(buildDirectoryLoc);\n    }\n    // const extToWorkerMap: {[ext: string]: any[]} = {};\n    for (const [id, workerConfig] of allRegisteredWorkers) {\n        if (id.startsWith('build:') ||\n            id.startsWith('plugin:') ||\n            id.startsWith('lintall:') ||\n            id.startsWith('mount:')) {\n            relevantWorkers.push([id, workerConfig]);\n        }\n        if (id.startsWith('build:') || id.startsWith('plugin:')) {\n            const exts = id.split(':')[1].split(',');\n            allBuildExtensions.push(...exts); // for (const ext of exts) {\n            // extToWorkerMap[ext] = extToWorkerMap[ext] || [];\n            // extToWorkerMap[ext].push([id, workerConfig]);\n            // }\n        }\n    }\n    relevantWorkers.push(['bundle:*', { cmd: 'NA', watch: undefined }]);\n    console.log = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'log', args });\n    };\n    console.warn = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'warn', args });\n    };\n    console.error = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'error', args });\n    };\n    let relDest = path.relative(cwd, config.devOptions.out);\n    if (!relDest.startsWith(`..${path.sep}`)) {\n        relDest = `.${path.sep}` + relDest;\n    }\n    paint(messageBus, relevantWorkers, { dest: relDest }, undefined);\n    if (!isBundled) {\n        messageBus.emit('WORKER_UPDATE', {\n            id: 'bundle:*',\n            state: ['SKIP', 'dim'],\n        });\n    }\n    for (const [id, workerConfig] of relevantWorkers) {\n        if (!id.startsWith('lintall:')) {\n            continue;\n        }\n        messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n        const workerPromise = execa.command(workerConfig.cmd, {\n            env: npmRunPath.env(),\n            extendEnv: true,\n            shell: true,\n        });\n        allWorkerPromises.push(workerPromise);\n        workerPromise.catch((err) => {\n            messageBus.emit('WORKER_MSG', { id, level: 'error', msg: err.toString() });\n            messageBus.emit('WORKER_COMPLETE', { id, error: err });\n        });\n        workerPromise.then(() => {\n            messageBus.emit('WORKER_COMPLETE', { id, error: null });\n        });\n        const { stdout, stderr } = workerPromise;\n        stdout?.on('data', (b) => {\n            let stdOutput = b.toString();\n            if (stdOutput.includes('\\u001bc') || stdOutput.includes('\\x1Bc')) {\n                messageBus.emit('WORKER_RESET', { id });\n                stdOutput = stdOutput.replace(/\\x1Bc/, '').replace(/\\u001bc/, '');\n            }\n            if (id.endsWith(':tsc')) {\n                if (stdOutput.includes('\\u001bc') || stdOutput.includes('\\x1Bc')) {\n                    messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n                }\n                if (/Watching for file changes./gm.test(stdOutput)) {\n                    messageBus.emit('WORKER_UPDATE', { id, state: 'WATCHING' });\n                }\n                const errorMatch = stdOutput.match(/Found (\\d+) error/);\n                if (errorMatch && errorMatch[1] !== '0') {\n                    messageBus.emit('WORKER_UPDATE', { id, state: ['ERROR', 'red'] });\n                }\n            }\n            messageBus.emit('WORKER_MSG', { id, level: 'log', msg: stdOutput });\n        });\n        stderr?.on('data', (b) => {\n            messageBus.emit('WORKER_MSG', { id, level: 'error', msg: b.toString() });\n        });\n    }\n    const mountDirDetails = relevantWorkers\n        .map(([id, scriptConfig]) => {\n        if (!id.startsWith('mount:')) {\n            return false;\n        }\n        const cmdArr = scriptConfig.cmd.split(/\\s+/);\n        if (cmdArr[0] !== 'mount') {\n            throw new Error(`script[${id}] must use the mount command`);\n        }\n        cmdArr.shift();\n        let dirDest, dirDisk;\n        dirDisk = path.resolve(cwd, cmdArr[0]);\n        if (cmdArr.length === 1) {\n            dirDest = path.resolve(buildDirectoryLoc, cmdArr[0]);\n        }\n        else {\n            const { to } = yargs(cmdArr);\n            dirDest = path.resolve(buildDirectoryLoc, to);\n        }\n        return [id, dirDisk, dirDest];\n    })\n        .filter(Boolean);\n    const includeFileSets = [];\n    for (const [id, dirDisk, dirDest] of mountDirDetails) {\n        messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n        let allFiles;\n        try {\n            allFiles = glob.sync(`**/*`, {\n                ignore: config.exclude,\n                cwd: dirDisk,\n                absolute: true,\n                nodir: true,\n                dot: true,\n            });\n            const allBuildNeededFiles = [];\n            await Promise.all(allFiles.map((f) => {\n                f = path.resolve(f); // this is necessary since glob.sync() returns paths with / on windows.  path.resolve() will switch them to the native path separator.\n                if (allBuildExtensions.includes(path.extname(f).substr(1))) {\n                    allBuildNeededFiles.push(f);\n                    return;\n                }\n                const outPath = f.replace(dirDisk, dirDest);\n                mkdirp.sync(path.dirname(outPath));\n                return fs.copyFile(f, outPath);\n            }));\n            includeFileSets.push([dirDisk, dirDest, allBuildNeededFiles]);\n            messageBus.emit('WORKER_COMPLETE', { id });\n        }\n        catch (err) {\n            messageBus.emit('WORKER_MSG', { id, level: 'error', msg: err.toString() });\n            messageBus.emit('WORKER_COMPLETE', { id, error: err });\n        }\n    }\n    const allBuiltFromFiles = new Set();\n    const allProxiedFiles = new Set();\n    for (const [id, workerConfig] of relevantWorkers) {\n        if (!id.startsWith('build:') && !id.startsWith('plugin:')) {\n            continue;\n        }\n        messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n        for (const [dirDisk, dirDest, allFiles] of includeFileSets) {\n            for (const f of allFiles) {\n                const fileExtension = path.extname(f).substr(1);\n                if (!id.includes(`:${fileExtension}`) && !id.includes(`,${fileExtension}`)) {\n                    continue;\n                }\n                let { cmd } = workerConfig;\n                if (id.startsWith('build:')) {\n                    cmd = cmd.replace('$FILE', f);\n                    const { stdout, stderr } = await execa.command(cmd, {\n                        env: npmRunPath.env(),\n                        extendEnv: true,\n                        shell: true,\n                        input: createReadStream(f),\n                    });\n                    if (stderr) {\n                        console.error(stderr);\n                    }\n                    if (!stdout) {\n                        continue;\n                    }\n                    let outPath = f.replace(dirDisk, dirDest);\n                    const extToFind = path.extname(f).substr(1);\n                    const extToReplace = srcFileExtensionMapping[extToFind];\n                    if (extToReplace) {\n                        outPath = outPath.replace(new RegExp(`${extToFind}$`), extToReplace);\n                    }\n                    let code = stdout;\n                    if (path.extname(outPath) === '.js') {\n                        code = await transformEsmImports(code, (spec) => {\n                            if (spec.startsWith('http')) {\n                                return spec;\n                            }\n                            if (spec.startsWith('/') || spec.startsWith('./') || spec.startsWith('../')) {\n                                const ext = path.extname(spec).substr(1);\n                                if (!ext) {\n                                    return spec + '.js';\n                                }\n                                const extToReplace = srcFileExtensionMapping[ext];\n                                if (extToReplace) {\n                                    spec = spec.replace(new RegExp(`${ext}$`), extToReplace);\n                                }\n                                if (!isBundled && (extToReplace || ext) !== 'js') {\n                                    const resolvedUrl = path.resolve(path.dirname(outPath), spec);\n                                    allProxiedFiles.add(resolvedUrl);\n                                    spec = spec + '.proxy.js';\n                                }\n                                return spec;\n                            }\n                            if (dependencyImportMap.imports[spec]) {\n                                return path.posix.resolve(`/web_modules`, dependencyImportMap.imports[spec]);\n                            }\n                            messageBus.emit('MISSING_WEB_MODULE', { specifier: spec });\n                            return `/web_modules/${spec}.js`;\n                        });\n                    }\n                    await fs.mkdir(path.dirname(outPath), { recursive: true });\n                    await fs.writeFile(outPath, code);\n                    allBuiltFromFiles.add(f);\n                }\n                if (id.startsWith('plugin:')) {\n                    const modulePath = require.resolve(cmd, { paths: [cwd] });\n                    const { build } = require(modulePath);\n                    try {\n                        var { result } = await build(f);\n                    }\n                    catch (err) {\n                        err.message = `[${id}] ${err.message}`;\n                        console.error(err);\n                        messageBus.emit('WORKER_COMPLETE', { id, error: err });\n                        continue;\n                    }\n                    let outPath = f.replace(dirDisk, dirDest);\n                    const extToFind = path.extname(f).substr(1);\n                    const extToReplace = srcFileExtensionMapping[extToFind];\n                    if (extToReplace) {\n                        outPath = outPath.replace(new RegExp(`${extToFind}$`), extToReplace);\n                    }\n                    let code = result;\n                    if (path.extname(outPath) === '.js') {\n                        code = await transformEsmImports(code, (spec) => {\n                            if (spec.startsWith('http')) {\n                                return spec;\n                            }\n                            if (spec.startsWith('/') || spec.startsWith('./') || spec.startsWith('../')) {\n                                const ext = path.extname(spec).substr(1);\n                                if (!ext) {\n                                    return spec + '.js';\n                                }\n                                const extToReplace = srcFileExtensionMapping[ext];\n                                if (extToReplace) {\n                                    spec = spec.replace(new RegExp(`${ext}$`), extToReplace);\n                                }\n                                if ((extToReplace || ext) !== 'js') {\n                                    const resolvedUrl = path.resolve(path.dirname(outPath), spec);\n                                    allProxiedFiles.add(resolvedUrl);\n                                    spec = spec + '.proxy.js';\n                                }\n                                return spec;\n                            }\n                            if (dependencyImportMap.imports[spec]) {\n                                return path.posix.resolve(`/web_modules`, dependencyImportMap.imports[spec]);\n                            }\n                            messageBus.emit('MISSING_WEB_MODULE', { specifier: spec });\n                            return `/web_modules/${spec}.js`;\n                        });\n                    }\n                    await fs.mkdir(path.dirname(outPath), { recursive: true });\n                    await fs.writeFile(outPath, code);\n                }\n            }\n        }\n        messageBus.emit('WORKER_COMPLETE', { id, error: null });\n    }\n    await Promise.all(allWorkerPromises);\n    for (const proxiedFileLoc of allProxiedFiles) {\n        const proxiedCode = await fs.readFile(proxiedFileLoc, { encoding: 'utf8' });\n        const proxiedExt = path.extname(proxiedFileLoc);\n        const proxiedUrl = proxiedFileLoc.substr(buildDirectoryLoc.length);\n        const proxyCode = wrapEsmProxyResponse(proxiedUrl, proxiedCode, proxiedExt);\n        const proxyFileLoc = proxiedFileLoc + '.proxy.js';\n        await fs.writeFile(proxyFileLoc, proxyCode, { encoding: 'utf8' });\n    }\n    if (!isBundled) {\n        messageBus.emit('WORKER_COMPLETE', { id: 'bundle:*', error: null });\n        messageBus.emit('WORKER_UPDATE', {\n            id: 'bundle:*',\n            state: ['SKIP', isBundledHardcoded ? 'green' : 'yellow'],\n        });\n        if (!isBundledHardcoded) {\n            messageBus.emit('WORKER_MSG', {\n                id: 'bundle:*',\n                level: 'log',\n                msg: `npm install --save-dev parcel@^2.0.0-0 \\n\\nInstall Parcel into your project to bundle for production.\\nSet \"devOptions.bundle = false\" to remove this message.`,\n            });\n        }\n    }\n    else {\n        messageBus.emit('WORKER_UPDATE', { id: 'bundle:*', state: ['RUNNING', 'yellow'] });\n        async function prepareBuildDirectoryForParcel() {\n            // Prepare the new build directory by copying over all static assets\n            // This is important since sometimes Parcel doesn't pick these up.\n            await copy(buildDirectoryLoc, finalDirectoryLoc, {\n                filter: (srcLoc) => {\n                    return !allBuiltFromFiles.has(srcLoc);\n                },\n            }).catch((err) => {\n                messageBus.emit('WORKER_MSG', { id: 'bundle:*', level: 'error', msg: err.toString() });\n                messageBus.emit('WORKER_COMPLETE', { id: 'bundle:*', error: err });\n                throw err;\n            });\n            const tempBuildManifest = JSON.parse(await fs.readFile(path.join(cwd, 'package.json'), { encoding: 'utf-8' }));\n            delete tempBuildManifest.name;\n            tempBuildManifest.devDependencies = tempBuildManifest.devDependencies || {};\n            tempBuildManifest.devDependencies['@babel/core'] =\n                tempBuildManifest.devDependencies['@babel/core'] || '^7.9.0';\n            tempBuildManifest.browserslist =\n                tempBuildManifest.browserslist || '>0.75%, not ie 11, not UCAndroid >0, not OperaMini all';\n            await fs.writeFile(path.join(buildDirectoryLoc, 'package.json'), JSON.stringify(tempBuildManifest, null, 2));\n            await fs.writeFile(path.join(buildDirectoryLoc, '.babelrc'), `{\"plugins\": [[${JSON.stringify(require.resolve('@babel/plugin-syntax-import-meta'))}]]}`);\n            await fs.writeFile(path.join(buildDirectoryLoc, '.parcelrc'), `{\n        \"extends\": \"@parcel/config-default\",\n        \"transformers\": {\n          \"*.{png,jpg,jpeg,svg}\": [\"@parcel/transformer-raw\"]\n        },\n      }`);\n        }\n        await prepareBuildDirectoryForParcel();\n        const parcelOptions = ['build', config.devOptions.fallback, '--dist-dir', finalDirectoryLoc];\n        if (config.homepage) {\n            parcelOptions.push('--public-url', config.homepage);\n        }\n        const bundleAppPromise = execa('parcel', parcelOptions, {\n            cwd: buildDirectoryLoc,\n            env: npmRunPath.env(),\n            extendEnv: true,\n        });\n        bundleAppPromise.stdout?.on('data', (b) => {\n            messageBus.emit('WORKER_MSG', { id: 'bundle:*', level: 'log', msg: b.toString() });\n        });\n        bundleAppPromise.stderr?.on('data', (b) => {\n            messageBus.emit('WORKER_MSG', { id: 'bundle:*', level: 'log', msg: b.toString() });\n        });\n        bundleAppPromise.catch((err) => {\n            messageBus.emit('WORKER_MSG', { id: 'bundle:*', level: 'error', msg: err.toString() });\n            messageBus.emit('WORKER_COMPLETE', { id: 'bundle:*', error: err });\n        });\n        bundleAppPromise.then(() => {\n            messageBus.emit('WORKER_COMPLETE', { id: 'bundle:*', error: null });\n        });\n        await bundleAppPromise;\n    }\n    if (finalDirectoryLoc !== buildDirectoryLoc) {\n        rimraf.sync(buildDirectoryLoc);\n    }\n}\n","import fs from 'fs';\nimport path from 'path';\nimport got from 'got';\nimport cachedir from 'cachedir';\nexport const PIKA_CDN = `https://cdn.pika.dev`;\nexport const CACHE_DIR = cachedir('snowpack');\nexport const RESOURCE_CACHE = path.join(CACHE_DIR, 'pkg-cache-1.4');\nexport const BUILD_CACHE = path.join(CACHE_DIR, 'build-cache-1.4');\nexport const HAS_CDN_HASH_REGEX = /\\-[a-zA-Z0-9]{16,}/;\nexport async function readLockfile(cwd) {\n    try {\n        var lockfileContents = fs.readFileSync(path.join(cwd, 'snowpack.lock.json'), {\n            encoding: 'utf8',\n        });\n    }\n    catch (err) {\n        // no lockfile found, ignore and continue\n        return null;\n    }\n    // If this fails, we actually do want to alert the user by throwing\n    return JSON.parse(lockfileContents);\n}\nexport async function writeLockfile(loc, importMap) {\n    const sortedImportMap = { imports: {} };\n    for (const key of Object.keys(importMap.imports).sort()) {\n        sortedImportMap.imports[key] = importMap.imports[key];\n    }\n    fs.writeFileSync(loc, JSON.stringify(sortedImportMap, undefined, 2), { encoding: 'utf8' });\n}\nexport function fetchCDNResource(resourceUrl, responseType) {\n    if (!resourceUrl.startsWith(PIKA_CDN)) {\n        resourceUrl = PIKA_CDN + resourceUrl;\n    }\n    // @ts-ignore - TS doesn't like responseType being unknown amount three options\n    return got(resourceUrl, {\n        responseType: responseType,\n        headers: { 'user-agent': `snowpack/v1.4 (https://snowpack.dev)` },\n        throwHttpErrors: false,\n    });\n}\nexport function isTruthy(item) {\n    return Boolean(item);\n}\n/**\n * Given a package name, look for that package's package.json manifest.\n * Return both the manifest location (if believed to exist) and the\n * manifest itself (if found).\n *\n * NOTE: You used to be able to require() a package.json file directly,\n * but now with export map support in Node v13 that's no longer possible.\n */\nexport function resolveDependencyManifest(dep, cwd) {\n    // Attempt #1: Resolve the dependency manifest normally. This works for most\n    // packages, but fails when the package defines an export map that doesn't\n    // include a package.json. If we detect that to be the reason for failure,\n    // move on to our custom implementation.\n    try {\n        const depManifest = require.resolve(`${dep}/package.json`, { paths: [cwd] });\n        return [depManifest, require(depManifest)];\n    }\n    catch (err) {\n        // if its an export map issue, move on to our manual resolver.\n        if (err.code !== 'ERR_PACKAGE_PATH_NOT_EXPORTED') {\n            throw new Error(`Cannot resolve \"${dep}/package.json\" via \"${cwd}\".`);\n        }\n    }\n    // Attempt #2: Resolve the dependency manifest manually. This involves resolving\n    // the dep itself to find the entrypoint file, and then haphazardly replacing the\n    // file path within the package with a \"./package.json\" instead. It's not as\n    // thorough as Attempt #1, but it should work well until export maps become more\n    // established & move out of experimental mode.\n    let result = [null, null];\n    try {\n        const fullPath = require.resolve(dep, { paths: [cwd] });\n        // Strip everything after the package name to get the package root path\n        // NOTE: This find-replace is very gross, replace with something like upath.\n        const searchPath = `${path.sep}node_modules${path.sep}${dep.replace('/', path.sep)}`;\n        const indexOfSearch = fullPath.lastIndexOf(searchPath);\n        if (indexOfSearch >= 0) {\n            const manifestPath = fullPath.substring(0, indexOfSearch + searchPath.length + 1) + 'package.json';\n            result[0] = manifestPath;\n            const manifestStr = fs.readFileSync(manifestPath, { encoding: 'utf8' });\n            result[1] = JSON.parse(manifestStr);\n        }\n    }\n    catch (err) {\n        // ignore\n    }\n    finally {\n        return result;\n    }\n}\n/**\n * If Rollup erred parsing a particular file, show suggestions based on its\n * file extension (note: lowercase is fine).\n */\nexport const MISSING_PLUGIN_SUGGESTIONS = {\n    '.css': 'Try installing rollup-plugin-postcss and adding it to Snowpack (https://www.snowpack.dev/#custom-rollup-plugins)',\n    '.svelte': 'Try installing rollup-plugin-svelte and adding it to Snowpack (https://www.snowpack.dev/#custom-rollup-plugins)',\n    '.vue': 'Try installing rollup-plugin-vue and adding it to Snowpack (https://www.snowpack.dev/#custom-rollup-plugins)',\n};\n","/**\n * This license applies to parts of this file originating from the\n * https://github.com/lukejacksonn/servor repository:\n *\n * MIT License\n * Copyright (c) 2019 Luke Jackson\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\nimport chalk from 'chalk';\nimport etag from 'etag';\nimport { EventEmitter } from 'events';\nimport execa from 'execa';\nimport { promises as fs } from 'fs';\nimport http from 'http';\nimport chokidar from 'chokidar';\nimport mime from 'mime-types';\nimport npmRunPath from 'npm-run-path';\nimport path from 'path';\nimport url from 'url';\nimport os from 'os';\nimport { paint } from './paint';\nimport yargs from 'yargs-parser';\nimport srcFileExtensionMapping from './src-file-extension-mapping';\nimport { transformEsmImports } from '../rewrite-imports';\nimport { BUILD_CACHE } from '../util';\nimport cacache from 'cacache';\nimport { wrapEsmProxyResponse } from './build-util';\nconst hmrEnabledExtensions = {\n    css: true,\n    svelte: true,\n};\nfunction getEncodingType(ext) {\n    if (ext === '.js' || ext === '.css' || ext === '.html') {\n        return 'utf8';\n    }\n    else {\n        return 'binary';\n    }\n}\nconst sendFile = (req, res, body, ext = '.html') => {\n    res.writeHead(200, {\n        'Content-Type': mime.contentType(ext) || 'application/octet-stream',\n        'Access-Control-Allow-Origin': '*',\n    });\n    res.write(body, getEncodingType(ext));\n    res.end();\n};\nconst sendError = (res, status) => {\n    res.writeHead(status);\n    res.end();\n};\nconst sendMessage = (res, channel, data) => {\n    res.write(`event: ${channel}\\nid: 0\\ndata: ${data}\\n`);\n    res.write('\\n\\n');\n};\nexport async function command({ cwd, config }) {\n    console.log(chalk.bold('Snowpack Dev Server (Beta)'));\n    console.log('NOTE: Still experimental, default behavior may change.');\n    console.log('Starting up...');\n    const { port } = config.devOptions;\n    // WHY 2???\n    let inMemoryBuildCache = new Map();\n    const filesBeingDeleted = new Set();\n    const filesBeingBuilt = new Map();\n    const liveReloadClients = [];\n    const messageBus = new EventEmitter();\n    const serverStart = Date.now();\n    const hmrCode = await fs.readFile(path.join(__dirname, '../assets/hmr.js'));\n    const dependencyImportMapLoc = path.join(config.installOptions.dest, 'import-map.json');\n    let dependencyImportMap = { imports: {} };\n    try {\n        dependencyImportMap = require(dependencyImportMapLoc);\n    }\n    catch (err) {\n        // no import-map found, safe to ignore\n    }\n    const registeredWorkers = Object.entries(config.scripts);\n    // const workerDirectories: string[] = [];\n    const mountedDirectories = [];\n    const broadcast = (channel, data) => {\n        for (const client of liveReloadClients) {\n            sendMessage(client, channel, data);\n        }\n    };\n    for (const [id, workerConfig] of registeredWorkers) {\n        if (!id.startsWith('mount:')) {\n            continue;\n        }\n        const cmdArr = workerConfig.cmd.split(/\\s+/);\n        if (cmdArr[0] !== 'mount') {\n            throw new Error(`script[${id}] must use the mount command`);\n        }\n        cmdArr.shift();\n        let dirUrl, dirDisk;\n        dirDisk = path.resolve(cwd, cmdArr[0]);\n        if (cmdArr.length === 1) {\n            dirUrl = cmdArr[0];\n        }\n        else {\n            const { to } = yargs(cmdArr);\n            dirUrl = to;\n        }\n        mountedDirectories.push([dirDisk, dirUrl]);\n        setTimeout(() => messageBus.emit('WORKER_UPDATE', { id, state: ['DONE', 'green'] }), 400);\n    }\n    for (const [id, workerConfig] of registeredWorkers) {\n        let { cmd } = workerConfig;\n        if (!id.startsWith('lintall:')) {\n            continue;\n        }\n        if (workerConfig.watch) {\n            cmd += workerConfig.watch.replace('$1', '');\n        }\n        // const tempBuildDir = await fs.mkdtemp(path.join(os.tmpdir(), `snowpack-${id}`));\n        // workerDirectories.unshift(tempBuildDir);\n        // cmd = cmd.replace(/\\$DIST/g, tempBuildDir);\n        const workerPromise = execa.command(cmd, { env: npmRunPath.env(), extendEnv: true, shell: true });\n        const { stdout, stderr } = workerPromise;\n        stdout?.on('data', (b) => {\n            let stdOutput = b.toString();\n            if (stdOutput.includes('\\u001bc') || stdOutput.includes('\\x1Bc')) {\n                messageBus.emit('WORKER_RESET', { id });\n                stdOutput = stdOutput.replace(/\\x1Bc/, '').replace(/\\u001bc/, '');\n            }\n            if (id.endsWith(':tsc')) {\n                if (stdOutput.includes('\\u001bc') || stdOutput.includes('\\x1Bc')) {\n                    messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n                }\n                if (/Watching for file changes./gm.test(stdOutput)) {\n                    messageBus.emit('WORKER_UPDATE', { id, state: 'WATCHING' });\n                }\n                const errorMatch = stdOutput.match(/Found (\\d+) error/);\n                if (errorMatch && errorMatch[1] !== '0') {\n                    messageBus.emit('WORKER_UPDATE', { id, state: ['ERROR', 'red'] });\n                }\n            }\n            messageBus.emit('WORKER_MSG', { id, level: 'log', msg: stdOutput });\n        });\n        stderr?.on('data', (b) => {\n            messageBus.emit('WORKER_MSG', { id, level: 'error', msg: b.toString() });\n        });\n        stderr?.on('data', (b) => { });\n        workerPromise.catch((err) => {\n            messageBus.emit('WORKER_COMPLETE', { id, error: err });\n        });\n        workerPromise.then(() => {\n            messageBus.emit('WORKER_COMPLETE', { id, error: null });\n        });\n    }\n    function getUrlFromFile(fileLoc) {\n        for (const [dirDisk, dirUrl] of mountedDirectories) {\n            if (fileLoc.startsWith(dirDisk + path.sep)) {\n                const fileExt = path.extname(fileLoc).substr(1);\n                const resolvedDirUrl = dirUrl === '.' ? '' : '/' + dirUrl;\n                return (fileLoc\n                    .replace(dirDisk, resolvedDirUrl)\n                    .replace(/[/\\\\]+/g, '/')\n                    .replace(new RegExp(`${fileExt}$`), srcFileExtensionMapping[fileExt] || fileExt));\n            }\n        }\n        return null;\n    }\n    async function buildFile(fileContents, fileLoc, fileBuilder) {\n        if (fileBuilder) {\n            let fileBuilderPromise = filesBeingBuilt.get(fileLoc);\n            if (!fileBuilderPromise) {\n                fileBuilderPromise = fileBuilder(fileContents, { filename: fileLoc });\n                filesBeingBuilt.set(fileLoc, fileBuilderPromise);\n            }\n            fileContents = await fileBuilderPromise;\n            filesBeingBuilt.delete(fileLoc);\n        }\n        const ext = path.extname(fileLoc).substr(1);\n        if (ext === 'js' || srcFileExtensionMapping[ext] === 'js') {\n            fileContents = await transformEsmImports(fileContents, (spec) => {\n                if (spec.startsWith('http')) {\n                    return spec;\n                }\n                if (spec.startsWith('/') || spec.startsWith('./') || spec.startsWith('../')) {\n                    const ext = path.extname(spec).substr(1);\n                    if (!ext) {\n                        return spec + '.js';\n                    }\n                    const extToReplace = srcFileExtensionMapping[ext];\n                    if (extToReplace) {\n                        spec = spec.replace(new RegExp(`${ext}$`), extToReplace);\n                    }\n                    if (hmrEnabledExtensions[ext]) {\n                        spec = spec + '.proxy.js';\n                    }\n                    return spec;\n                }\n                if (dependencyImportMap.imports[spec]) {\n                    return path.posix.resolve(`/web_modules`, dependencyImportMap.imports[spec]);\n                }\n                messageBus.emit('MISSING_WEB_MODULE', { specifier: spec });\n                return `/web_modules/${spec}.js`;\n            });\n        }\n        return fileContents;\n    }\n    function getFileBuilderForWorker(fileLoc, selectedWorker) {\n        const [id, { cmd }] = selectedWorker;\n        if (id.startsWith('plugin:')) {\n            const modulePath = require.resolve(cmd, { paths: [cwd] });\n            const { build } = require(modulePath);\n            return async (code, options) => {\n                messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n                try {\n                    let { result } = await build(fileLoc);\n                    return result;\n                }\n                catch (err) {\n                    err.message = `[${id}] ${err.message}`;\n                    console.error(err);\n                    return '';\n                }\n                finally {\n                    messageBus.emit('WORKER_UPDATE', { id, state: null });\n                }\n            };\n        }\n        if (id.startsWith('build:')) {\n            return async (code, options) => {\n                messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n                let cmdWithFile = cmd.replace('$FILE', options.filename);\n                const { stdout, stderr } = await execa.command(cmdWithFile, {\n                    env: npmRunPath.env(),\n                    extendEnv: true,\n                    shell: true,\n                    input: code,\n                });\n                if (stderr) {\n                    console.error(stderr);\n                }\n                messageBus.emit('WORKER_UPDATE', { id, state: null });\n                return stdout;\n            };\n        }\n    }\n    http\n        .createServer(async (req, res) => {\n        const reqUrl = req.url;\n        let reqPath = decodeURI(url.parse(reqUrl).pathname);\n        // const requestStart = Date.now();\n        res.on('finish', () => {\n            const { method, url } = req;\n            const { statusCode } = res;\n            if (statusCode !== 200) {\n                messageBus.emit('SERVER_RESPONSE', {\n                    method,\n                    url,\n                    statusCode,\n                });\n            }\n        });\n        if (reqPath === '/livereload') {\n            res.writeHead(200, {\n                Connection: 'keep-alive',\n                'Content-Type': 'text/event-stream',\n                'Cache-Control': 'no-cache',\n                'Access-Control-Allow-Origin': '*',\n            });\n            sendMessage(res, 'connected', 'ready');\n            setInterval(sendMessage, 60000, res, 'ping', 'waiting');\n            liveReloadClients.push(res);\n            req.on('close', () => {\n                liveReloadClients.splice(liveReloadClients.indexOf(res), 1);\n            });\n            return;\n        }\n        if (reqPath === '/web_modules/@snowpack/hmr.js') {\n            sendFile(req, res, hmrCode, '.js');\n            return;\n        }\n        const attemptedFileLoads = [];\n        function attemptLoadFile(requestedFile) {\n            attemptedFileLoads.push(requestedFile);\n            return fs\n                .stat(requestedFile)\n                .then((stat) => (stat.isFile() ? requestedFile : null))\n                .catch(() => null /* ignore */);\n        }\n        let isProxyModule = false;\n        if (reqPath.endsWith('.proxy.js')) {\n            isProxyModule = true;\n            reqPath = reqPath.replace('.proxy.js', '');\n        }\n        let requestedFileExt = path.parse(reqPath).ext.toLowerCase();\n        let isRoute = false;\n        let fileBuilder;\n        // for (const dirDisk of workerDirectories) {\n        //   if (fileLoc || !requestedFileExt) {\n        //     continue;\n        //   }\n        //   let requestedFile = path.join(dirDisk, resource.replace(`${config.devOptions.dist}`, ''));\n        //   fileLoc = await attemptLoadFile(requestedFile);\n        // }\n        let responseFileExt = requestedFileExt;\n        async function getFileFromUrl(resource) {\n            for (const [dirDisk, dirUrl] of mountedDirectories) {\n                let requestedFile;\n                if (dirUrl === '.') {\n                    requestedFile = path.join(dirDisk, resource);\n                }\n                else if (resource.startsWith('/' + dirUrl)) {\n                    requestedFile = path.join(dirDisk, resource.replace(dirUrl, '.'));\n                }\n                else {\n                    continue;\n                }\n                const fileLoc = await attemptLoadFile(requestedFile);\n                if (fileLoc) {\n                    return [fileLoc, null];\n                }\n                if (requestedFileExt) {\n                    for (const [id, workerConfig] of registeredWorkers) {\n                        if (!id.startsWith('build:') && !id.startsWith('plugin:')) {\n                            continue;\n                        }\n                        const srcExtMatchers = id.split(':')[1].split(',');\n                        for (const ext of srcExtMatchers) {\n                            if (!srcFileExtensionMapping[ext]) {\n                                continue;\n                            }\n                            if (srcFileExtensionMapping[ext] === requestedFileExt.substr(1)) {\n                                const srcFile = requestedFile.replace(requestedFileExt, `.${ext}`);\n                                const fileLoc = await attemptLoadFile(srcFile);\n                                if (fileLoc) {\n                                    return [fileLoc, [id, workerConfig]];\n                                }\n                            }\n                        }\n                    }\n                }\n                else {\n                    let fileLoc = (await attemptLoadFile(requestedFile + '.html')) ||\n                        (await attemptLoadFile(requestedFile + 'index.html')) ||\n                        (await attemptLoadFile(requestedFile + '/index.html'));\n                    if (!fileLoc && dirUrl === '.' && config.devOptions.fallback) {\n                        const fallbackFile = dirUrl === '.'\n                            ? path.join(dirDisk, config.devOptions.fallback)\n                            : path.join(cwd, config.devOptions.fallback);\n                        fileLoc = await attemptLoadFile(fallbackFile);\n                    }\n                    if (fileLoc) {\n                        responseFileExt = '.html';\n                        isRoute = true;\n                    }\n                    return [fileLoc, null];\n                }\n            }\n            return [null, null];\n        }\n        const [fileLoc, selectedWorker] = await getFileFromUrl(reqPath);\n        if (isRoute) {\n            messageBus.emit('NEW_SESSION');\n        }\n        if (!fileLoc) {\n            const prefix = chalk.red('  ✘ ');\n            console.error(`[404] ${reqUrl}\\n${attemptedFileLoads.map((loc) => prefix + loc).join('\\n')}`);\n            return sendError(res, 404);\n        }\n        if (selectedWorker) {\n            fileBuilder = getFileBuilderForWorker(fileLoc, selectedWorker);\n        }\n        // 1. Check the hot build cache. If it's already found, then just serve it.\n        let hotCachedResponse = inMemoryBuildCache.get(fileLoc);\n        if (hotCachedResponse) {\n            if (isRoute) {\n                hotCachedResponse =\n                    hotCachedResponse.toString() +\n                        `<script type=\"module\" src=\"/web_modules/@snowpack/hmr.js\"></script>`;\n            }\n            if (isProxyModule) {\n                responseFileExt = '.js';\n                hotCachedResponse = wrapEsmProxyResponse(reqPath, hotCachedResponse.toString(), requestedFileExt, true);\n            }\n            sendFile(req, res, hotCachedResponse, responseFileExt);\n            return;\n        }\n        // 2. Load the file from disk. We'll need it to check the cold cache or build from scratch.\n        let fileContents;\n        try {\n            fileContents = await fs.readFile(fileLoc, getEncodingType(requestedFileExt));\n        }\n        catch (err) {\n            console.error(fileLoc, err);\n            return sendError(res, 500);\n        }\n        // 3. Check the persistent cache. If found, serve it via a \"trust-but-verify\" strategy.\n        // Build it after sending, and if it no longer matches then assume the entire cache is suspect.\n        // In that case, clear the persistent cache and then force a live-reload of the page.\n        const cachedBuildData = !filesBeingDeleted.has(fileLoc) &&\n            (await cacache.get(BUILD_CACHE, fileLoc).catch(() => null));\n        if (cachedBuildData) {\n            const { originalFileHash } = cachedBuildData.metadata;\n            const newFileHash = etag(fileContents);\n            if (originalFileHash === newFileHash) {\n                const coldCachedResponse = cachedBuildData.data;\n                if (!isProxyModule) {\n                    inMemoryBuildCache.set(fileLoc, coldCachedResponse);\n                }\n                let serverResponse = coldCachedResponse;\n                if (isRoute) {\n                    serverResponse =\n                        serverResponse.toString() +\n                            `<script type=\"module\" src=\"/web_modules/@snowpack/hmr.js\"></script>`;\n                }\n                if (isProxyModule) {\n                    responseFileExt = '.js';\n                    serverResponse = wrapEsmProxyResponse(reqPath, coldCachedResponse.toString(), requestedFileExt, true);\n                }\n                // Trust... but verify.\n                sendFile(req, res, serverResponse, responseFileExt);\n                if (!isProxyModule) {\n                    let checkFinalBuildAnyway = null;\n                    try {\n                        checkFinalBuildAnyway = await buildFile(fileContents, fileLoc, fileBuilder);\n                    }\n                    catch (err) {\n                        // safe to ignore, it will be surfaced later anyway\n                    }\n                    finally {\n                        if (!checkFinalBuildAnyway ||\n                            !coldCachedResponse.equals(Buffer.from(checkFinalBuildAnyway, getEncodingType(requestedFileExt)))) {\n                            inMemoryBuildCache.clear();\n                            await cacache.rm.all(BUILD_CACHE);\n                            broadcast('message', 'reload');\n                        }\n                    }\n                }\n                return;\n            }\n        }\n        // 4. Final option: build the file, serve it, and cache it.\n        let finalBuild;\n        try {\n            finalBuild = await buildFile(fileContents, fileLoc, fileBuilder);\n        }\n        catch (err) {\n            console.error(fileLoc, err);\n            return sendError(res, 500);\n        }\n        if (!isProxyModule) {\n            inMemoryBuildCache.set(fileLoc, Buffer.from(finalBuild, getEncodingType(requestedFileExt)));\n            const originalFileHash = etag(fileContents);\n            cacache.put(BUILD_CACHE, fileLoc, Buffer.from(finalBuild, getEncodingType(requestedFileExt)), { metadata: { originalFileHash } });\n        }\n        if (isRoute) {\n            finalBuild += `<script type=\"module\" src=\"/web_modules/@snowpack/hmr.js\"></script>`;\n        }\n        if (isProxyModule) {\n            responseFileExt = '.js';\n            finalBuild = wrapEsmProxyResponse(reqPath, finalBuild, requestedFileExt, true);\n        }\n        sendFile(req, res, finalBuild, responseFileExt);\n    })\n        .listen(port);\n    async function onWatchEvent(event, fileLoc) {\n        const fileUrl = getUrlFromFile(fileLoc);\n        broadcast('message', JSON.stringify({ url: fileUrl, event }));\n        inMemoryBuildCache.delete(fileLoc);\n        filesBeingDeleted.add(fileLoc);\n        await cacache.rm.entry(BUILD_CACHE, fileLoc);\n        filesBeingDeleted.delete(fileLoc);\n    }\n    const watcher = chokidar.watch(mountedDirectories.map(([dirDisk]) => dirDisk), {\n        ignored: config.exclude,\n        persistent: true,\n        ignoreInitial: true,\n        disableGlobbing: false,\n    });\n    ;\n    ['add', 'change', 'unlink'].forEach(event => {\n        watcher.on(event, (fileLoc) => onWatchEvent(event, fileLoc));\n    });\n    process.on('SIGINT', () => {\n        for (const client of liveReloadClients) {\n            client.end();\n        }\n        process.exit(0);\n    });\n    console.log = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'log', args });\n    };\n    console.warn = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'warn', args });\n    };\n    console.error = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'error', args });\n    };\n    const ips = Object.values(os.networkInterfaces())\n        .reduce((every, i) => [...every, ...(i || [])], [])\n        .filter((i) => i.family === 'IPv4' && i.internal === false)\n        .map((i) => i.address);\n    paint(messageBus, registeredWorkers, undefined, {\n        port,\n        ips,\n        startTimeMs: Date.now() - serverStart,\n    });\n    openInBrowser(port);\n    return new Promise(() => { });\n}\nfunction openInBrowser(port) {\n    const url = `http://localhost:${port}`;\n    let openCmd = 'xdg-open';\n    if (process.platform === 'darwin')\n        openCmd = 'open';\n    if (process.platform === 'win32')\n        openCmd = 'start';\n    execa(openCmd, [url]).catch(() => {\n        // couldn't open automatically, safe to ignore\n    });\n}\n","import path from 'path';\nimport { cosmiconfigSync } from 'cosmiconfig';\nimport { validate } from 'jsonschema';\nimport { all as merge } from 'deepmerge';\nimport chalk from 'chalk';\nconst CONFIG_NAME = 'snowpack';\nconst ALWAYS_EXCLUDE = ['node_modules/**/*', '.types/**/*'];\n// default settings\nconst DEFAULT_CONFIG = {\n    exclude: ['__tests__/**/*', '**/*.@(spec|test).*'],\n    knownEntrypoints: [],\n    installOptions: {\n        dest: 'web_modules',\n        externalPackage: [],\n        installTypes: false,\n        env: {},\n        alias: {},\n        rollup: {\n            plugins: [],\n            dedupe: [],\n        },\n    },\n    devOptions: {\n        port: 8080,\n        out: 'build',\n        fallback: 'index.html',\n        bundle: undefined,\n    },\n};\nconst configSchema = {\n    type: 'object',\n    properties: {\n        extends: { type: 'string' },\n        knownEntrypoints: { type: 'array', items: { type: 'string' } },\n        exclude: { type: 'array', items: { type: 'string' } },\n        webDependencies: {\n            type: ['object'],\n            additionalProperties: { type: 'string' },\n        },\n        installOptions: {\n            type: 'object',\n            properties: {\n                dest: { type: 'string' },\n                externalPackage: { type: 'array', items: { type: 'string' } },\n                installTypes: { type: 'boolean' },\n                sourceMap: { oneOf: [{ type: 'boolean' }, { type: 'string' }] },\n                alias: {\n                    type: 'object',\n                    additionalProperties: { type: 'string' },\n                },\n                env: {\n                    type: 'object',\n                    additionalProperties: {\n                        oneOf: [\n                            { id: 'EnvVarString', type: 'string' },\n                            { id: 'EnvVarNumber', type: 'number' },\n                            { id: 'EnvVarTrue', type: 'boolean', enum: [true] },\n                        ],\n                    },\n                },\n                rollup: {\n                    type: 'object',\n                    properties: {\n                        plugins: { type: 'array', items: { type: 'object' } },\n                        dedupe: {\n                            type: 'array',\n                            items: { type: 'string' },\n                        },\n                        namedExports: {\n                            type: 'object',\n                            additionalProperties: { type: 'array', items: { type: 'string' } },\n                        },\n                    },\n                },\n            },\n        },\n        devOptions: {\n            type: 'object',\n            properties: {\n                port: { type: 'number' },\n                out: { type: 'string' },\n                fallback: { type: 'string' },\n                bundle: { type: 'boolean' },\n            },\n        },\n        scripts: {\n            type: 'object',\n            additionalProperties: { type: ['string'] },\n        },\n    },\n};\n/**\n * Convert CLI flags to an incomplete Snowpack config representation.\n * We need to be careful about setting properties here if the flag value\n * is undefined, since the deep merge strategy would then overwrite good\n * defaults with 'undefined'.\n */\nfunction expandCliFlags(flags) {\n    const result = {\n        installOptions: {},\n        devOptions: {},\n    };\n    const { help, version, config, ...relevantFlags } = flags;\n    for (const [flag, val] of Object.entries(relevantFlags)) {\n        if (flag === '_' || flag.includes('-')) {\n            continue;\n        }\n        if (configSchema.properties[flag]) {\n            result[flag] = val;\n            continue;\n        }\n        if (configSchema.properties.installOptions.properties[flag]) {\n            result.installOptions[flag] = val;\n            continue;\n        }\n        if (configSchema.properties.devOptions.properties[flag]) {\n            result.devOptions[flag] = val;\n            continue;\n        }\n        console.error(`Unknown CLI flag: \"${flag}\"`);\n        process.exit(1);\n    }\n    if (result.installOptions.env) {\n        result.installOptions.env = result.installOptions.env.reduce((acc, id) => {\n            const index = id.indexOf('=');\n            const [key, val] = index > 0 ? [id.substr(0, index), id.substr(index + 1)] : [id, true];\n            acc[key] = val;\n            return acc;\n        }, {});\n    }\n    return result;\n}\n/** resolve --dest relative to cwd, etc. */\nfunction normalizeConfig(config) {\n    const cwd = process.cwd();\n    config.installOptions.dest = path.resolve(cwd, config.installOptions.dest);\n    config.devOptions.out = path.resolve(cwd, config.devOptions.out);\n    config.exclude = Array.from(new Set([...ALWAYS_EXCLUDE, ...config.exclude]));\n    if (!config.scripts) {\n        config.exclude.push('.*');\n        config.scripts = {\n            'mount:*': 'mount . --to .',\n        };\n    }\n    for (const scriptId of Object.keys(config.scripts)) {\n        if (scriptId.includes('::watch')) {\n            continue;\n        }\n        config.scripts[scriptId] = {\n            cmd: config.scripts[scriptId],\n            watch: config.scripts[`${scriptId}::watch`],\n        };\n    }\n    for (const scriptId of Object.keys(config.scripts)) {\n        if (scriptId.includes('::watch')) {\n            delete config.scripts[scriptId];\n        }\n    }\n    return config;\n}\nfunction handleConfigError(msg) {\n    console.error(`[error]: ${msg}`);\n    process.exit(1);\n}\nfunction handleValidationErrors(filepath, errors) {\n    console.error(chalk.red(`! ${filepath || 'Configuration error'}`));\n    console.error(errors.map((err) => `    - ${err.toString()}`).join('\\n'));\n    console.error(`    See https://www.snowpack.dev/#configuration for more info.`);\n    process.exit(1);\n}\nfunction handleDeprecatedConfigError(mainMsg, ...msgs) {\n    console.error(chalk.red(mainMsg));\n    msgs.forEach(console.error);\n    console.error(`See https://www.snowpack.dev/#configuration for more info.`);\n    process.exit(1);\n}\nfunction validateConfigAgainstV1(rawConfig, cliFlags) {\n    // Moved!\n    if (rawConfig.dedupe || cliFlags.dedupe) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `dedupe` is now `installOptions.rollup.dedupe`.');\n    }\n    if (rawConfig.namedExports || cliFlags.namedExports) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `namedExports` is now `installOptions.rollup.namedExports`.');\n    }\n    if (rawConfig.rollup) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] top-level `rollup` config is now `installOptions.rollup`.');\n    }\n    if (rawConfig.installOptions?.include) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.include` is now `include` but its syntax has also changed!');\n    }\n    if (rawConfig.installOptions?.exclude) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.exclude` is now `exclude`.');\n    }\n    if (Array.isArray(rawConfig.webDependencies)) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] The `webDependencies` array is now `knownEntrypoints`.');\n    }\n    if (rawConfig.entrypoints) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `entrypoints` is now `knownEntrypoints`.');\n    }\n    if (rawConfig.include) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] All files are now included by default. \"include\" config is safe to remove.', 'Whitelist & include specific folders via \"mount\" build scripts.');\n    }\n    // Replaced!\n    if (rawConfig.source || cliFlags.source) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `source` is now detected automatically, this config is safe to remove.');\n    }\n    if (rawConfig.stat || cliFlags.stat) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `stat` is now the default output, this config is safe to remove.');\n    }\n    // Removed!\n    if (rawConfig.devOptions?.dist) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `devOptions.dist` is no longer required. This config is safe to remove.', `If you'd still like to host your src/ directory at the \"/_dist/*\" URL, create a mount script:',\n      '    {\"scripts\": {\"mount:src\": \"mount src --to _dist_\"}} `);\n    }\n    if (rawConfig.hash || cliFlags.hash) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.hash` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.nomodule || cliFlags.nomodule) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.nomodule` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.nomoduleOutput || cliFlags.nomoduleOutput) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.nomoduleOutput` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.babel || cliFlags.babel) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.babel` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.optimize || cliFlags.optimize) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.optimize` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.strict || cliFlags.strict) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.strict` is no longer supported.');\n    }\n}\nexport function loadAndValidateConfig(flags, pkgManifest) {\n    const explorerSync = cosmiconfigSync(CONFIG_NAME, {\n        // only support these 3 types of config for now\n        searchPlaces: ['package.json', 'snowpack.config.js', 'snowpack.config.json'],\n        // don't support crawling up the folder tree:\n        stopDir: path.dirname(process.cwd()),\n    });\n    let result;\n    // if user specified --config path, load that\n    if (flags.config) {\n        result = explorerSync.load(path.resolve(process.cwd(), flags.config));\n        if (!result) {\n            handleConfigError(`Could not locate Snowpack config at ${flags.config}`);\n        }\n    }\n    // If no config was found above, search for one.\n    result = result || explorerSync.search();\n    // If still no config found, assume none exists and use the default config.\n    if (!result || !result.config || result.isEmpty) {\n        result = { config: { ...DEFAULT_CONFIG } };\n    }\n    // validate against schema; throw helpful user if invalid\n    const config = result.config;\n    validateConfigAgainstV1(config, flags);\n    const cliConfig = expandCliFlags(flags);\n    const validation = validate(config, configSchema, {\n        allowUnknownAttributes: false,\n        propertyName: CONFIG_NAME,\n    });\n    if (validation.errors && validation.errors.length > 0) {\n        handleValidationErrors(result.filepath, validation.errors);\n        process.exit(1);\n    }\n    let extendConfig = {};\n    if (config.extends) {\n        const extendConfigLoc = config.extends.startsWith('.')\n            ? path.resolve(path.dirname(result.filepath), config.extends)\n            : require.resolve(config.extends, { paths: [process.cwd()] });\n        const extendResult = explorerSync.load(extendConfigLoc);\n        if (!extendResult) {\n            handleConfigError(`Could not locate Snowpack config at ${flags.config}`);\n            process.exit(1);\n        }\n        extendConfig = extendResult.config;\n        const extendValidation = validate(extendConfig, configSchema, {\n            allowUnknownAttributes: false,\n            propertyName: CONFIG_NAME,\n        });\n        if (extendValidation.errors && extendValidation.errors.length > 0) {\n            handleValidationErrors(result.filepath, extendValidation.errors);\n            process.exit(1);\n        }\n    }\n    // if valid, apply config over defaults\n    const overwriteMerge = (destinationArray, sourceArray, options) => sourceArray;\n    const mergedConfig = merge([\n        DEFAULT_CONFIG,\n        extendConfig,\n        {\n            webDependencies: pkgManifest.webDependencies,\n            homepage: pkgManifest.homepage,\n        },\n        config,\n        cliConfig,\n    ], { arrayMerge: overwriteMerge });\n    for (const webDependencyName of Object.keys(mergedConfig.webDependencies || {})) {\n        if (pkgManifest.dependencies && pkgManifest.dependencies[webDependencyName]) {\n            handleConfigError(`\"${webDependencyName}\" is included in \"webDependencies\". Please remove it from your package.json \"dependencies\" config.`);\n        }\n        if (pkgManifest.devDependencies && pkgManifest.devDependencies[webDependencyName]) {\n            handleConfigError(`\"${webDependencyName}\" is included in \"webDependencies\". Please remove it from your package.json \"devDependencies\" config.`);\n        }\n    }\n    // if CLI flags present, apply those as overrides\n    return normalizeConfig(mergedConfig);\n}\n","import cacache from 'cacache';\nimport PQueue from 'p-queue';\nimport chalk from 'chalk';\nimport validatePackageName from 'validate-npm-package-name';\nimport { fetchCDNResource, PIKA_CDN, RESOURCE_CACHE } from './util.js';\n/**\n * Given an install specifier, attempt to resolve it from the CDN.\n * If no lockfile exists or if the entry is not found in the lockfile, attempt to resolve\n * it from the CDN directly. Otherwise, use the URL found in the lockfile and attempt to\n * check the local cache first.\n *\n * All resolved URLs are populated into the local cache, where our internal Rollup engine\n * will load them from when it installs your dependencies to disk.\n */\nasync function resolveDependency(installSpecifier, packageSemver, lockfile, canRetry = true) {\n    // Right now, the CDN is only for top-level JS packages. The CDN doesn't support CSS,\n    // non-JS assets, and has limited support for deep package imports. Snowpack\n    // will automatically fall-back any failed/not-found assets from local\n    // node_modules/ instead.\n    if (!validatePackageName(installSpecifier).validForNewPackages) {\n        return null;\n    }\n    // Grab the installUrl from our lockfile if it exists, otherwise resolve it yourself.\n    let installUrl;\n    let installUrlType;\n    if (lockfile && lockfile.imports[installSpecifier]) {\n        installUrl = lockfile.imports[installSpecifier];\n        installUrlType = 'pin';\n    }\n    else {\n        if (packageSemver === 'latest') {\n            console.warn(`warn(${installSpecifier}): Not found in \"dependencies\". Using latest package version...`);\n        }\n        if (packageSemver.startsWith('npm:@reactesm') || packageSemver.startsWith('npm:@pika/react')) {\n            throw new Error(`React workaround packages no longer needed! Revert to the official React & React-DOM packages.`);\n        }\n        if (packageSemver.includes(' ') || packageSemver.includes(':')) {\n            console.warn(`warn(${installSpecifier}): Can't fetch complex semver \"${packageSemver}\" from remote CDN.`);\n            return null;\n        }\n        installUrlType = 'lookup';\n        installUrl = `${PIKA_CDN}/${installSpecifier}@${packageSemver}`;\n    }\n    // Hashed CDN urls never change, so its safe to grab them directly from the local cache\n    // without a network request.\n    if (installUrlType === 'pin') {\n        const cachedResult = await cacache.get.info(RESOURCE_CACHE, installUrl).catch(() => null);\n        if (cachedResult) {\n            if (cachedResult.metadata) {\n                const { pinnedUrl } = cachedResult.metadata;\n                return pinnedUrl;\n            }\n        }\n    }\n    // Otherwise, resolve from the CDN remotely.\n    const { statusCode, headers, body } = await fetchCDNResource(installUrl);\n    if (statusCode !== 200) {\n        console.warn(`Failed to resolve [${statusCode}]: ${installUrl} (${body})`);\n        console.warn(`Falling back to local copy...`);\n        return null;\n    }\n    let importUrlPath = headers['x-import-url'];\n    let pinnedUrlPath = headers['x-pinned-url'];\n    const buildStatus = headers['x-import-status'];\n    const typesUrlPath = headers['x-typescript-types'];\n    const typesUrl = typesUrlPath && `${PIKA_CDN}${typesUrlPath}`;\n    if (installUrlType === 'pin') {\n        const pinnedUrl = installUrl;\n        await cacache.put(RESOURCE_CACHE, pinnedUrl, body, {\n            metadata: { pinnedUrl, typesUrl },\n        });\n        return pinnedUrl;\n    }\n    if (pinnedUrlPath) {\n        const pinnedUrl = `${PIKA_CDN}${pinnedUrlPath}`;\n        await cacache.put(RESOURCE_CACHE, pinnedUrl, body, {\n            metadata: { pinnedUrl, typesUrl },\n        });\n        return pinnedUrl;\n    }\n    if (buildStatus === 'SUCCESS') {\n        console.warn(`Failed to lookup [${statusCode}]: ${installUrl}`);\n        console.warn(`Falling back to local copy...`);\n        return null;\n    }\n    if (!canRetry || buildStatus === 'FAIL') {\n        console.warn(`Failed to build: ${installSpecifier}@${packageSemver}`);\n        console.warn(`Falling back to local copy...`);\n        return null;\n    }\n    console.log(chalk.cyan(`Building ${installSpecifier}@${packageSemver}... (This takes a moment, but will be cached for future use)`));\n    if (!importUrlPath) {\n        throw new Error('X-Import-URL header expected, but none received.');\n    }\n    const { statusCode: lookupStatusCode } = await fetchCDNResource(importUrlPath);\n    if (lookupStatusCode !== 200) {\n        throw new Error(`Unexpected response [${lookupStatusCode}]: ${PIKA_CDN}${importUrlPath}`);\n    }\n    return resolveDependency(installSpecifier, packageSemver, lockfile, false);\n}\nexport async function resolveTargetsFromRemoteCDN(lockfile, pkgManifest, config) {\n    const downloadQueue = new PQueue({ concurrency: 16 });\n    const newLockfile = { imports: {} };\n    let resolutionError;\n    for (const [installSpecifier, installSemver] of Object.entries(config.webDependencies)) {\n        downloadQueue.add(async () => {\n            try {\n                const resolvedUrl = await resolveDependency(installSpecifier, installSemver, lockfile);\n                if (resolvedUrl) {\n                    newLockfile.imports[installSpecifier] = resolvedUrl;\n                }\n            }\n            catch (err) {\n                resolutionError = resolutionError || err;\n            }\n        });\n    }\n    await downloadQueue.onIdle();\n    if (resolutionError) {\n        throw resolutionError;\n    }\n    return newLockfile;\n}\nexport function clearCache() {\n    return cacache.rm.all(RESOURCE_CACHE);\n}\n","import path from 'path';\nimport { resolveDependencyManifest } from './util';\nconst IS_DEEP_PACKAGE_IMPORT = /^(@[\\w-]+\\/)?([\\w-]+)\\/(.*)/;\n/**\n * rollup-plugin-entrypoint-alias\n *\n * Aliases any deep imports from a package to the package name, so that\n * chunking can happen more accurately.\n *\n * Example: lit-element imports from both 'lit-html' & 'lit-html/lit-html.js'.\n * Even though both eventually resolve to the same place, without this plugin\n * we lose the ability to mark \"lit-html\" as an external package.\n */\nexport function rollupPluginEntrypointAlias({ cwd }) {\n    return {\n        name: 'snowpack:rollup-plugin-entrypoint-alias',\n        resolveId(source, importer) {\n            if (!IS_DEEP_PACKAGE_IMPORT.test(source)) {\n                return null;\n            }\n            const [, packageScope, packageName] = source.match(IS_DEEP_PACKAGE_IMPORT);\n            const packageFullName = packageScope ? `${packageScope}${packageName}` : packageName;\n            const [, manifest] = resolveDependencyManifest(packageFullName, cwd);\n            if (!manifest) {\n                return null;\n            }\n            let needsAlias = (typeof manifest.module === 'string' &&\n                source === path.posix.join(packageFullName, manifest.module)) ||\n                (typeof manifest.browser === 'string' &&\n                    source === path.posix.join(packageFullName, manifest.browser)) ||\n                (typeof manifest.main === 'string' &&\n                    source === path.posix.join(packageFullName, manifest.main));\n            if (!needsAlias) {\n                return null;\n            }\n            return this.resolve(packageFullName, importer, { skipSelf: true }).then((resolved) => {\n                return resolved || null;\n            });\n        },\n    };\n}\n","import mkdirp from 'mkdirp';\nimport cacache from 'cacache';\nimport url from 'url';\nimport fs from 'fs';\nimport path from 'path';\nimport tar from 'tar';\nimport { fetchCDNResource, HAS_CDN_HASH_REGEX, PIKA_CDN, RESOURCE_CACHE } from './util';\nconst CACHED_FILE_ID_PREFIX = 'snowpack-pkg-cache:';\nconst PIKA_CDN_TRIM_LENGTH = PIKA_CDN.length;\n/**\n * rollup-plugin-remote-cdn\n *\n * Load import URLs from a remote CDN, sitting behind a local cache. The local\n * cache acts as a go-between for the resolve & load step: when we get back a\n * successful CDN resolution, we save the file to the local cache and then tell\n * rollup that it's safe to load from the cache in the `load()` hook.\n */\nexport function rollupPluginDependencyCache({ installTypes, log, }) {\n    const allTypesToInstall = new Set();\n    return {\n        name: 'snowpack:rollup-plugin-remote-cdn',\n        async resolveId(source, importer) {\n            let cacheKey;\n            if (source.startsWith(PIKA_CDN)) {\n                cacheKey = source;\n            }\n            else if (source.startsWith('/-/')) {\n                cacheKey = PIKA_CDN + source;\n            }\n            else if (source.startsWith('/pin/')) {\n                cacheKey = PIKA_CDN + source;\n            }\n            else {\n                return null;\n            }\n            // If the source path is a CDN path including a hash, it's assumed the\n            // file will never change and it is safe to pull from our local cache\n            // without a network request.\n            log(cacheKey);\n            if (HAS_CDN_HASH_REGEX.test(cacheKey)) {\n                const cachedResult = await cacache.get\n                    .info(RESOURCE_CACHE, cacheKey)\n                    .catch(( /* ignore */) => null);\n                if (cachedResult) {\n                    return CACHED_FILE_ID_PREFIX + cacheKey;\n                }\n            }\n            // Otherwise, make the remote request and cache the file on success.\n            const response = await fetchCDNResource(cacheKey);\n            if (response.statusCode === 200) {\n                const typesUrlPath = response.headers['x-typescript-types'];\n                const pinnedUrlPath = response.headers['x-pinned-url'];\n                const typesUrl = typesUrlPath && `${PIKA_CDN}${typesUrlPath}`;\n                const pinnedUrl = pinnedUrlPath && `${PIKA_CDN}${pinnedUrlPath}`;\n                await cacache.put(RESOURCE_CACHE, cacheKey, response.body, {\n                    metadata: { pinnedUrl, typesUrl },\n                });\n                return CACHED_FILE_ID_PREFIX + cacheKey;\n            }\n            // If lookup failed, skip this plugin and resolve the import locally instead.\n            // TODO: Log that this has happened (if some sort of verbose mode is enabled).\n            const packageName = cacheKey\n                .substring(PIKA_CDN_TRIM_LENGTH)\n                .replace('/-/', '')\n                .replace('/pin/', '')\n                .split('@')[0];\n            return this.resolve(packageName, importer, { skipSelf: true }).then((resolved) => {\n                let finalResult = resolved;\n                if (!finalResult) {\n                    finalResult = { id: packageName };\n                }\n                return finalResult;\n            });\n        },\n        async load(id) {\n            if (!id.startsWith(CACHED_FILE_ID_PREFIX)) {\n                return null;\n            }\n            const cacheKey = id.substring(CACHED_FILE_ID_PREFIX.length);\n            log(cacheKey);\n            const cachedResult = await cacache.get(RESOURCE_CACHE, cacheKey);\n            const typesUrl = cachedResult.metadata?.typesUrl;\n            if (typesUrl && installTypes) {\n                const typesTarballUrl = typesUrl.replace(/(mode=types.*?)\\/.*/, '$1/all.tgz');\n                allTypesToInstall.add(typesTarballUrl);\n            }\n            return cachedResult.data.toString('utf8');\n        },\n        async writeBundle(options) {\n            if (!installTypes) {\n                return;\n            }\n            await mkdirp(path.join(options.dir, '.types'));\n            const tempDir = await cacache.tmp.mkdir(RESOURCE_CACHE);\n            for (const typesTarballUrl of allTypesToInstall) {\n                let tarballContents;\n                const cachedTarball = await cacache\n                    .get(RESOURCE_CACHE, typesTarballUrl)\n                    .catch(( /* ignore */) => null);\n                if (cachedTarball) {\n                    tarballContents = cachedTarball.data;\n                }\n                else {\n                    const tarballResponse = await fetchCDNResource(typesTarballUrl, 'buffer');\n                    if (tarballResponse.statusCode !== 200) {\n                        continue;\n                    }\n                    tarballContents = tarballResponse.body;\n                    await cacache.put(RESOURCE_CACHE, typesTarballUrl, tarballContents);\n                }\n                const typesUrlParts = url.parse(typesTarballUrl).pathname.split('/');\n                const typesPackageName = url.parse(typesTarballUrl).pathname.startsWith('/-/@')\n                    ? typesUrlParts[2] + '/' + typesUrlParts[3].split('@')[0]\n                    : typesUrlParts[2].split('@')[0];\n                const typesPackageTarLoc = path.join(tempDir, `${typesPackageName}.tgz`);\n                if (typesPackageName.includes('/')) {\n                    await mkdirp(path.dirname(typesPackageTarLoc));\n                }\n                fs.writeFileSync(typesPackageTarLoc, tarballContents);\n                const typesPackageLoc = path.join(options.dir, `.types/${typesPackageName}`);\n                await mkdirp(typesPackageLoc);\n                await tar.x({\n                    file: typesPackageTarLoc,\n                    cwd: typesPackageLoc,\n                });\n            }\n        },\n    };\n}\n","import fs from 'fs';\nimport path from 'path';\nimport zlib from 'zlib';\nexport function rollupPluginDependencyStats(cb) {\n    let outputDir;\n    let existingFileCache = {};\n    let statsSummary = {\n        direct: {},\n        common: {},\n    };\n    function buildExistingFileCache(bundle) {\n        for (let fileName of Object.keys(bundle)) {\n            const filePath = path.join(outputDir, fileName);\n            if (fs.existsSync(filePath)) {\n                const { size } = fs.statSync(filePath);\n                existingFileCache[fileName] = size;\n            }\n        }\n    }\n    function compareDependencies(files, type) {\n        for (let { fileName, contents } of files) {\n            const size = contents.byteLength;\n            statsSummary[type][fileName] = {\n                size: size,\n                gzip: zlib.gzipSync(contents).byteLength,\n                brotli: zlib.brotliCompressSync(contents).byteLength,\n            };\n            if (existingFileCache[fileName]) {\n                const delta = (size - existingFileCache[fileName]) / 1000;\n                statsSummary[type][fileName].delta = delta;\n            }\n        }\n    }\n    return {\n        name: 'snowpack:rollup-plugin-stats',\n        generateBundle(options, bundle) {\n            outputDir = options.dir;\n            buildExistingFileCache(bundle);\n        },\n        writeBundle(options, bundle) {\n            const directDependencies = [];\n            const commonDependencies = [];\n            for (const [fileName, assetOrChunk] of Object.entries(bundle)) {\n                const raw = assetOrChunk.type === 'asset' ? assetOrChunk.source : assetOrChunk.code;\n                const contents = Buffer.isBuffer(raw)\n                    ? raw\n                    : typeof raw === 'string'\n                        ? Buffer.from(raw, 'utf8')\n                        : Buffer.from(raw);\n                if (fileName.startsWith('common')) {\n                    commonDependencies.push({ fileName, contents });\n                }\n                else {\n                    directDependencies.push({ fileName, contents });\n                }\n            }\n            compareDependencies(directDependencies, 'direct');\n            compareDependencies(commonDependencies, 'common');\n            cb(statsSummary);\n        },\n    };\n}\n","import babel from '@babel/core';\nimport chalk from 'chalk';\nimport nodePath from 'path';\nimport fs from 'fs';\nimport glob from 'glob';\nimport mime from 'mime-types';\nimport validatePackageName from 'validate-npm-package-name';\nimport { init as initESModuleLexer, parse } from 'es-module-lexer';\nimport { isTruthy } from './util';\nconst WEB_MODULES_TOKEN = 'web_modules/';\nconst WEB_MODULES_TOKEN_LENGTH = WEB_MODULES_TOKEN.length;\n// [@\\w] - Match a word-character or @ (valid package name)\n// (?!.*(:\\/\\/)) - Ignore if previous match was a protocol (ex: http://)\nconst BARE_SPECIFIER_REGEX = /^[@\\w](?!.*(:\\/\\/))/;\nconst HAS_NAMED_IMPORTS_REGEX = /^[\\w\\s\\,]*\\{(.*)\\}/s;\nconst SPLIT_NAMED_IMPORTS_REGEX = /\\bas\\s+\\w+|,/s;\nconst DEFAULT_IMPORT_REGEX = /import\\s+(\\w)+(,\\s\\{[\\w\\s]*\\})?\\s+from/s;\nconst HTML_JS_REGEX = /<script.*?>(.*)<\\/script>/gm;\nfunction stripJsExtension(dep) {\n    return dep.replace(/\\.m?js$/i, '');\n}\nfunction createInstallTarget(specifier, all = true) {\n    return {\n        specifier,\n        all,\n        default: false,\n        namespace: false,\n        named: [],\n    };\n}\nfunction removeSpecifierQueryString(specifier) {\n    const queryStringIndex = specifier.indexOf('?');\n    if (queryStringIndex >= 0) {\n        specifier = specifier.substring(0, queryStringIndex);\n    }\n    return specifier;\n}\nfunction getWebModuleSpecifierFromCode(code, imp) {\n    // import.meta: we can ignore\n    if (imp.d === -2) {\n        return null;\n    }\n    // Static imports: easy to parse\n    if (imp.d === -1) {\n        return code.substring(imp.s, imp.e);\n    }\n    // Dynamic imports: a bit trickier to parse. Today, we only support string literals.\n    const importStatement = code.substring(imp.s, imp.e);\n    const importSpecifierMatch = importStatement.match(/^\\s*['\"](.*)['\"]\\s*$/m);\n    return importSpecifierMatch ? importSpecifierMatch[1] : null;\n}\n/**\n * parses an import specifier, looking for a web modules to install. If a web module is not detected,\n * null is returned.\n */\nfunction parseWebModuleSpecifier(specifier) {\n    if (!specifier) {\n        return null;\n    }\n    // If specifier is a \"bare module specifier\" (ie: package name) just return it directly\n    if (BARE_SPECIFIER_REGEX.test(specifier)) {\n        return specifier;\n    }\n    // Clean the specifier, remove any query params that may mess with matching\n    const cleanedSpecifier = removeSpecifierQueryString(specifier);\n    // Otherwise, check that it includes the \"web_modules/\" directory\n    const webModulesIndex = cleanedSpecifier.indexOf(WEB_MODULES_TOKEN);\n    if (webModulesIndex === -1) {\n        return null;\n    }\n    // Check if this matches `@scope/package.js` or `package.js` format.\n    // If it is, assume that this is a top-level pcakage that should be installed without the “.js”\n    const resolvedSpecifier = cleanedSpecifier.substring(webModulesIndex + WEB_MODULES_TOKEN_LENGTH);\n    const resolvedSpecifierWithoutExtension = stripJsExtension(resolvedSpecifier);\n    if (validatePackageName(resolvedSpecifierWithoutExtension).validForNewPackages) {\n        return resolvedSpecifierWithoutExtension;\n    }\n    // Otherwise, this is an explicit import to a file within a package.\n    return resolvedSpecifier;\n}\nfunction parseImportStatement(code, imp) {\n    const webModuleSpecifier = parseWebModuleSpecifier(getWebModuleSpecifierFromCode(code, imp));\n    if (!webModuleSpecifier) {\n        return null;\n    }\n    const importStatement = code.substring(imp.ss, imp.se);\n    if (/^import\\s+type/.test(importStatement)) {\n        return null;\n    }\n    const dynamicImport = imp.d > -1;\n    const defaultImport = !dynamicImport && DEFAULT_IMPORT_REGEX.test(importStatement);\n    const namespaceImport = !dynamicImport && importStatement.includes('*');\n    const namedImports = (importStatement.match(HAS_NAMED_IMPORTS_REGEX) || [, ''])[1]\n        .split(SPLIT_NAMED_IMPORTS_REGEX)\n        .map((name) => name.trim())\n        .filter(isTruthy);\n    return {\n        specifier: webModuleSpecifier,\n        all: dynamicImport,\n        default: defaultImport,\n        namespace: namespaceImport,\n        named: namedImports,\n    };\n}\nfunction getInstallTargetsForFile(code) {\n    const [imports] = parse(code) || [];\n    const allImports = imports\n        .map((imp) => parseImportStatement(code, imp))\n        .filter(isTruthy);\n    return allImports;\n}\nexport function scanDepList(depList, cwd) {\n    return depList\n        .map((whitelistItem) => {\n        if (!glob.hasMagic(whitelistItem)) {\n            return [createInstallTarget(whitelistItem, true)];\n        }\n        else {\n            const nodeModulesLoc = nodePath.join(cwd, 'node_modules');\n            return scanDepList(glob.sync(whitelistItem, { cwd: nodeModulesLoc, nodir: true }), cwd);\n        }\n    })\n        .reduce((flat, item) => flat.concat(item), []);\n}\nexport async function scanImports(cwd, { scripts, exclude }) {\n    await initESModuleLexer;\n    const includeFileSets = await Promise.all(Object.entries(scripts).map(([id, scriptConfig]) => {\n        if (!id.startsWith('mount:')) {\n            return [];\n        }\n        const cmdArr = scriptConfig.cmd.split(/\\s+/);\n        if (cmdArr[0] !== 'mount') {\n            throw new Error(`script[${id}] must use the mount command`);\n        }\n        cmdArr.shift();\n        if (cmdArr[0].includes('web_modules')) {\n            return [];\n        }\n        const dirDisk = nodePath.resolve(cwd, cmdArr[0]);\n        return glob.sync(`**/*`, {\n            ignore: exclude,\n            cwd: dirDisk,\n            absolute: true,\n            nodir: true,\n        });\n    }));\n    const includeFiles = Array.from(new Set([].concat.apply([], includeFileSets)));\n    if (includeFiles.length === 0) {\n        console.warn(`[ERROR]: No mouned files.`);\n        return [];\n    }\n    // Scan every matched JS file for web dependency imports\n    const loadedFiles = await Promise.all(includeFiles.map(async (filePath) => {\n        const ext = nodePath.extname(filePath);\n        // Always ignore dotfiles\n        if (filePath.startsWith('.')) {\n            return null;\n        }\n        // Probably a license, a README, etc\n        if (ext === '') {\n            return null;\n        }\n        // Our import scanner can handle normal JS & even TypeScript without a problem.\n        if (ext === '.js' || ext === '.mjs' || ext === '.ts') {\n            return fs.promises.readFile(filePath, 'utf-8');\n        }\n        // JSX breaks our import scanner, so we need to transform it before sending it to our scanner.\n        if (ext === '.jsx' || ext === '.tsx') {\n            const result = await babel.transformFileAsync(filePath, {\n                plugins: [\n                    [require('@babel/plugin-transform-react-jsx'), { runtime: 'classic' }],\n                    [require('@babel/plugin-syntax-typescript'), { isTSX: true }],\n                ],\n                babelrc: false,\n                configFile: false,\n            });\n            return result && result.code;\n        }\n        if (ext === '.vue' || ext === '.svelte') {\n            const result = await fs.promises.readFile(filePath, 'utf-8');\n            // TODO: Replace with matchAll once Node v10 is out of TLS.\n            // const allMatches = [...result.matchAll(HTML_JS_REGEX)];\n            const allMatches = [];\n            let match;\n            while ((match = HTML_JS_REGEX.exec(result))) {\n                allMatches.push(match);\n            }\n            return allMatches.map((full, code) => code).join('\\n');\n        }\n        // If we don't recognize the file type, it could be source. Warn just in case.\n        if (!mime.lookup(nodePath.extname(filePath))) {\n            console.warn(chalk.dim(`ignoring unsupported file \"${nodePath.relative(process.cwd(), filePath)}\"`));\n        }\n        return null;\n    }));\n    return loadedFiles\n        .filter((code) => !!code)\n        .map((code) => getInstallTargetsForFile(code))\n        .reduce((flat, item) => flat.concat(item), [])\n        .sort((impA, impB) => impA.specifier.localeCompare(impB.specifier));\n}\n","import chalk from 'chalk';\n/** The minimum width, in characters, of each size column */\nconst SIZE_COLUMN_WIDTH = 11;\n/** Generic Object.entries() alphabetical sort by keys. */\nfunction entriesSort([filenameA], [filenameB]) {\n    return filenameA.localeCompare(filenameB);\n}\n/** Pretty-prints number of bytes as \"XXX KB\" */\nfunction formatSize(size) {\n    let kb = Math.round((size / 1000) * 100) / 100;\n    if (kb >= 1000) {\n        kb = Math.floor(kb);\n    }\n    let color;\n    if (kb < 15) {\n        color = 'green';\n    }\n    else if (kb < 30) {\n        color = 'yellow';\n    }\n    else {\n        color = 'red';\n    }\n    return chalk[color](`${kb} KB`.padEnd(SIZE_COLUMN_WIDTH));\n}\nfunction formatDelta(delta) {\n    const kb = Math.round(delta * 100) / 100;\n    const color = delta > 0 ? 'red' : 'green';\n    return chalk[color](`Δ ${delta > 0 ? '+' : ''}${kb} KB`);\n}\nfunction formatFileInfo(filename, stats, padEnd, isLastFile) {\n    const lineGlyph = chalk.dim(isLastFile ? '└─' : '├─');\n    const lineName = filename.padEnd(padEnd);\n    const fileStat = formatSize(stats.size);\n    const gzipStat = formatSize(stats.gzip);\n    const brotliStat = formatSize(stats.brotli);\n    const lineStat = fileStat + gzipStat + brotliStat;\n    let lineDelta = '';\n    if (stats.delta) {\n        lineDelta = chalk.dim('[') + formatDelta(stats.delta) + chalk.dim(']');\n    }\n    // Trim trailing whitespace (can mess with formatting), but keep indentation.\n    return `    ` + `${lineGlyph} ${lineName} ${lineStat} ${lineDelta}`.trim();\n}\nfunction formatFiles(files, padEnd) {\n    const strippedFiles = files.map(([filename, stats]) => [\n        filename.replace(/^common\\//, ''),\n        stats,\n    ]);\n    return strippedFiles\n        .map(([filename, stats], index) => formatFileInfo(filename, stats, padEnd, index >= files.length - 1))\n        .join('\\n');\n}\nexport function printStats(dependencyStats) {\n    let output = '';\n    const { direct, common } = dependencyStats;\n    const allDirect = Object.entries(direct).sort(entriesSort);\n    const allCommon = Object.entries(common).sort(entriesSort);\n    const maxFileNameLength = [...allCommon, ...allDirect].reduce((max, [filename]) => Math.max(filename.length, max), 'web_modules/'.length) + 1;\n    output +=\n        `  ⦿ ${chalk.bold('web_modules/'.padEnd(maxFileNameLength + 4))}` +\n            chalk.bold.underline('size'.padEnd(SIZE_COLUMN_WIDTH - 2)) +\n            '  ' +\n            chalk.bold.underline('gzip'.padEnd(SIZE_COLUMN_WIDTH - 2)) +\n            '  ' +\n            chalk.bold.underline('brotli'.padEnd(SIZE_COLUMN_WIDTH - 2)) +\n            `\\n`;\n    output += `${formatFiles(allDirect, maxFileNameLength)}\\n`;\n    if (Object.values(common).length > 0) {\n        output += `  ⦿ ${chalk.bold('web_modules/common/ (Shared)')}\\n`;\n        output += `${formatFiles(allCommon, maxFileNameLength)}\\n`;\n    }\n    return `\\n${output}\\n`;\n}\n","import path from 'path';\n/**\n * rollup-plugin-react-fix\n *\n * React is such a strange package, and causes some strange bug in\n * Rollup where this export is expected but missing. Adding it back\n * ourselves manually here.\n */\nexport function rollupPluginReactFix() {\n    return {\n        name: 'snowpack:rollup-plugin-react-fix',\n        transform(code, id) {\n            if (id.endsWith(path.join('react', 'index.js'))) {\n                return code + `\\nexport { react as __moduleExports };`;\n            }\n        },\n    };\n}\n","import rollupPluginAlias from '@rollup/plugin-alias';\nimport rollupPluginCommonjs from '@rollup/plugin-commonjs';\nimport rollupPluginJson from '@rollup/plugin-json';\nimport rollupPluginNodeResolve from '@rollup/plugin-node-resolve';\nimport rollupPluginReplace from '@rollup/plugin-replace';\nimport chalk from 'chalk';\nimport fs from 'fs';\nimport isNodeBuiltin from 'is-builtin-module';\nimport mkdirp from 'mkdirp';\nimport ora from 'ora';\nimport path from 'path';\nimport rimraf from 'rimraf';\nimport { rollup } from 'rollup';\nimport validatePackageName from 'validate-npm-package-name';\nimport yargs from 'yargs-parser';\nimport { command as buildCommand } from './commands/build';\nimport { command as devCommand } from './commands/dev';\nimport { loadAndValidateConfig } from './config.js';\nimport { clearCache, resolveTargetsFromRemoteCDN } from './resolve-remote.js';\nimport { rollupPluginEntrypointAlias } from './rollup-plugin-entrypoint-alias.js';\nimport { rollupPluginDependencyCache } from './rollup-plugin-remote-cdn.js';\nimport { rollupPluginDependencyStats } from './rollup-plugin-stats.js';\nimport { scanDepList, scanImports } from './scan-imports.js';\nimport { printStats } from './stats-formatter.js';\nimport { isTruthy, MISSING_PLUGIN_SUGGESTIONS, readLockfile, resolveDependencyManifest, writeLockfile, } from './util.js';\nimport { rollupPluginReactFix } from './rollup-plugin-react-fix';\nconst ALWAYS_SHOW_ERRORS = new Set(['react', 'react-dom']);\nconst cwd = process.cwd();\nconst banner = chalk.bold(`snowpack`) + ` installing... `;\nconst installResults = [];\nlet dependencyStats = null;\nlet spinner = ora(banner);\nlet spinnerHasError = false;\nfunction printHelp() {\n    console.log(`\n${chalk.bold(`snowpack`)} - Install npm dependencies to run natively on the web.\n${chalk.bold('Options:')}\n  --dest [path]             Specify destination directory (default: \"web_modules/\").\n  --clean                   Clear out the destination directory before install.\n  --optimize                Transpile, minify, and optimize installed dependencies for production.\n  --env                     Set environment variable(s) inside dependencies:\n                                - if only NAME given, reads value from real env var\n                                - if \\`NAME=value\\`, uses given value\n                                - NODE_ENV defaults to \"production\" with \"--optimize\" (overridable)\n  --babel                   Transpile installed dependencies. Also enabled with \"--optimize\".\n  --include [glob]          Auto-detect imports from file(s). Supports glob.\n  --exclude [glob]          Exclude files from --include. Follows glob’s ignore pattern.\n  --config [path]           Location of Snowpack config file.\n  --strict                  Only install pure ESM dependency trees. Fail if a CJS module is encountered.\n  --no-source-map           Skip emitting source map files (.js.map) into dest\n  --stat                    Logs install statistics after installing, with information on install targets and file sizes. Useful for CI, performance review.\n  --nomodule [path]         Your app’s entry file for generating a <script nomodule> bundle\n  --nomodule-output [path]  Filename for nomodule output (default: \"app.nomodule.js\")\n    ${chalk.bold('Advanced:')}\n  --external-package [val]  Internal use only, may be removed at any time.\n    `.trim());\n}\nfunction formatInstallResults() {\n    return installResults\n        .map(([d, result]) => {\n        if (result === 'SUCCESS') {\n            return chalk.green(d);\n        }\n        if (result === 'ASSET') {\n            return chalk.yellow(d);\n        }\n        if (result === 'FAIL') {\n            return chalk.red(d);\n        }\n        return d;\n    })\n        .join(', ');\n}\nfunction logError(msg) {\n    if (!spinnerHasError) {\n        spinner.stopAndPersist({ symbol: chalk.cyan('⠼') });\n    }\n    spinnerHasError = true;\n    spinner = ora(chalk.red(msg));\n    spinner.fail();\n}\nfunction logUpdate(msg) {\n    spinner.text = banner + msg;\n}\nclass ErrorWithHint extends Error {\n    constructor(message, hint) {\n        super(message);\n        this.hint = hint;\n    }\n}\n// Add common, well-used non-esm packages here so that Rollup doesn't die trying to analyze them.\nconst PACKAGES_TO_AUTO_DETECT_EXPORTS = [\n    path.join('react', 'index.js'),\n    path.join('react-dom', 'index.js'),\n    'react-is',\n    'prop-types',\n    'scheduler',\n    'rxjs',\n    'exenv',\n    'body-scroll-lock',\n];\nfunction detectExports(filePath) {\n    try {\n        const fileLoc = require.resolve(filePath, { paths: [cwd] });\n        if (fs.existsSync(fileLoc)) {\n            return Object.keys(require(fileLoc)).filter((e) => e[0] !== '_');\n        }\n    }\n    catch (err) {\n        // ignore\n    }\n}\n/**\n * Resolve a \"webDependencies\" input value to the correct absolute file location.\n * Supports both npm package names, and file paths relative to the node_modules directory.\n * Follows logic similar to Node's resolution logic, but using a package.json's ESM \"module\"\n * field instead of the CJS \"main\" field.\n */\nfunction resolveWebDependency(dep, isExplicit) {\n    // if dep includes a file extension, check that dep isn't a package before returning\n    if (path.extname(dep) && !validatePackageName(dep).validForNewPackages) {\n        const isJSFile = ['.js', '.mjs', '.cjs'].includes(path.extname(dep));\n        return {\n            type: isJSFile ? 'JS' : 'ASSET',\n            loc: require.resolve(dep, { paths: [cwd] }),\n        };\n    }\n    const [depManifestLoc, depManifest] = resolveDependencyManifest(dep, cwd);\n    if (!depManifest) {\n        throw new ErrorWithHint(`\"${dep}\" not found. Have you installed the package via npm?`, depManifestLoc && chalk.italic(depManifestLoc));\n    }\n    if (depManifest.name &&\n        (depManifest.name.startsWith('@reactesm') || depManifest.name.startsWith('@pika/react'))) {\n        throw new Error(`React workaround packages no longer needed! Revert back to the official React & React-DOM packages.`);\n    }\n    let foundEntrypoint = depManifest['browser:module'] ||\n        depManifest.module ||\n        depManifest['main:esnext'] ||\n        depManifest.browser;\n    // Some packages define \"browser\" as an object. We'll do our best to find the\n    // right entrypoint in an entrypoint object, or fail otherwise.\n    // See: https://github.com/defunctzombie/package-browser-field-spec\n    if (typeof foundEntrypoint === 'object') {\n        foundEntrypoint =\n            foundEntrypoint[dep] ||\n                foundEntrypoint['./index.js'] ||\n                foundEntrypoint['./index'] ||\n                foundEntrypoint['./'] ||\n                foundEntrypoint['.'];\n    }\n    // If the package was a part of the explicit whitelist, fallback to it's main CJS entrypoint.\n    if (!foundEntrypoint && isExplicit) {\n        foundEntrypoint = depManifest.main || 'index.js';\n    }\n    if (typeof foundEntrypoint !== 'string') {\n        throw new Error(`\"${dep}\" has unexpected entrypoint: ${JSON.stringify(foundEntrypoint)}.`);\n    }\n    return {\n        type: 'JS',\n        loc: path.join(depManifestLoc, '..', foundEntrypoint),\n    };\n}\n/**\n * Formats the snowpack dependency name from a \"webDependencies\" input value:\n * 2. Remove any \".js\"/\".mjs\" extension (will be added automatically by Rollup)\n */\nfunction getWebDependencyName(dep) {\n    return dep.replace(/\\.m?js$/i, '');\n}\n/**\n * Takes object of env var mappings and converts it to actual\n * replacement specs as expected by @rollup/plugin-replace. The\n * `optimize` arg is used to derive NODE_ENV default.\n *\n * @param env\n * @param optimize\n */\nfunction getRollupReplaceKeys(env) {\n    const result = Object.keys(env).reduce((acc, id) => {\n        const val = env[id];\n        acc[`process.env.${id}`] = `${JSON.stringify(val === true ? process.env[id] : val)}`;\n        return acc;\n    }, {\n        'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV || 'production'),\n        'process.env.': '({}).',\n    });\n    return result;\n}\nexport async function install(installTargets, { hasBrowserlistConfig, lockfile }, config) {\n    const { webDependencies, installOptions: { installTypes, dest: destLoc, externalPackage: externalPackages, alias: installAlias, sourceMap, env, rollup: userDefinedRollup, }, } = config;\n    const knownNamedExports = { ...userDefinedRollup.namedExports };\n    for (const filePath of PACKAGES_TO_AUTO_DETECT_EXPORTS) {\n        knownNamedExports[filePath] = knownNamedExports[filePath] || detectExports(filePath) || [];\n    }\n    // @ts-ignore\n    if (!webDependencies && !process.versions.pnp && !fs.existsSync(path.join(cwd, 'node_modules'))) {\n        logError('no \"node_modules\" directory exists. Did you run \"npm install\" first?');\n        return;\n    }\n    const allInstallSpecifiers = new Set(installTargets\n        .map((dep) => dep.specifier)\n        .map((specifier) => installAlias[specifier] || specifier)\n        .sort());\n    const installEntrypoints = {};\n    const assetEntrypoints = {};\n    const importMap = { imports: {} };\n    const installTargetsMap = {};\n    const skipFailures = false;\n    for (const installSpecifier of allInstallSpecifiers) {\n        const targetName = getWebDependencyName(installSpecifier);\n        if (lockfile && lockfile.imports[installSpecifier]) {\n            installEntrypoints[targetName] = lockfile.imports[installSpecifier];\n            importMap.imports[installSpecifier] = `./${targetName}.js`;\n            installResults.push([targetName, 'SUCCESS']);\n            logUpdate(formatInstallResults());\n            continue;\n        }\n        try {\n            const { type: targetType, loc: targetLoc } = resolveWebDependency(installSpecifier, true);\n            if (targetType === 'JS') {\n                installEntrypoints[targetName] = targetLoc;\n                importMap.imports[installSpecifier] = `./${targetName}.js`;\n                Object.entries(installAlias)\n                    .filter(([key, value]) => value === installSpecifier)\n                    .forEach(([key, value]) => {\n                    importMap.imports[key] = `./${targetName}.js`;\n                });\n                installTargetsMap[targetLoc] = installTargets.filter((t) => installSpecifier === t.specifier);\n                installResults.push([installSpecifier, 'SUCCESS']);\n            }\n            else if (targetType === 'ASSET') {\n                assetEntrypoints[targetName] = targetLoc;\n                installResults.push([installSpecifier, 'ASSET']);\n            }\n            logUpdate(formatInstallResults());\n        }\n        catch (err) {\n            installResults.push([installSpecifier, 'FAIL']);\n            logUpdate(formatInstallResults());\n            if (skipFailures && !ALWAYS_SHOW_ERRORS.has(installSpecifier)) {\n                continue;\n            }\n            // An error occurred! Log it.\n            logError(err.message || err);\n            if (err.hint) {\n                // Note: Wait 1ms to guarantee a log message after the spinner\n                setTimeout(() => console.log(err.hint), 1);\n            }\n            return false;\n        }\n    }\n    if (Object.keys(installEntrypoints).length === 0 && Object.keys(assetEntrypoints).length === 0) {\n        logError(`No ESM dependencies found!`);\n        console.log(chalk.dim(`  At least one dependency must have an ESM \"module\" entrypoint. You can find modern, web-ready packages at ${chalk.underline('https://www.pika.dev')}`));\n        return false;\n    }\n    const inputOptions = {\n        input: installEntrypoints,\n        external: externalPackages,\n        treeshake: { moduleSideEffects: 'no-external' },\n        plugins: [\n            rollupPluginReplace(getRollupReplaceKeys(env)),\n            rollupPluginEntrypointAlias({ cwd }),\n            !!webDependencies &&\n                rollupPluginDependencyCache({\n                    installTypes,\n                    log: (url) => logUpdate(chalk.dim(url)),\n                }),\n            rollupPluginAlias({\n                entries: Object.entries(installAlias).map(([alias, mod]) => ({\n                    find: alias,\n                    replacement: mod,\n                })),\n            }),\n            rollupPluginNodeResolve({\n                mainFields: ['browser:module', 'module', 'browser', 'main'].filter(isTruthy),\n                extensions: ['.mjs', '.cjs', '.js', '.json'],\n                // whether to prefer built-in modules (e.g. `fs`, `path`) or local ones with the same names\n                preferBuiltins: false,\n                dedupe: userDefinedRollup.dedupe,\n            }),\n            rollupPluginJson({\n                preferConst: true,\n                indent: '  ',\n                compact: false,\n                namedExports: true,\n            }),\n            rollupPluginCommonjs({\n                extensions: ['.js', '.cjs'],\n                namedExports: knownNamedExports,\n            }),\n            rollupPluginDependencyStats((info) => (dependencyStats = info)),\n            rollupPluginReactFix(),\n            ...userDefinedRollup.plugins,\n        ].filter(Boolean),\n        onwarn(warning, warn) {\n            if (warning.code === 'UNRESOLVED_IMPORT') {\n                logError(`'${warning.source}' is imported by '${warning.importer}', but could not be resolved.`);\n                if (isNodeBuiltin(warning.source)) {\n                    console.log(chalk.dim(`  '${warning.source}' is a Node.js builtin module that won't exist in the browser.`));\n                    console.log(chalk.dim(`  Find a more web-friendly alternative, or add the \"rollup-plugin-node-polyfills\" plugin to your Snowpack config file.`));\n                }\n                else {\n                    console.log(chalk.dim(`  Make sure that the package is installed and that the file exists.`));\n                }\n                return;\n            }\n            warn(warning);\n        },\n    };\n    const outputOptions = {\n        dir: destLoc,\n        format: 'esm',\n        sourcemap: sourceMap,\n        exports: 'named',\n        chunkFileNames: 'common/[name]-[hash].js',\n    };\n    if (Object.keys(installEntrypoints).length > 0) {\n        try {\n            const packageBundle = await rollup(inputOptions);\n            logUpdate(formatInstallResults());\n            await packageBundle.write(outputOptions);\n        }\n        catch (err) {\n            const { loc } = err;\n            if (!loc || !loc.file) {\n                throw err;\n            }\n            // NOTE: Rollup will fail instantly on error. Because of that, we can\n            // only report one error at a time. `err.watchFiles` also exists, but\n            // for now `err.loc.file` has all the information that we need.\n            const failedExtension = path.extname(loc.file);\n            const suggestion = MISSING_PLUGIN_SUGGESTIONS[failedExtension];\n            if (!suggestion) {\n                throw err;\n            }\n            // Display posix-style on all environments, mainly to help with CI :)\n            const fileName = loc.file.replace(cwd + path.sep, '').replace(/\\\\/g, '/');\n            logError(`${chalk.bold('snowpack')} could not import ${fileName}. ${suggestion}`);\n            return;\n        }\n    }\n    await writeLockfile(path.join(destLoc, 'import-map.json'), importMap);\n    Object.entries(assetEntrypoints).forEach(([assetName, assetLoc]) => {\n        mkdirp.sync(path.dirname(`${destLoc}/${assetName}`));\n        fs.copyFileSync(assetLoc, `${destLoc}/${assetName}`);\n    });\n    return true;\n}\nexport async function cli(args) {\n    // parse CLI flags\n    const cliFlags = yargs(args, { array: ['env', 'exclude', 'externalPackage'] });\n    if (cliFlags.help) {\n        printHelp();\n        process.exit(0);\n    }\n    if (cliFlags.version) {\n        console.log(require('../package.json').version);\n        process.exit(0);\n    }\n    if (cliFlags.reload) {\n        console.log(`${chalk.yellow('ℹ')} clearing CDN cache...`);\n        await clearCache();\n    }\n    if (cliFlags['_'].length > 3) {\n        console.log(`Unexpected multiple commands`);\n        process.exit(1);\n    }\n    // Load the current package manifest\n    let pkgManifest;\n    try {\n        pkgManifest = require(path.join(cwd, 'package.json'));\n    }\n    catch (err) {\n        console.log(chalk.red('[ERROR] package.json required but no file was found.'));\n        process.exit(1);\n    }\n    // load config\n    const config = loadAndValidateConfig(cliFlags, pkgManifest);\n    // load lockfile\n    let lockfile = await readLockfile(cwd);\n    let newLockfile = null;\n    if (cliFlags['_'][2] === 'build') {\n        await buildCommand({\n            cwd,\n            config,\n        });\n        return;\n    }\n    if (cliFlags['_'][2] === 'dev') {\n        await devCommand({\n            cwd,\n            config,\n        });\n        return;\n    }\n    const { exclude, scripts, installOptions: { dest }, knownEntrypoints, webDependencies, } = config;\n    const hasBrowserlistConfig = !!pkgManifest.browserslist ||\n        !!process.env.BROWSERSLIST ||\n        fs.existsSync(path.join(cwd, '.browserslistrc')) ||\n        fs.existsSync(path.join(cwd, 'browserslist'));\n    const installTargets = [];\n    if (knownEntrypoints) {\n        installTargets.push(...scanDepList(knownEntrypoints, cwd));\n    }\n    if (webDependencies) {\n        installTargets.push(...scanDepList(Object.keys(webDependencies), cwd));\n    }\n    {\n        installTargets.push(...(await scanImports(cwd, config)));\n    }\n    if (installTargets.length === 0) {\n        logError('Nothing to install.');\n        return;\n    }\n    spinner.start();\n    const startTime = Date.now();\n    if (webDependencies && Object.keys(webDependencies).length > 0) {\n        newLockfile = await resolveTargetsFromRemoteCDN(lockfile, pkgManifest, config).catch((err) => {\n            logError(err.message || err);\n            process.exit(1);\n        });\n    }\n    rimraf.sync(dest);\n    await mkdirp(dest);\n    const finalResult = await install(installTargets, { hasBrowserlistConfig, lockfile: newLockfile }, config).catch((err) => {\n        if (err.loc) {\n            console.log('\\n' + chalk.red.bold(`✘ ${err.loc.file}`));\n        }\n        if (err.url) {\n            console.log(chalk.dim(`👉 ${err.url}`));\n        }\n        throw err;\n    });\n    if (finalResult) {\n        spinner.succeed(chalk.bold(`snowpack`) +\n            ` install complete.` +\n            chalk.dim(` [${((Date.now() - startTime) / 1000).toFixed(2)}s]`));\n        if (!!dependencyStats) {\n            console.log(printStats(dependencyStats));\n        }\n    }\n    if (newLockfile) {\n        await writeLockfile(path.join(cwd, 'snowpack.lock.json'), newLockfile);\n    }\n    // If an error happened, set the exit code so that programmatic usage of the CLI knows.\n    // We were seeing race conditions here, so add a little buffer.\n    if (spinnerHasError) {\n        setTimeout(() => {\n            spinner.warn(chalk(`Finished with warnings.`));\n            process.exitCode = 1;\n        }, 20);\n    }\n}\n"],"names":["getStateString","workerState","isWatch","state","Array","isArray","chalk","dim","done","error","red","green","config","watch","WORKER_BASE_STATE","output","paint","bus","registeredWorkers","buildMode","devMode","consoleOutput","hasBeenCleared","missingWebModule","allWorkerStates","workerId","repaint","process","stdout","write","ansiEscapes","clearTerminal","bold","cyan","port","ip","ips","startTimeMs","dest","dotLength","length","dots","padEnd","stateStr","missingPackageName","deepPackagePathParts","split","startsWith","shift","underline","chalkFn","trim","replace","overallStatus","Object","values","reduce","result","exit","on","id","msg","undefined","level","args","util","format","apply","specifier","jsx","ts","tsx","vue","svelte","parse","require","spliceString","source","withSlice","start","end","slice","scanCodeImportsExports","code","imports","filter","imp","d","transformEsmImports","_code","replaceImport","rewrittenCode","reverse","spec","substring","s","e","rewrittenImport","wrapEsmProxyResponse","url","ext","hasHmr","JSON","stringify","map","x","join","copy","command","cwd","env","NODE_ENV","messageBus","EventEmitter","allRegisteredWorkers","entries","scripts","relevantWorkers","allBuildExtensions","allWorkerPromises","dependencyImportMapLoc","path","installOptions","dependencyImportMap","err","isBundled","devOptions","bundle","isBundledHardcoded","resolve","paths","buildDirectoryLoc","out","finalDirectoryLoc","console","workerConfig","cmdArr","cmd","Error","dirUrl","dirDisk","to","yargs","rimraf","sync","mkdirp","push","exts","log","emit","warn","relDest","relative","sep","workerPromise","execa","npmRunPath","extendEnv","shell","catch","toString","then","stderr","b","stdOutput","includes","endsWith","test","errorMatch","match","mountDirDetails","scriptConfig","dirDest","Boolean","includeFileSets","allFiles","glob","ignore","exclude","absolute","nodir","dot","allBuildNeededFiles","Promise","all","f","extname","substr","outPath","dirname","fs","copyFile","allBuiltFromFiles","Set","allProxiedFiles","fileExtension","input","createReadStream","extToFind","extToReplace","srcFileExtensionMapping","RegExp","resolvedUrl","add","posix","mkdir","recursive","writeFile","modulePath","build","message","proxiedFileLoc","proxiedCode","readFile","encoding","proxiedExt","proxiedUrl","proxyCode","proxyFileLoc","prepareBuildDirectoryForParcel","srcLoc","has","tempBuildManifest","name","devDependencies","browserslist","parcelOptions","fallback","homepage","bundleAppPromise","PIKA_CDN","CACHE_DIR","cachedir","RESOURCE_CACHE","BUILD_CACHE","HAS_CDN_HASH_REGEX","readLockfile","lockfileContents","readFileSync","writeLockfile","loc","importMap","sortedImportMap","key","keys","sort","writeFileSync","fetchCDNResource","resourceUrl","responseType","got","headers","throwHttpErrors","isTruthy","item","resolveDependencyManifest","dep","depManifest","fullPath","searchPath","indexOfSearch","lastIndexOf","manifestPath","manifestStr","MISSING_PLUGIN_SUGGESTIONS","hmrEnabledExtensions","css","getEncodingType","sendFile","req","res","body","writeHead","mime","contentType","sendError","status","sendMessage","channel","data","inMemoryBuildCache","Map","filesBeingDeleted","filesBeingBuilt","liveReloadClients","serverStart","Date","now","hmrCode","__dirname","mountedDirectories","broadcast","client","setTimeout","getUrlFromFile","fileLoc","fileExt","resolvedDirUrl","buildFile","fileContents","fileBuilder","fileBuilderPromise","get","filename","set","delete","getFileBuilderForWorker","selectedWorker","options","cmdWithFile","http","createServer","reqUrl","reqPath","decodeURI","pathname","method","statusCode","Connection","setInterval","splice","indexOf","attemptedFileLoads","attemptLoadFile","requestedFile","stat","isFile","isProxyModule","requestedFileExt","toLowerCase","isRoute","responseFileExt","getFileFromUrl","resource","srcExtMatchers","srcFile","fallbackFile","prefix","hotCachedResponse","cachedBuildData","cacache","originalFileHash","metadata","newFileHash","etag","coldCachedResponse","serverResponse","checkFinalBuildAnyway","equals","Buffer","from","clear","rm","finalBuild","put","listen","onWatchEvent","event","fileUrl","entry","watcher","chokidar","ignored","persistent","ignoreInitial","disableGlobbing","forEach","os","networkInterfaces","every","i","family","internal","address","openInBrowser","openCmd","platform","CONFIG_NAME","ALWAYS_EXCLUDE","DEFAULT_CONFIG","knownEntrypoints","externalPackage","installTypes","alias","rollup","plugins","dedupe","configSchema","type","properties","extends","items","webDependencies","additionalProperties","sourceMap","oneOf","enum","namedExports","expandCliFlags","flags","relevantFlags","flag","val","acc","index","normalizeConfig","scriptId","handleConfigError","handleValidationErrors","filepath","errors","handleDeprecatedConfigError","mainMsg","msgs","validateConfigAgainstV1","rawConfig","cliFlags","include","entrypoints","dist","hash","nomodule","nomoduleOutput","babel","optimize","strict","loadAndValidateConfig","pkgManifest","explorerSync","cosmiconfigSync","searchPlaces","stopDir","load","search","isEmpty","cliConfig","validation","validate","allowUnknownAttributes","propertyName","extendConfig","extendConfigLoc","extendResult","extendValidation","overwriteMerge","destinationArray","sourceArray","mergedConfig","merge","arrayMerge","webDependencyName","dependencies","resolveDependency","installSpecifier","packageSemver","lockfile","canRetry","validatePackageName","validForNewPackages","installUrl","installUrlType","cachedResult","info","pinnedUrl","importUrlPath","pinnedUrlPath","buildStatus","typesUrlPath","typesUrl","lookupStatusCode","resolveTargetsFromRemoteCDN","downloadQueue","PQueue","concurrency","newLockfile","resolutionError","installSemver","onIdle","clearCache","IS_DEEP_PACKAGE_IMPORT","rollupPluginEntrypointAlias","resolveId","importer","packageScope","packageName","packageFullName","manifest","needsAlias","module","browser","main","skipSelf","resolved","CACHED_FILE_ID_PREFIX","PIKA_CDN_TRIM_LENGTH","rollupPluginDependencyCache","allTypesToInstall","cacheKey","response","finalResult","typesTarballUrl","writeBundle","dir","tempDir","tmp","tarballContents","cachedTarball","tarballResponse","typesUrlParts","typesPackageName","typesPackageTarLoc","typesPackageLoc","tar","file","rollupPluginDependencyStats","cb","outputDir","existingFileCache","statsSummary","direct","common","buildExistingFileCache","fileName","filePath","existsSync","size","statSync","compareDependencies","files","contents","byteLength","gzip","zlib","gzipSync","brotli","brotliCompressSync","delta","generateBundle","directDependencies","commonDependencies","assetOrChunk","raw","isBuffer","WEB_MODULES_TOKEN","WEB_MODULES_TOKEN_LENGTH","BARE_SPECIFIER_REGEX","HAS_NAMED_IMPORTS_REGEX","SPLIT_NAMED_IMPORTS_REGEX","DEFAULT_IMPORT_REGEX","HTML_JS_REGEX","stripJsExtension","createInstallTarget","default","namespace","named","removeSpecifierQueryString","queryStringIndex","getWebModuleSpecifierFromCode","importStatement","importSpecifierMatch","parseWebModuleSpecifier","cleanedSpecifier","webModulesIndex","resolvedSpecifier","resolvedSpecifierWithoutExtension","parseImportStatement","webModuleSpecifier","ss","se","dynamicImport","defaultImport","namespaceImport","namedImports","getInstallTargetsForFile","allImports","scanDepList","depList","whitelistItem","hasMagic","nodeModulesLoc","nodePath","flat","concat","scanImports","initESModuleLexer","includeFiles","loadedFiles","promises","transformFileAsync","runtime","isTSX","babelrc","configFile","allMatches","exec","full","lookup","impA","impB","localeCompare","SIZE_COLUMN_WIDTH","entriesSort","filenameA","filenameB","formatSize","kb","Math","round","floor","color","formatDelta","formatFileInfo","stats","isLastFile","lineGlyph","lineName","fileStat","gzipStat","brotliStat","lineStat","lineDelta","formatFiles","strippedFiles","printStats","dependencyStats","allDirect","allCommon","maxFileNameLength","max","rollupPluginReactFix","transform","banner","installResults","spinner","ora","spinnerHasError","printHelp","formatInstallResults","yellow","logError","stopAndPersist","symbol","fail","logUpdate","text","ErrorWithHint","constructor","hint","PACKAGES_TO_AUTO_DETECT_EXPORTS","detectExports","resolveWebDependency","isExplicit","isJSFile","depManifestLoc","italic","foundEntrypoint","getWebDependencyName","getRollupReplaceKeys","install","installTargets","hasBrowserlistConfig","destLoc","externalPackages","installAlias","userDefinedRollup","knownNamedExports","versions","pnp","allInstallSpecifiers","installEntrypoints","assetEntrypoints","installTargetsMap","targetName","targetType","targetLoc","value","t","inputOptions","external","treeshake","moduleSideEffects","rollupPluginReplace","rollupPluginAlias","mod","find","replacement","rollupPluginNodeResolve","mainFields","extensions","preferBuiltins","rollupPluginJson","preferConst","indent","compact","rollupPluginCommonjs","onwarn","warning","isNodeBuiltin","outputOptions","sourcemap","exports","chunkFileNames","packageBundle","failedExtension","suggestion","assetName","assetLoc","copyFileSync","cli","array","help","version","reload","buildCommand","devCommand","BROWSERSLIST","startTime","succeed","toFixed","exitCode"],"mappings":"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"}